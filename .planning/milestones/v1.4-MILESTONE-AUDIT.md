---
milestone: v1.4
audited: 2026-02-02T23:30:00Z
status: tech_debt
scores:
  requirements: 36/37
  phases: 3/3
  integration: 8/8
  flows: 6/6
gaps:
  requirements:
    - 'OAUTH-03: OAuth access tokens not returned to client -- deferred to post-pilot'
  integration: []
  flows: []
tech_debt:
  - phase: 27-critical-security
    items:
      - 'TODO in convex/authTauri.ts:23 for post-pilot token handling (OAUTH-03)'
      - "Zod validation in shadow mode (logs but doesn't block) -- graduate to enforcement post-pilot"
      - '@ts-nocheck in batchActions.ts still present (Convex action type inference workaround)'
  - phase: 28-quality-gates-bug-fixes
    items:
      - 'CI test step passes vacuously (no test files exist yet)'
  - phase: 29-performance-accessibility-polish
    items:
      - 'Filter components (OrgFilters, MemberFilters, opportunity-filters, mobile-filters) excluded from aria-describedby'
      - 'HIGH: Empty first batch skips match clearing -- saveBatchResults not called for batchIndex=0 when matches=[] and !isLastBatch, so old matches persist under later batch inserts (compute.ts:289, mutations.ts:157)'
      - 'HIGH: Opportunity list re-queried per batch -- list shrink/reorder between batches can produce empty slice that halts chain without finalization (compute.ts:144-160)'
      - 'MEDIUM: No concurrency guard on matching runs -- concurrent triggerMatchComputation calls interleave; batch 0 from run B clears run A in-flight inserts (compute.ts:84, mutations.ts:157)'
---

# v1.4 Hardening - Milestone Audit

**Audited:** 2026-02-02
**Status:** Tech Debt (no blockers, accumulated deferred items)
**Milestone Goal:** Fix all security vulnerabilities, bugs, performance issues, and code quality gaps from the codebase review before the BAISH pilot launch.

## Requirements Coverage

| Requirement | Description                                                  | Phase | Status                    |
| ----------- | ------------------------------------------------------------ | ----- | ------------------------- |
| AUTH-01     | Enrichment sendMessage requires auth + ownership             | 27    | Satisfied                 |
| AUTH-02     | Enrichment getMessagesPublic requires auth + ownership       | 27    | Satisfied                 |
| AUTH-03     | Enrichment extractFromConversation requires auth + ownership | 27    | Satisfied                 |
| AUTH-04     | OAuth exchangeOAuthCode validates redirectUri                | 27    | Satisfied                 |
| AUTH-05     | getCompleteness requires auth (deprecated)                   | 27    | Satisfied                 |
| AUTH-06     | Shared requireAuth helper standardizes auth                  | 27    | Satisfied                 |
| OAUTH-01    | Tauri mobile OAuth implements PKCE (S256)                    | 27    | Satisfied                 |
| OAUTH-02    | OAuth state parameter validated on callback                  | 27    | Satisfied                 |
| OAUTH-03    | OAuth access tokens not returned to client                   | 27    | **Deferred** (post-pilot) |
| OAUTH-04    | Console.log removed from OAuth flow                          | 27    | Satisfied                 |
| LLM-01      | XML delimiters separate data from instructions               | 27    | Satisfied                 |
| LLM-02      | Input length limits on profile fields                        | 27    | Satisfied                 |
| LLM-03      | LLM tool_use responses validated with Zod                    | 27    | Satisfied                 |
| LLM-04      | Zod schemas use permissive mode                              | 27    | Satisfied                 |
| BUG-01      | Growth areas aggregated across batches                       | 28    | Satisfied                 |
| BUG-02      | Date conversion uses Date.UTC()                              | 28    | Satisfied                 |
| BUG-03      | Navigation calls wrapped in useEffect                        | 28    | Satisfied                 |
| BUG-04      | Engagement override expiration checked in queries            | 28    | Satisfied                 |
| PERF-01     | N+1 in programs.ts resolved                                  | 29    | Satisfied                 |
| PERF-02     | N+1 in attendance/queries.ts resolved                        | 29    | Satisfied                 |
| PERF-03     | N+1 in emails/send.ts resolved                               | 29    | Satisfied                 |
| PERF-04     | Rate limiting between matching batch API calls               | 29    | Satisfied                 |
| QUAL-01     | CI pipeline via GitHub Actions                               | 28    | Satisfied                 |
| QUAL-02     | Pre-commit hooks via husky + lint-staged                     | 28    | Satisfied                 |
| QUAL-03     | Dual lockfile resolved                                       | 28    | Satisfied                 |
| QUAL-04     | .env.example documenting all variables                       | 28    | Satisfied                 |
| QUAL-05     | test-upload.tsx route removed                                | 28    | Satisfied                 |
| QUAL-06     | Dead code removed (\_STEP_LABELS)                            | 28    | Satisfied                 |
| QUAL-07     | Browser alert() replaced with toast                          | 28    | Satisfied                 |
| QUAL-08     | Error handling standardized                                  | 28    | Satisfied                 |
| QUAL-09     | Timezone validation uses IANA check                          | 28    | Satisfied                 |
| A11Y-01     | Interactive org div converted to button                      | 29    | Satisfied                 |
| A11Y-02     | Form errors linked via aria-describedby                      | 29    | Satisfied                 |
| A11Y-03     | Client-side password validation with feedback                | 29    | Satisfied                 |
| A11Y-04     | Drag state uses icon/text in addition to color               | 29    | Satisfied                 |
| VIS-01      | GradientBg on remaining pages                                | 29    | Satisfied                 |
| VIS-02      | 35+ headings updated to font-display                         | 29    | Satisfied                 |

**Score: 36/37 satisfied** (1 explicitly deferred to post-pilot per project CONTEXT.md)

## Phase Verification Status

| Phase                                   | Plans        | Verification Status | Score        | Verified             |
| --------------------------------------- | ------------ | ------------------- | ------------ | -------------------- |
| 27: Critical Security                   | 3/3 complete | Passed              | 34/34 truths | 2026-02-02T21:55:45Z |
| 28: Quality Gates & Bug Fixes           | 3/3 complete | Passed              | 18/18 truths | 2026-02-02T19:30:00Z |
| 29: Performance, Accessibility & Polish | 3/3 complete | Passed              | 16/16 truths | 2026-02-02T21:30:00Z |

**All 3 phases verified. All 9 plans executed. 68/68 truths confirmed.**

## Cross-Phase Integration

| Connection                | From                 | To                           | Status |
| ------------------------- | -------------------- | ---------------------------- | ------ |
| Auth helpers in CI        | Phase 27 auth.ts     | Phase 28 CI pipeline         | Wired  |
| LLM validation + logging  | Phase 27 Zod schemas | Phase 28 logging.ts          | Wired  |
| Growth area fix preserved | Phase 28 compute.ts  | Phase 29 compute.ts refactor | Wired  |
| useEffect + GradientBg    | Phase 28 route files | Phase 29 route files         | Wired  |
| CI catches Phase 29       | Phase 28 pre-commit  | Phase 29 changes             | Wired  |
| Matching dedup chain      | Phase 28 push fix    | Phase 29 saveBatchResults    | Wired  |
| Auth + accessibility      | Phase 27 endpoints   | Phase 29 forms               | Wired  |
| Logging across compute    | Phase 28 logging.ts  | Phase 29 batch queries       | Wired  |

**Score: 8/8 integration points connected. 0 orphaned exports. 0 missing connections.**

## E2E Flow Verification

| Flow                                   | Steps                            | Status   |
| -------------------------------------- | -------------------------------- | -------- |
| New User Signup -> Profile -> Matching | 6 steps across Phases 27, 28, 29 | Complete |
| Tauri Mobile OAuth (PKCE S256)         | 10 steps in Phase 27             | Complete |
| Admin CRM Operations                   | 5 steps across Phases 27, 29     | Complete |
| Event -> Notification -> Attendance    | 5 steps across Phases 28, 29     | Complete |
| CI/DX Developer Flow                   | 6 steps in Phase 28              | Complete |
| Matching Compute (Rate-Limited)        | 9 steps across Phases 27, 28, 29 | Complete |

**Score: 6/6 flows verified end-to-end. 0 broken flows.**

## Tech Debt Summary

### Phase 27: Critical Security

1. **OAUTH-03 deferred:** OAuth access tokens still returned to client in Tauri flow. Flagged as TODO in `convex/authTauri.ts:23` for post-pilot fix. Low risk for pilot (tokens are short-lived, Tauri WebView is sandboxed).
2. **Zod shadow mode:** LLM response validation logs failures but doesn't block operations. Appropriate for pilot stability; graduate to enforcement once real LLM output patterns are confirmed.
3. **@ts-nocheck in batchActions.ts:** Pre-existing Convex action type inference workaround. Not introduced in v1.4 but not resolved either.

### Phase 28: Quality Gates & Bug Fixes

4. **Vacuous test step:** CI runs `bun test` which passes with 0 tests. Framework is ready but no test files exist. Not a blocker -- CI still validates lint, typecheck, and build.

### Phase 29: Performance, Accessibility & Polish

5. **Filter components excluded:** OrgFilters, MemberFilters, opportunity-filters, mobile-filters intentionally excluded from aria-describedby (no validation errors to link). Correct per WCAG but noted for completeness.

### Phase 29: Chained Matching Bugs (from code review)

6. **HIGH -- Empty first batch skips match clearing.** `saveBatchResults` is only called when `batchMatches.length > 0 || isLastBatch` (`compute.ts:289`). If batch 0 returns zero tier-qualifying matches and `totalBatches > 1`, `saveBatchResults` never fires for `batchIndex === 0`, so the clear logic at `mutations.ts:157-161` never runs. Later batches insert on top of stale matches. **Fix:** Always call `saveBatchResults` for `batchIndex === 0` regardless of match count, or clear upfront in `computeMatchesForProfile`.

7. **HIGH -- Opportunity list re-queried per batch.** Each `processMatchBatch` call re-queries `getCandidateOpportunities` (`compute.ts:145-148`) and slices by index. If opportunities are archived/added between batches, the slice can return empty, triggering the early return at `compute.ts:155-161` which halts the chain without finalization (no growth area dedup, no `isLastBatch` path). **Fix:** Snapshot opportunity IDs once in `computeMatchesForProfile` and pass them through the chain. Treat an empty batch as terminal rather than returning before finalization.

8. **MEDIUM -- No concurrency guard on matching runs.** `triggerMatchComputation` is callable from the UI (`matches/index.tsx:130`) with no lock or "matching in progress" flag. If fired twice, run B's batch 0 clears run A's in-flight inserts via the `batchIndex === 0` clear logic. The `runTimestamp` idempotency check at `mutations.ts:146-154` only logs a warning. **Fix:** Store an active run ID on the profile and reject stale batches, or short-circuit additional runs while one is in progress.

**Total: 8 items across 3 phases. 0 hard blockers for pilot (low concurrency, stable opportunity data). 3 correctness bugs to fix before scaling beyond pilot.**

## Deferred Requirements (v1.5+)

From REQUIREMENTS.md, the following were explicitly scoped out of v1.4:

| ID      | Description                                 | Reason |
| ------- | ------------------------------------------- | ------ |
| QUAL-10 | Rate limiting on public-facing endpoints    | v1.5   |
| QUAL-11 | Row-level security via convex-helpers       | v1.5   |
| QUAL-12 | Anthropic client reuse within batch loops   | v1.5   |
| QUAL-13 | Full profile context caching for enrichment | v1.5   |

## Build Verification

- `bun run typecheck`: Passes (0 errors)
- `bun run lint`: Passes (0 warnings)
- `bun run build`: Passes
- CI pipeline: Configured and active
- Pre-commit hooks: Installed and active

## Conclusion

v1.4 Hardening achieved its definition of done. All 36 in-scope requirements are satisfied. The 1 deferred requirement (OAUTH-03) was explicitly agreed upon before Phase 27 execution and documented in CONTEXT.md. Cross-phase integration is complete with no orphaned or missing connections. All 6 E2E user flows verified.

Post-audit code review identified 3 correctness bugs in the chained matching architecture (items 6-8 above). These are low-risk for the pilot (50-100 users, stable opportunity data, low concurrency) but should be fixed before scaling. The bugs do not invalidate any v1.4 requirements -- PERF-04 (rate limiting) is satisfied, the chaining architecture works correctly in the common case, and the edge cases require specific timing conditions to trigger.

**Recommendation:** Milestone is ready for completion. Track matching bugs as v1.5 backlog items.

---

_Audited: 2026-02-02_
_Auditor: Claude (gsd-milestone-audit orchestrator + gsd-integration-checker)_
