---
phase: 01-foundation-opportunities
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - convex/schema.ts
  - convex/_generated/*
  - app/routes/__root.tsx
  - app/routes/index.tsx
  - app/router.tsx
  - app/client.tsx
  - app/ssr.tsx
  - app/styles/app.css
  - app/lib/utils.ts
  - vite.config.ts
  - components.json
  - .env.local
autonomous: false

must_haves:
  truths:
    - "Running `bun dev` starts development server without errors"
    - "Visiting localhost:3000 renders a page"
    - "Convex dashboard shows connected project"
    - "TypeScript compiles without errors"
  artifacts:
    - path: "package.json"
      provides: "Project dependencies"
      contains: "convex"
    - path: "convex/schema.ts"
      provides: "Database schema placeholder"
      min_lines: 5
    - path: "convex/auth.ts"
      provides: "Convex Auth configuration"
      contains: "convexAuth"
    - path: "app/routes/__root.tsx"
      provides: "Root route with Convex provider"
      contains: "ConvexProvider"
  key_links:
    - from: "app/routes/__root.tsx"
      to: "convex/auth.ts"
      via: "Convex provider"
      pattern: "ConvexProvider"
---

<objective>
Set up the project foundation: TanStack Start with file-based routing, Convex backend with Convex Auth, Tailwind CSS, and shadcn/ui (Lyra style, coral accent).

Purpose: Establish the technical foundation that all subsequent plans build upon. Without this, no other work can proceed.

Output: A working TanStack Start + Convex project with Convex Auth configured, Lyra design system with coral accent, ready for feature development.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation-opportunities/CONTEXT.md
@.planning/phases/01-foundation-opportunities/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize project with Convex TanStack Start template</name>
  <files>
    package.json
    tsconfig.json
    vite.config.ts
    app.config.ts
    .gitignore
    app/routes/__root.tsx
    app/routes/index.tsx
    app/router.tsx
    app/client.tsx
    app/ssr.tsx
    app/routeTree.gen.ts
    convex/_generated/*
  </files>
  <action>
Use the official Convex TanStack Start template which includes TanStack Start + Convex + TanStack Query preconfigured:

```bash
bunx create-convex@latest -t tanstack-start .
```

If directory not empty, the scaffolder may fail. In that case, create in temp dir and move files, or use a project name and move.

This template gives us:
- TanStack Start with file-based routing
- Convex client already configured
- TanStack Query integration via @convex-dev/react-query
- ConvexProvider already in __root.tsx

After scaffolding, add Tailwind CSS and additional dependencies:

```bash
bun add @tailwindcss/vite tailwindcss
bun add @convex-dev/auth @auth/core
bun add class-variance-authority clsx tailwind-merge lucide-react
bun add -D @types/node
```

Update `vite.config.ts` to include Tailwind:
```typescript
import { defineConfig } from 'vite'
import tsConfigPaths from 'vite-tsconfig-paths'
import { tanstackStart } from '@tanstack/react-start/plugin/vite'
import tailwindcss from '@tailwindcss/vite'

export default defineConfig({
  server: {
    port: 3000,
  },
  plugins: [tsConfigPaths(), tanstackStart(), tailwindcss()],
})
```

Create `app/styles/app.css` with Tailwind directives:
```css
@import "tailwindcss";
```

The Convex template creates this structure:
```
app/
├── routes/
│   ├── __root.tsx      # Root layout with ConvexProvider
│   └── index.tsx       # Home page route
├── lib/
│   └── convex.ts       # Convex + TanStack Query client setup
├── client.tsx          # Client entry point
├── router.tsx          # Router configuration
├── routeTree.gen.ts    # Auto-generated route tree
└── ssr.tsx             # Server-side rendering handler
convex/
├── _generated/         # Auto-generated Convex types
└── (sample files)      # Sample Convex functions
```

Phase-specific dependencies (algoliasearch, string-similarity-js) will be added in later plans when needed.
  </action>
  <verify>
`bun install` completes without errors.
`ls app/routes` shows __root.tsx and index.tsx exist.
`ls convex` shows _generated directory exists.
`vite.config.ts` contains `tanstackStart()` and `tailwindcss()` plugins.
  </verify>
  <done>TanStack Start + Convex project scaffolded from official template with Tailwind CSS added.</done>
</task>

<task type="auto">
  <name>Task 2: Configure Convex with Convex Auth for TanStack Start</name>
  <files>
    convex/schema.ts
    convex/auth.ts
    convex/auth.config.ts
    app/routes/__root.tsx
    app/lib/convex.ts
    app/lib/utils.ts
    .env.local
  </files>
  <action>
1. Initialize Convex:
```bash
bunx convex dev
```
This will prompt to create a new project or link existing. Create new project named "astn" (or similar). This generates `convex/_generated/` and adds CONVEX_URL to .env.local.

2. Initialize Convex Auth:
```bash
bunx @convex-dev/auth
```
This sets up the auth tables and generates auth config files.

3. Create `convex/auth.ts` with OAuth and password providers:
```typescript
import GitHub from "@auth/core/providers/github";
import Google from "@auth/core/providers/google";
import { Password } from "@convex-dev/auth/providers/Password";
import { convexAuth } from "@convex-dev/auth/server";

export const { auth, signIn, signOut, store, isAuthenticated } = convexAuth({
  providers: [GitHub, Google, Password],
});
```

4. Create `convex/auth.config.ts`:
```typescript
export default {
  providers: [
    {
      domain: process.env.CONVEX_SITE_URL,
      applicationID: "convex",
    },
  ],
};
```

5. Update `convex/schema.ts` to include auth tables:
```typescript
import { defineSchema } from "convex/server";
import { authTables } from "@convex-dev/auth/server";

// Auth tables + placeholder for opportunities (added in 01-02)
export default defineSchema({
  ...authTables,
});
```

6. Create `app/lib/convex.ts` for Convex client setup:
```typescript
import { ConvexReactClient } from "convex/react";
import { ConvexQueryClient } from "@convex-dev/react-query";
import { QueryClient } from "@tanstack/react-query";

// Create Convex client
const convexUrl = import.meta.env.VITE_CONVEX_URL;
export const convex = new ConvexReactClient(convexUrl);

// Create Convex Query client for TanStack Query integration
export const convexQueryClient = new ConvexQueryClient(convex);

// Create TanStack Query client
export const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      queryKeyHashFn: convexQueryClient.hashFn(),
      queryFn: convexQueryClient.queryFn(),
    },
  },
});
convexQueryClient.connect(queryClient);
```

7. Update `app/routes/__root.tsx` with Convex provider:
```typescript
import { QueryClient, QueryClientProvider } from "@tanstack/react-query";
import { createRootRouteWithContext, Outlet, HeadContent, Scripts } from "@tanstack/react-router";
import { ConvexProvider } from "convex/react";
import * as React from "react";
import { convex, queryClient } from "../lib/convex";
import appCss from "../styles/app.css?url";

export const Route = createRootRouteWithContext<{ queryClient: QueryClient }>()({
  head: () => ({
    meta: [
      { charSet: "utf-8" },
      { name: "viewport", content: "width=device-width, initial-scale=1" },
      { title: "AI Safety Talent Network" },
    ],
    links: [{ rel: "stylesheet", href: appCss }],
  }),
  component: RootComponent,
});

function RootComponent() {
  return (
    <RootDocument>
      <Outlet />
    </RootDocument>
  );
}

function RootDocument({ children }: { children: React.ReactNode }) {
  return (
    <html lang="en">
      <head>
        <HeadContent />
      </head>
      <body>
        <ConvexProvider client={convex}>
          <QueryClientProvider client={queryClient}>
            {children}
          </QueryClientProvider>
        </ConvexProvider>
        <Scripts />
      </body>
    </html>
  );
}
```

8. Create `app/lib/utils.ts` with cn helper (if not already created by shadcn):
```typescript
import { type ClassValue, clsx } from "clsx";
import { twMerge } from "tailwind-merge";

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs));
}
```

9. Add environment variables to `.env.local`:
```
# Convex URL (auto-generated by convex dev)
VITE_CONVEX_URL=

# Convex Auth JWT secret (generate with: openssl rand -base64 32)
CONVEX_AUTH_PRIVATE_KEY=

# OAuth providers (add when ready for Phase 2)
# AUTH_GITHUB_ID=
# AUTH_GITHUB_SECRET=
# AUTH_GOOGLE_ID=
# AUTH_GOOGLE_SECRET=
```

NOTE: OAuth credentials are not needed for Phase 1 (no auth required for browsing). They'll be configured in Phase 2.
  </action>
  <verify>
`bunx convex dev` shows "Convex functions ready" (run in separate terminal).
Convex dashboard shows auth tables (users, sessions, etc.).
  </verify>
  <done>Convex connected with Convex Auth configured for TanStack Start. OAuth setup deferred to Phase 2.</done>
</task>

<task type="auto">
  <name>Task 3: Generate Convex Auth secret</name>
  <action>
Generate and set the Convex Auth private key:

```bash
# Generate a secure random key
openssl rand -base64 32
```

Copy the output and add it to `.env.local` as `CONVEX_AUTH_PRIVATE_KEY`.

Then set it in Convex dashboard:
1. Go to your project at https://dashboard.convex.dev
2. Settings → Environment Variables
3. Add `CONVEX_AUTH_PRIVATE_KEY` with the generated value

NOTE: OAuth provider credentials (GitHub, Google) are not needed for Phase 1.
They'll be configured in Phase 2 when we implement user authentication.
  </action>
  <verify>
`bunx convex dev` shows functions deployed without auth errors.
  </verify>
  <done>Convex Auth secret configured. OAuth setup deferred to Phase 2.</done>
</task>

<task type="auto">
  <name>Task 4: Configure shadcn/ui with Lyra style and coral accent</name>
  <files>
    components.json
    app/components/ui/button.tsx
    app/components/ui/card.tsx
    app/routes/index.tsx
    app/styles/app.css
  </files>
  <action>
Since we used `--add-ons shadcn` during project creation, shadcn/ui is already initialized.

1. Verify shadcn configuration in `components.json`:
The scaffolder should have created this with sensible defaults. If needed, reconfigure:
```bash
bunx shadcn@latest init
```
When prompted:
- Style: **Lyra** (boxy, sharp edges, pairs with mono fonts)
- Theme: **Light** (default)
- Base color: Slate
- CSS variables: Yes

2. Customize the accent color to coral/salmon in `app/styles/app.css`:
After shadcn generates the CSS variables, update the accent colors:
```css
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    /* ... existing variables ... */
    --accent: 12 76% 61%;        /* Coral/salmon accent */
    --accent-foreground: 0 0% 100%;

    /* Primary can also use coral for buttons */
    --primary: 12 76% 61%;
    --primary-foreground: 0 0% 100%;
  }
}
```

3. Add initial components including new October 2025 components:
```bash
bunx shadcn@latest add button card badge input spinner
```

4. Update `app/routes/index.tsx` with a landing page using Lyra aesthetic:
```typescript
import { createFileRoute, Link } from "@tanstack/react-router";
import { Button } from "@/components/ui/button";

export const Route = createFileRoute("/")({
  component: Home,
});

function Home() {
  return (
    <main className="min-h-screen bg-slate-50">
      <div className="container mx-auto px-4 py-16">
        <div className="max-w-2xl mx-auto text-center">
          <h1 className="text-4xl font-bold text-slate-900 mb-4 font-mono tracking-tight">
            AI Safety Talent Network
          </h1>
          <p className="text-lg text-slate-600 mb-8">
            Find opportunities in AI safety research, policy, and engineering.
          </p>
          <Button asChild size="lg" className="transition-transform hover:scale-[1.02] active:scale-[0.98]">
            <Link to="/opportunities">Browse Opportunities</Link>
          </Button>
        </div>
      </div>
    </main>
  );
}
```

The Lyra style gives us boxy/sharp geometry that conveys technical precision. The coral accent adds warmth to the light theme. Subtle motion (scale on hover) adds dynamism.
  </action>
  <verify>
`ls app/components/ui/` shows button.tsx, card.tsx, badge.tsx, input.tsx exist.
`bun dev` and visit http://localhost:3000 shows styled landing page.
CSS variables include coral accent color (--accent: 12 76% 61%).
  </verify>
  <done>shadcn/ui configured with Lyra style, coral accent, new components, and landing page with tasteful motion.</done>
</task>

</tasks>

<verification>
Run these commands to verify plan completion:

```bash
# TypeScript compiles
bun tsc --noEmit

# Dev server starts
bun dev
# Visit http://localhost:3000 - should show landing page

# Convex connected (in separate terminal)
bunx convex dev
# Should show "Convex functions ready"

# All expected files exist
ls convex/schema.ts
ls convex/auth.ts
ls app/lib/convex.ts
ls app/routes/__root.tsx
ls app/routes/index.tsx
ls app/components/ui/button.tsx
```
</verification>

<success_criteria>
- TanStack Start dev server runs without errors
- Landing page renders at localhost:3000
- Convex dashboard shows connected project with schema
- TypeScript compiles without errors
- shadcn/ui components available for use
- TanStack Router file-based routing works
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-opportunities/01-01-SUMMARY.md`
</output>
