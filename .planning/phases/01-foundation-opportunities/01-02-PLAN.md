---
phase: 01-foundation-opportunities
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - convex/schema.ts
  - convex/opportunities.ts
  - convex/admin.ts
  - src/app/admin/layout.tsx
  - src/app/admin/page.tsx
  - src/app/admin/opportunities/page.tsx
  - src/app/admin/opportunities/new/page.tsx
  - src/app/admin/opportunities/[id]/edit/page.tsx
  - src/components/admin/opportunity-form.tsx
autonomous: true

must_haves:
  truths:
    - "Admin can view list of all opportunities at /admin/opportunities"
    - "Admin can create a new opportunity via form"
    - "Admin can edit an existing opportunity"
    - "Admin can delete an opportunity"
    - "Opportunities persist in Convex database"
  artifacts:
    - path: "convex/schema.ts"
      provides: "Opportunity table definition"
      contains: "opportunities"
    - path: "convex/opportunities.ts"
      provides: "Queries for listing and getting opportunities"
      exports: ["list", "get", "search"]
    - path: "convex/admin.ts"
      provides: "Admin mutations for CRUD"
      exports: ["createOpportunity", "updateOpportunity", "deleteOpportunity"]
    - path: "src/app/admin/opportunities/page.tsx"
      provides: "Admin opportunity list view"
      min_lines: 30
    - path: "src/components/admin/opportunity-form.tsx"
      provides: "Reusable form for create/edit"
      min_lines: 50
  key_links:
    - from: "src/app/admin/opportunities/page.tsx"
      to: "convex/opportunities.ts"
      via: "useQuery hook"
      pattern: "useQuery.*api\\.opportunities"
    - from: "src/components/admin/opportunity-form.tsx"
      to: "convex/admin.ts"
      via: "useMutation hook"
      pattern: "useMutation.*api\\.admin"
---

<objective>
Create the opportunity data model in Convex and build the admin CRUD interface for manual opportunity management.

Purpose: Enables admin to manually add/edit opportunities (OPPS-05) and establishes the data foundation for aggregation and browsing.

Output: Working admin interface at /admin/opportunities with full CRUD operations backed by Convex.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation-opportunities/CONTEXT.md
@.planning/phases/01-foundation-opportunities/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Define opportunity schema and indexes</name>
  <files>
    convex/schema.ts
  </files>
  <action>
Create the full opportunity schema based on research doc Pattern 5. Replace placeholder schema:

```typescript
// convex/schema.ts
import { defineSchema, defineTable } from "convex/server";
import { v } from "convex/values";

export default defineSchema({
  opportunities: defineTable({
    // Identity
    sourceId: v.string(), // Unique per source: "80k-123", "aisafety-abc", "manual-uuid"
    source: v.union(
      v.literal("80k_hours"),
      v.literal("aisafety_com"),
      v.literal("manual")
    ),

    // Core fields
    title: v.string(),
    organization: v.string(),
    organizationLogoUrl: v.optional(v.string()),
    location: v.string(),
    isRemote: v.boolean(),
    roleType: v.string(), // "research", "engineering", "operations", "policy", "other"
    experienceLevel: v.optional(v.string()), // "entry", "mid", "senior", "lead"
    description: v.string(),
    requirements: v.optional(v.array(v.string())),
    salaryRange: v.optional(v.string()),
    deadline: v.optional(v.number()), // Unix timestamp

    // Source tracking
    sourceUrl: v.string(),
    alternateSources: v.optional(
      v.array(
        v.object({
          sourceId: v.string(),
          source: v.string(),
          sourceUrl: v.string(),
        })
      )
    ),

    // Status and timestamps
    status: v.union(v.literal("active"), v.literal("archived")),
    lastVerified: v.number(), // For freshness indicator (OPPS-06)
    createdAt: v.number(),
    updatedAt: v.number(),
  })
    .index("by_source_id", ["sourceId"])
    .index("by_organization", ["organization"])
    .index("by_status", ["status"])
    .index("by_role_type", ["roleType", "status"])
    .index("by_location", ["isRemote", "status"])
    .searchIndex("search_title", {
      searchField: "title",
      filterFields: ["status", "roleType", "isRemote"],
    }),
});
```

Run `pnpm convex dev` to push schema to Convex.
  </action>
  <verify>
`pnpm convex dev` completes without schema errors.
Convex dashboard shows "opportunities" table in Data tab.
  </verify>
  <done>Opportunity table defined with all indexes for efficient querying.</done>
</task>

<task type="auto">
  <name>Task 2: Create opportunity queries and admin mutations</name>
  <files>
    convex/opportunities.ts
    convex/admin.ts
  </files>
  <action>
1. Create `convex/opportunities.ts` with public queries:

```typescript
import { query } from "./_generated/server";
import { v } from "convex/values";

// List active opportunities with optional filters
export const list = query({
  args: {
    roleType: v.optional(v.string()),
    isRemote: v.optional(v.boolean()),
    limit: v.optional(v.number()),
  },
  handler: async (ctx, args) => {
    const limit = args.limit || 50;

    let q = ctx.db.query("opportunities");

    if (args.roleType) {
      q = q.withIndex("by_role_type", (q) =>
        q.eq("roleType", args.roleType!).eq("status", "active")
      );
    } else if (args.isRemote !== undefined) {
      q = q.withIndex("by_location", (q) =>
        q.eq("isRemote", args.isRemote!).eq("status", "active")
      );
    } else {
      q = q.withIndex("by_status", (q) => q.eq("status", "active"));
    }

    return await q.take(limit);
  },
});

// Get single opportunity by ID
export const get = query({
  args: { id: v.id("opportunities") },
  handler: async (ctx, args) => {
    return await ctx.db.get(args.id);
  },
});

// Search opportunities by title (uses search index)
export const search = query({
  args: {
    searchTerm: v.string(),
    roleType: v.optional(v.string()),
    isRemote: v.optional(v.boolean()),
    limit: v.optional(v.number()),
  },
  handler: async (ctx, args) => {
    const limit = args.limit || 20;

    let searchQuery = ctx.db
      .query("opportunities")
      .withSearchIndex("search_title", (q) => {
        let search = q.search("title", args.searchTerm);
        search = search.eq("status", "active");
        if (args.roleType) search = search.eq("roleType", args.roleType);
        if (args.isRemote !== undefined) search = search.eq("isRemote", args.isRemote);
        return search;
      });

    return await searchQuery.take(limit);
  },
});

// List all opportunities for admin (including archived)
export const listAll = query({
  args: {
    includeArchived: v.optional(v.boolean()),
  },
  handler: async (ctx, args) => {
    if (args.includeArchived) {
      return await ctx.db.query("opportunities").collect();
    }
    return await ctx.db
      .query("opportunities")
      .withIndex("by_status", (q) => q.eq("status", "active"))
      .collect();
  },
});
```

2. Create `convex/admin.ts` with mutations:

```typescript
import { mutation } from "./_generated/server";
import { v } from "convex/values";

// Create a new opportunity (manual entry)
export const createOpportunity = mutation({
  args: {
    title: v.string(),
    organization: v.string(),
    organizationLogoUrl: v.optional(v.string()),
    location: v.string(),
    isRemote: v.boolean(),
    roleType: v.string(),
    experienceLevel: v.optional(v.string()),
    description: v.string(),
    requirements: v.optional(v.array(v.string())),
    salaryRange: v.optional(v.string()),
    deadline: v.optional(v.number()),
    sourceUrl: v.string(),
  },
  handler: async (ctx, args) => {
    const now = Date.now();
    const sourceId = `manual-${crypto.randomUUID()}`;

    return await ctx.db.insert("opportunities", {
      ...args,
      sourceId,
      source: "manual",
      status: "active",
      lastVerified: now,
      createdAt: now,
      updatedAt: now,
    });
  },
});

// Update an existing opportunity
export const updateOpportunity = mutation({
  args: {
    id: v.id("opportunities"),
    title: v.optional(v.string()),
    organization: v.optional(v.string()),
    organizationLogoUrl: v.optional(v.string()),
    location: v.optional(v.string()),
    isRemote: v.optional(v.boolean()),
    roleType: v.optional(v.string()),
    experienceLevel: v.optional(v.string()),
    description: v.optional(v.string()),
    requirements: v.optional(v.array(v.string())),
    salaryRange: v.optional(v.string()),
    deadline: v.optional(v.number()),
    sourceUrl: v.optional(v.string()),
    status: v.optional(v.union(v.literal("active"), v.literal("archived"))),
  },
  handler: async (ctx, args) => {
    const { id, ...updates } = args;

    // Remove undefined values
    const cleanUpdates = Object.fromEntries(
      Object.entries(updates).filter(([_, v]) => v !== undefined)
    );

    await ctx.db.patch(id, {
      ...cleanUpdates,
      updatedAt: Date.now(),
    });

    return await ctx.db.get(id);
  },
});

// Delete an opportunity
export const deleteOpportunity = mutation({
  args: { id: v.id("opportunities") },
  handler: async (ctx, args) => {
    await ctx.db.delete(args.id);
  },
});

// Archive an opportunity (soft delete)
export const archiveOpportunity = mutation({
  args: { id: v.id("opportunities") },
  handler: async (ctx, args) => {
    await ctx.db.patch(args.id, {
      status: "archived",
      updatedAt: Date.now(),
    });
  },
});
```
  </action>
  <verify>
`pnpm convex dev` shows functions deployed without errors.
Convex dashboard Functions tab shows opportunities.list, opportunities.get, admin.createOpportunity, etc.
  </verify>
  <done>All CRUD operations available via Convex functions.</done>
</task>

<task type="auto">
  <name>Task 3: Build admin layout and opportunity list page</name>
  <files>
    src/app/admin/layout.tsx
    src/app/admin/page.tsx
    src/app/admin/opportunities/page.tsx
  </files>
  <action>
1. Create admin layout at `src/app/admin/layout.tsx`:

```typescript
import Link from "next/link";
import { Button } from "@/components/ui/button";

export default function AdminLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <div className="min-h-screen bg-slate-50">
      <header className="border-b bg-white">
        <div className="container mx-auto px-4 py-4 flex items-center justify-between">
          <div className="flex items-center gap-6">
            <Link href="/admin" className="font-semibold text-slate-900">
              ASTN Admin
            </Link>
            <nav className="flex gap-4">
              <Link
                href="/admin/opportunities"
                className="text-sm text-slate-600 hover:text-slate-900"
              >
                Opportunities
              </Link>
            </nav>
          </div>
          <Button variant="outline" size="sm" asChild>
            <Link href="/">View Site</Link>
          </Button>
        </div>
      </header>
      <main className="container mx-auto px-4 py-8">{children}</main>
    </div>
  );
}
```

2. Create admin dashboard at `src/app/admin/page.tsx`:

```typescript
import Link from "next/link";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";

export default function AdminDashboard() {
  return (
    <div>
      <h1 className="text-2xl font-bold text-slate-900 mb-6">Admin Dashboard</h1>
      <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
        <Link href="/admin/opportunities">
          <Card className="hover:shadow-md transition-shadow cursor-pointer">
            <CardHeader>
              <CardTitle className="text-lg">Opportunities</CardTitle>
            </CardHeader>
            <CardContent>
              <p className="text-sm text-slate-600">
                Manage job opportunities, add new listings, edit existing ones.
              </p>
            </CardContent>
          </Card>
        </Link>
      </div>
    </div>
  );
}
```

3. Create opportunity list at `src/app/admin/opportunities/page.tsx`:

```typescript
"use client";

import { useQuery, useMutation } from "convex/react";
import { api } from "../../../../convex/_generated/api";
import Link from "next/link";
import { Button } from "@/components/ui/button";
import { Card, CardContent } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Trash2, Pencil, Plus, Archive } from "lucide-react";
import { formatDistanceToNow } from "date-fns";

export default function AdminOpportunitiesPage() {
  const opportunities = useQuery(api.opportunities.listAll, {
    includeArchived: true,
  });
  const deleteOpportunity = useMutation(api.admin.deleteOpportunity);
  const archiveOpportunity = useMutation(api.admin.archiveOpportunity);

  if (opportunities === undefined) {
    return <div className="text-slate-600">Loading...</div>;
  }

  return (
    <div>
      <div className="flex items-center justify-between mb-6">
        <h1 className="text-2xl font-bold text-slate-900">Opportunities</h1>
        <Button asChild>
          <Link href="/admin/opportunities/new">
            <Plus className="w-4 h-4 mr-2" />
            Add Opportunity
          </Link>
        </Button>
      </div>

      {opportunities.length === 0 ? (
        <Card>
          <CardContent className="py-8 text-center text-slate-600">
            No opportunities yet. Add your first one!
          </CardContent>
        </Card>
      ) : (
        <div className="space-y-3">
          {opportunities.map((opp) => (
            <Card key={opp._id} className={opp.status === "archived" ? "opacity-60" : ""}>
              <CardContent className="py-4">
                <div className="flex items-start justify-between">
                  <div className="flex-1">
                    <div className="flex items-center gap-2 mb-1">
                      <h3 className="font-medium text-slate-900">{opp.title}</h3>
                      <Badge variant={opp.status === "active" ? "default" : "secondary"}>
                        {opp.status}
                      </Badge>
                      <Badge variant="outline">{opp.source}</Badge>
                    </div>
                    <p className="text-sm text-slate-600">
                      {opp.organization} • {opp.location}
                      {opp.isRemote && " • Remote"}
                    </p>
                    <p className="text-xs text-slate-500 mt-1">
                      Last verified: {formatDistanceToNow(opp.lastVerified, { addSuffix: true })}
                    </p>
                  </div>
                  <div className="flex items-center gap-2">
                    <Button variant="ghost" size="sm" asChild>
                      <Link href={`/admin/opportunities/${opp._id}/edit`}>
                        <Pencil className="w-4 h-4" />
                      </Link>
                    </Button>
                    {opp.status === "active" && (
                      <Button
                        variant="ghost"
                        size="sm"
                        onClick={() => archiveOpportunity({ id: opp._id })}
                      >
                        <Archive className="w-4 h-4" />
                      </Button>
                    )}
                    <Button
                      variant="ghost"
                      size="sm"
                      onClick={() => {
                        if (confirm("Delete this opportunity?")) {
                          deleteOpportunity({ id: opp._id });
                        }
                      }}
                    >
                      <Trash2 className="w-4 h-4 text-red-500" />
                    </Button>
                  </div>
                </div>
              </CardContent>
            </Card>
          ))}
        </div>
      )}
    </div>
  );
}
```

Install date-fns for formatting:
```bash
pnpm add date-fns
```
  </action>
  <verify>
Visit http://localhost:3000/admin - shows dashboard.
Visit http://localhost:3000/admin/opportunities - shows empty state or list.
  </verify>
  <done>Admin section with opportunity listing working.</done>
</task>

<task type="auto">
  <name>Task 4: Build opportunity form and create/edit pages</name>
  <files>
    src/components/admin/opportunity-form.tsx
    src/app/admin/opportunities/new/page.tsx
    src/app/admin/opportunities/[id]/edit/page.tsx
  </files>
  <action>
1. Add form components:
```bash
pnpm dlx shadcn@latest add label textarea select checkbox
```

2. Create reusable form at `src/components/admin/opportunity-form.tsx`:

```typescript
"use client";

import { useState } from "react";
import { useRouter } from "next/navigation";
import { useMutation } from "convex/react";
import { api } from "../../../convex/_generated/api";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Textarea } from "@/components/ui/textarea";
import { Checkbox } from "@/components/ui/checkbox";
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "@/components/ui/select";
import { Id } from "../../../convex/_generated/dataModel";

const ROLE_TYPES = [
  { value: "research", label: "Research" },
  { value: "engineering", label: "Engineering" },
  { value: "operations", label: "Operations" },
  { value: "policy", label: "Policy" },
  { value: "other", label: "Other" },
];

const EXPERIENCE_LEVELS = [
  { value: "entry", label: "Entry Level" },
  { value: "mid", label: "Mid Level" },
  { value: "senior", label: "Senior" },
  { value: "lead", label: "Lead / Principal" },
];

type OpportunityData = {
  _id?: Id<"opportunities">;
  title: string;
  organization: string;
  organizationLogoUrl?: string;
  location: string;
  isRemote: boolean;
  roleType: string;
  experienceLevel?: string;
  description: string;
  requirements?: string[];
  salaryRange?: string;
  deadline?: number;
  sourceUrl: string;
};

export function OpportunityForm({
  initialData,
  mode,
}: {
  initialData?: OpportunityData;
  mode: "create" | "edit";
}) {
  const router = useRouter();
  const createOpportunity = useMutation(api.admin.createOpportunity);
  const updateOpportunity = useMutation(api.admin.updateOpportunity);

  const [formData, setFormData] = useState({
    title: initialData?.title || "",
    organization: initialData?.organization || "",
    organizationLogoUrl: initialData?.organizationLogoUrl || "",
    location: initialData?.location || "",
    isRemote: initialData?.isRemote || false,
    roleType: initialData?.roleType || "research",
    experienceLevel: initialData?.experienceLevel || "",
    description: initialData?.description || "",
    requirementsText: initialData?.requirements?.join("\n") || "",
    salaryRange: initialData?.salaryRange || "",
    deadlineStr: initialData?.deadline
      ? new Date(initialData.deadline).toISOString().split("T")[0]
      : "",
    sourceUrl: initialData?.sourceUrl || "",
  });

  const [isSubmitting, setIsSubmitting] = useState(false);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setIsSubmitting(true);

    try {
      const requirements = formData.requirementsText
        .split("\n")
        .map((r) => r.trim())
        .filter(Boolean);

      const deadline = formData.deadlineStr
        ? new Date(formData.deadlineStr).getTime()
        : undefined;

      const data = {
        title: formData.title,
        organization: formData.organization,
        organizationLogoUrl: formData.organizationLogoUrl || undefined,
        location: formData.location,
        isRemote: formData.isRemote,
        roleType: formData.roleType,
        experienceLevel: formData.experienceLevel || undefined,
        description: formData.description,
        requirements: requirements.length > 0 ? requirements : undefined,
        salaryRange: formData.salaryRange || undefined,
        deadline,
        sourceUrl: formData.sourceUrl,
      };

      if (mode === "create") {
        await createOpportunity(data);
      } else if (initialData?._id) {
        await updateOpportunity({ id: initialData._id, ...data });
      }

      router.push("/admin/opportunities");
    } catch (error) {
      console.error("Error saving opportunity:", error);
      alert("Failed to save opportunity");
    } finally {
      setIsSubmitting(false);
    }
  };

  return (
    <form onSubmit={handleSubmit} className="space-y-6 max-w-2xl">
      <div className="space-y-2">
        <Label htmlFor="title">Title *</Label>
        <Input
          id="title"
          value={formData.title}
          onChange={(e) => setFormData({ ...formData, title: e.target.value })}
          placeholder="Research Engineer - AI Safety"
          required
        />
      </div>

      <div className="grid grid-cols-2 gap-4">
        <div className="space-y-2">
          <Label htmlFor="organization">Organization *</Label>
          <Input
            id="organization"
            value={formData.organization}
            onChange={(e) =>
              setFormData({ ...formData, organization: e.target.value })
            }
            placeholder="Anthropic"
            required
          />
        </div>
        <div className="space-y-2">
          <Label htmlFor="organizationLogoUrl">Logo URL</Label>
          <Input
            id="organizationLogoUrl"
            value={formData.organizationLogoUrl}
            onChange={(e) =>
              setFormData({ ...formData, organizationLogoUrl: e.target.value })
            }
            placeholder="https://cdn.brandfetch.io/..."
          />
        </div>
      </div>

      <div className="grid grid-cols-2 gap-4">
        <div className="space-y-2">
          <Label htmlFor="location">Location *</Label>
          <Input
            id="location"
            value={formData.location}
            onChange={(e) =>
              setFormData({ ...formData, location: e.target.value })
            }
            placeholder="San Francisco, CA"
            required
          />
        </div>
        <div className="flex items-center space-x-2 pt-8">
          <Checkbox
            id="isRemote"
            checked={formData.isRemote}
            onCheckedChange={(checked) =>
              setFormData({ ...formData, isRemote: checked === true })
            }
          />
          <Label htmlFor="isRemote">Remote friendly</Label>
        </div>
      </div>

      <div className="grid grid-cols-2 gap-4">
        <div className="space-y-2">
          <Label htmlFor="roleType">Role Type *</Label>
          <Select
            value={formData.roleType}
            onValueChange={(value) =>
              setFormData({ ...formData, roleType: value })
            }
          >
            <SelectTrigger>
              <SelectValue />
            </SelectTrigger>
            <SelectContent>
              {ROLE_TYPES.map((type) => (
                <SelectItem key={type.value} value={type.value}>
                  {type.label}
                </SelectItem>
              ))}
            </SelectContent>
          </Select>
        </div>
        <div className="space-y-2">
          <Label htmlFor="experienceLevel">Experience Level</Label>
          <Select
            value={formData.experienceLevel}
            onValueChange={(value) =>
              setFormData({ ...formData, experienceLevel: value })
            }
          >
            <SelectTrigger>
              <SelectValue placeholder="Select level" />
            </SelectTrigger>
            <SelectContent>
              {EXPERIENCE_LEVELS.map((level) => (
                <SelectItem key={level.value} value={level.value}>
                  {level.label}
                </SelectItem>
              ))}
            </SelectContent>
          </Select>
        </div>
      </div>

      <div className="space-y-2">
        <Label htmlFor="description">Description *</Label>
        <Textarea
          id="description"
          value={formData.description}
          onChange={(e) =>
            setFormData({ ...formData, description: e.target.value })
          }
          placeholder="Full job description..."
          rows={6}
          required
        />
      </div>

      <div className="space-y-2">
        <Label htmlFor="requirements">Requirements (one per line)</Label>
        <Textarea
          id="requirements"
          value={formData.requirementsText}
          onChange={(e) =>
            setFormData({ ...formData, requirementsText: e.target.value })
          }
          placeholder="PhD in ML or equivalent&#10;3+ years experience&#10;Strong communication skills"
          rows={4}
        />
      </div>

      <div className="grid grid-cols-2 gap-4">
        <div className="space-y-2">
          <Label htmlFor="salaryRange">Salary Range</Label>
          <Input
            id="salaryRange"
            value={formData.salaryRange}
            onChange={(e) =>
              setFormData({ ...formData, salaryRange: e.target.value })
            }
            placeholder="$150,000 - $200,000"
          />
        </div>
        <div className="space-y-2">
          <Label htmlFor="deadline">Application Deadline</Label>
          <Input
            id="deadline"
            type="date"
            value={formData.deadlineStr}
            onChange={(e) =>
              setFormData({ ...formData, deadlineStr: e.target.value })
            }
          />
        </div>
      </div>

      <div className="space-y-2">
        <Label htmlFor="sourceUrl">Application URL *</Label>
        <Input
          id="sourceUrl"
          type="url"
          value={formData.sourceUrl}
          onChange={(e) =>
            setFormData({ ...formData, sourceUrl: e.target.value })
          }
          placeholder="https://company.com/careers/job-123"
          required
        />
      </div>

      <div className="flex gap-4">
        <Button type="submit" disabled={isSubmitting}>
          {isSubmitting
            ? "Saving..."
            : mode === "create"
              ? "Create Opportunity"
              : "Save Changes"}
        </Button>
        <Button
          type="button"
          variant="outline"
          onClick={() => router.push("/admin/opportunities")}
        >
          Cancel
        </Button>
      </div>
    </form>
  );
}
```

3. Create new opportunity page at `src/app/admin/opportunities/new/page.tsx`:

```typescript
import { OpportunityForm } from "@/components/admin/opportunity-form";

export default function NewOpportunityPage() {
  return (
    <div>
      <h1 className="text-2xl font-bold text-slate-900 mb-6">
        Add New Opportunity
      </h1>
      <OpportunityForm mode="create" />
    </div>
  );
}
```

4. Create edit page at `src/app/admin/opportunities/[id]/edit/page.tsx`:

```typescript
"use client";

import { use } from "react";
import { useQuery } from "convex/react";
import { api } from "../../../../../../convex/_generated/api";
import { OpportunityForm } from "@/components/admin/opportunity-form";
import { Id } from "../../../../../../convex/_generated/dataModel";

export default function EditOpportunityPage({
  params,
}: {
  params: Promise<{ id: string }>;
}) {
  const { id } = use(params);
  const opportunity = useQuery(api.opportunities.get, {
    id: id as Id<"opportunities">,
  });

  if (opportunity === undefined) {
    return <div className="text-slate-600">Loading...</div>;
  }

  if (opportunity === null) {
    return <div className="text-red-600">Opportunity not found</div>;
  }

  return (
    <div>
      <h1 className="text-2xl font-bold text-slate-900 mb-6">
        Edit Opportunity
      </h1>
      <OpportunityForm
        mode="edit"
        initialData={{
          ...opportunity,
          requirements: opportunity.requirements || undefined,
          deadline: opportunity.deadline || undefined,
        }}
      />
    </div>
  );
}
```
  </action>
  <verify>
Visit http://localhost:3000/admin/opportunities/new - form displays.
Fill form and submit - opportunity appears in list.
Click edit - form pre-populated with existing data.
Save changes - updates reflected in list.
  </verify>
  <done>Full CRUD workflow working: create, read, update, delete opportunities via admin UI.</done>
</task>

</tasks>

<verification>
Run these commands/checks to verify plan completion:

```bash
# Functions deployed
pnpm convex dev
# Should show opportunities.ts and admin.ts functions

# Manual test workflow:
# 1. Visit /admin/opportunities
# 2. Click "Add Opportunity"
# 3. Fill form with test data
# 4. Submit - should redirect to list with new item
# 5. Click edit icon - form shows existing data
# 6. Change title, save - list shows updated title
# 7. Click archive - status changes to archived
# 8. Click delete - item removed
```

Check Convex dashboard Data tab - opportunities should be visible.
</verification>

<success_criteria>
- Opportunity schema deployed to Convex with all indexes
- Admin can list all opportunities at /admin/opportunities
- Admin can create opportunity via form (OPPS-05)
- Admin can edit existing opportunities (OPPS-05)
- Admin can archive/delete opportunities
- lastVerified timestamp present for freshness (OPPS-06)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-opportunities/01-02-SUMMARY.md`
</output>
