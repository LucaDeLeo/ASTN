---
phase: 02-authentication
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/router.tsx
  - convex/auth.ts
  - src/components/ui/tabs.tsx
  - src/components/ui/avatar.tsx
  - src/components/ui/dropdown-menu.tsx
  - src/components/ui/separator.tsx
autonomous: false

user_setup:
  - service: google-oauth
    why: 'Google sign-in for users'
    env_vars:
      - name: AUTH_GOOGLE_ID
        source: 'Google Cloud Console -> APIs & Services -> Credentials -> OAuth 2.0 Client ID'
      - name: AUTH_GOOGLE_SECRET
        source: 'Google Cloud Console -> APIs & Services -> Credentials -> OAuth 2.0 Client Secret'
    dashboard_config:
      - task: 'Create OAuth 2.0 Client ID (Web application type)'
        location: 'Google Cloud Console -> APIs & Services -> Credentials'
      - task: 'Add authorized redirect URI: https://<deployment>.convex.site/api/auth/callback/google'
        location: 'OAuth client -> Authorized redirect URIs'
  - service: github-oauth
    why: 'GitHub sign-in for users'
    env_vars:
      - name: AUTH_GITHUB_ID
        source: 'GitHub -> Settings -> Developer settings -> OAuth Apps -> Client ID'
      - name: AUTH_GITHUB_SECRET
        source: 'GitHub -> Settings -> Developer settings -> OAuth Apps -> Client secrets'
    dashboard_config:
      - task: 'Create new OAuth App'
        location: 'GitHub -> Settings -> Developer settings -> OAuth Apps'
      - task: 'Set Authorization callback URL: https://<deployment>.convex.site/api/auth/callback/github'
        location: 'OAuth App settings'

must_haves:
  truths:
    - 'App loads with ConvexAuthProvider wrapper'
    - 'Password validation enforces 8+ chars, mixed case, number'
    - 'OAuth credentials configured in Convex environment'
  artifacts:
    - path: 'src/router.tsx'
      provides: 'ConvexAuthProvider wrapper for auth state'
      contains: 'ConvexAuthProvider'
    - path: 'convex/auth.ts'
      provides: 'Password validation rules'
      contains: 'validatePasswordRequirements'
    - path: 'src/components/ui/tabs.tsx'
      provides: 'Tabs component for sign-in/sign-up toggle'
    - path: 'src/components/ui/avatar.tsx'
      provides: 'Avatar component for user display'
    - path: 'src/components/ui/dropdown-menu.tsx'
      provides: 'Dropdown menu for header actions'
  key_links:
    - from: 'src/router.tsx'
      to: '@convex-dev/auth/react'
      via: 'ConvexAuthProvider import'
      pattern: 'ConvexAuthProvider.*client='
---

<objective>
Set up auth infrastructure by installing shadcn UI components, updating to ConvexAuthProvider, adding password validation, and configuring OAuth credentials.

Purpose: Establishes the foundation for authentication - without ConvexAuthProvider, auth hooks won't work. Without OAuth credentials, OAuth sign-in will fail.

Output: Working auth provider setup with OAuth credentials ready for login UI.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-authentication/02-RESEARCH.md
@.planning/phases/02-authentication/02-CONTEXT.md
@src/router.tsx
@convex/auth.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install shadcn components and update to ConvexAuthProvider</name>
  <files>
    src/router.tsx
    convex/auth.ts
    src/components/ui/tabs.tsx
    src/components/ui/avatar.tsx
    src/components/ui/dropdown-menu.tsx
    src/components/ui/separator.tsx
  </files>
  <action>
    1. Install required shadcn/ui components:
       ```bash
       npx shadcn@latest add tabs avatar dropdown-menu separator
       ```

    2. Update `src/router.tsx`:
       - Change import from `ConvexProvider` to `ConvexAuthProvider`
       - Import: `import { ConvexAuthProvider } from "@convex-dev/auth/react";`
       - Replace `<ConvexProvider client={...}>` with `<ConvexAuthProvider client={...}>`

    3. Update `convex/auth.ts` to add password validation:
       ```typescript
       import { ConvexError } from "convex/values";

       Password({
         validatePasswordRequirements: (password: string) => {
           if (password.length < 8) {
             throw new ConvexError("Password must be at least 8 characters");
           }
           if (!/[a-z]/.test(password)) {
             throw new ConvexError("Password must contain a lowercase letter");
           }
           if (!/[A-Z]/.test(password)) {
             throw new ConvexError("Password must contain an uppercase letter");
           }
           if (!/\d/.test(password)) {
             throw new ConvexError("Password must contain a number");
           }
         },
       })
       ```

    4. Verify the app still loads without errors

  </action>
  <verify>
    - `bun run dev` starts without errors
    - App loads in browser at localhost:3000
    - No console errors about ConvexAuthProvider
    - `bunx convex dev --once` succeeds (auth.ts changes are valid)
  </verify>
  <done>
    - ConvexAuthProvider wraps the app instead of ConvexProvider
    - Password validation rules enforce 8+ chars, mixed case, number
    - All shadcn components (tabs, avatar, dropdown-menu, separator) installed
  </done>
</task>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 2: Configure OAuth credentials</name>
  <action>
    User must configure OAuth credentials in external dashboards. Claude cannot access user's Google/GitHub accounts.
  </action>
  <instructions>
    **Find your Convex HTTP Actions URL:**
    1. Run: `npx convex dashboard` or visit https://dashboard.convex.dev
    2. Go to Settings -> URL & Deploy Key
    3. Copy the "HTTP Actions URL" (ends in `.convex.site`, NOT `.convex.cloud`)

    **Google OAuth Setup:**
    1. Go to https://console.cloud.google.com
    2. Create project or select existing
    3. APIs & Services -> Credentials -> Create Credentials -> OAuth client ID
    4. Application type: Web application
    5. Add Authorized redirect URI: `https://<your-deployment>.convex.site/api/auth/callback/google`
    6. Copy Client ID and Client Secret
    7. Run:
       ```bash
       npx convex env set AUTH_GOOGLE_ID <client_id>
       npx convex env set AUTH_GOOGLE_SECRET <client_secret>
       ```

    **GitHub OAuth Setup:**
    1. Go to https://github.com/settings/developers
    2. OAuth Apps -> New OAuth App
    3. Application name: ASTN (or your preference)
    4. Homepage URL: http://localhost:3000 (or your domain)
    5. Authorization callback URL: `https://<your-deployment>.convex.site/api/auth/callback/github`
    6. Register application, then generate Client Secret
    7. Run:
       ```bash
       npx convex env set AUTH_GITHUB_ID <client_id>
       npx convex env set AUTH_GITHUB_SECRET <client_secret>
       ```

  </instructions>
  <resume-signal>Type "credentials configured" when both Google and GitHub OAuth are set up</resume-signal>
</task>

</tasks>

<verification>
After both tasks complete:
1. App loads without errors
2. `npx convex env list` shows AUTH_GOOGLE_ID, AUTH_GOOGLE_SECRET, AUTH_GITHUB_ID, AUTH_GITHUB_SECRET
3. convex/auth.ts includes validatePasswordRequirements function
</verification>

<success_criteria>

- ConvexAuthProvider wraps app (visible in router.tsx)
- Password validation rules active in convex/auth.ts
- OAuth credentials set in Convex environment
- All shadcn auth components installed (tabs, avatar, dropdown-menu, separator)
  </success_criteria>

<output>
After completion, create `.planning/phases/02-authentication/02-01-SUMMARY.md`
</output>
