---
phase: 02-authentication
plan: 02
type: execute
wave: 2
depends_on: [02-01]
files_modified:
  - src/routes/login.tsx
  - src/components/auth/oauth-buttons.tsx
  - src/components/auth/password-form.tsx
  - src/components/auth/login-card.tsx
  - src/components/layout/auth-header.tsx
  - src/components/layout/public-header.tsx
  - src/routes/index.tsx
  - src/routes/opportunities/index.tsx
  - src/routes/opportunities/$id.tsx
autonomous: true

must_haves:
  truths:
    - 'User can create account with email and password'
    - 'User can sign in with email and password'
    - 'User can sign in with Google OAuth'
    - 'User can sign in with GitHub OAuth'
    - 'User stays logged in after browser refresh'
    - 'User sees Sign In button when not logged in'
    - 'User sees avatar dropdown when logged in'
    - 'User can log out via dropdown menu'
  artifacts:
    - path: 'src/routes/login.tsx'
      provides: 'Login page with combined sign-in/sign-up'
      min_lines: 80
    - path: 'src/components/auth/oauth-buttons.tsx'
      provides: 'Google and GitHub OAuth buttons'
      exports: ['OAuthButtons']
    - path: 'src/components/auth/password-form.tsx'
      provides: 'Email/password form with validation'
      exports: ['PasswordForm']
    - path: 'src/components/auth/login-card.tsx'
      provides: 'Login card container with styling'
      exports: ['LoginCard']
    - path: 'src/components/layout/auth-header.tsx'
      provides: 'Auth-aware header with avatar dropdown'
      exports: ['AuthHeader']
  key_links:
    - from: 'src/components/auth/oauth-buttons.tsx'
      to: '@convex-dev/auth/react'
      via: 'useAuthActions hook'
      pattern: 'signIn.*google|signIn.*github'
    - from: 'src/components/auth/password-form.tsx'
      to: '@convex-dev/auth/react'
      via: 'useAuthActions hook'
      pattern: 'signIn.*"password"'
    - from: 'src/components/layout/auth-header.tsx'
      to: 'convex/react'
      via: 'Authenticated/Unauthenticated components'
      pattern: '<Authenticated>|<Unauthenticated>'
    - from: 'src/routes/login.tsx'
      to: 'src/components/auth/login-card.tsx'
      via: 'component import'
      pattern: 'LoginCard'
---

<objective>
Build the login page with OAuth and email/password authentication, and update the header to show auth-aware state with avatar dropdown.

Purpose: Completes the user-facing authentication flow - users can sign up, sign in, and see their logged-in state in the header.

Output: Fully functional login page and auth-aware header.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-authentication/02-RESEARCH.md
@.planning/phases/02-authentication/02-CONTEXT.md
@.planning/phases/02-authentication/02-01-SUMMARY.md
@src/router.tsx
@src/components/layout/public-header.tsx
@src/styles/app.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create login page with OAuth and email/password</name>
  <files>
    src/routes/login.tsx
    src/components/auth/oauth-buttons.tsx
    src/components/auth/password-form.tsx
    src/components/auth/login-card.tsx
  </files>
  <action>
    **Create `src/components/auth/oauth-buttons.tsx`:**
    - Import `useAuthActions` from `@convex-dev/auth/react`
    - Two buttons: "Continue with Google", "Continue with GitHub"
    - Use branded styling: outline variant, full width
    - Include provider logos (can use simple SVG icons inline or lucide-react)
    - Each button calls `signIn("google")` or `signIn("github")`

    **Create `src/components/auth/password-form.tsx`:**
    - Import `useAuthActions` from `@convex-dev/auth/react`
    - Props: `flow: "signIn" | "signUp"`
    - Form with email and password inputs
    - On submit: create FormData, append flow, call `signIn("password", formData)`
    - Loading state with disabled button
    - Error state with message display (generic "Invalid email or password" per CONTEXT.md)
    - Error styling: muted coral/red blend, subtle shake animation (150ms, 2-3 oscillations)
    - Button text: "Sign In" or "Create Account" based on flow

    **Create `src/components/auth/login-card.tsx`:**
    - Container component with Card from shadcn/ui
    - Combines OAuthButtons + Separator ("or continue with email") + Tabs + PasswordForm
    - Tabs for Sign In / Sign Up toggle
    - Visual styling per CONTEXT.md:
      - Generous padding (40-48px)
      - Soft shadow with coral undertone
      - Rounded corners (12-16px)
      - Full-form frosted glass overlay during loading (backdrop-blur + coral tint at 80%)
    - Logo only above form (no tagline) - use site name "AI Safety Talent Network" or abbreviated "ASTN"

    **Create `src/routes/login.tsx`:**
    - Route at `/login`
    - Uses `Authenticated`, `Unauthenticated`, `AuthLoading` from `convex/react`
    - If authenticated: redirect to home (`/`)
    - If loading: show centered spinner or skeleton
    - If unauthenticated: show LoginCard
    - Background: subtle gradient (warm gray -> coral tint at edges)
    - Optional: very subtle noise grain texture (2-3% opacity)
    - Center the card vertically and horizontally

  </action>
  <verify>
    - `bun run dev` starts without errors
    - Navigate to `/login` shows login page
    - Sign In / Sign Up tabs toggle the form
    - OAuth buttons are visible with provider branding
    - Email/password form validates inputs
    - Already logged in? Redirects to home
  </verify>
  <done>
    - Login page renders at /login
    - OAuth buttons trigger Google/GitHub sign-in flows
    - Password form shows Sign In/Sign Up tabs
    - Visual styling matches CONTEXT.md decisions (frosted glass, coral accent, padding)
    - Authenticated users are redirected away from login page
  </done>
</task>

<task type="auto">
  <name>Task 2: Create auth-aware header with avatar dropdown</name>
  <files>
    src/components/layout/auth-header.tsx
    src/components/layout/public-header.tsx
    src/routes/index.tsx
    src/routes/opportunities/index.tsx
    src/routes/opportunities/$id.tsx
  </files>
  <action>
    **Create `src/components/layout/auth-header.tsx`:**
    - Import `Authenticated`, `Unauthenticated`, `AuthLoading` from `convex/react`
    - Import `useAuthActions` from `@convex-dev/auth/react`
    - Import Avatar, DropdownMenu components from shadcn/ui
    - Structure:
      - Logo/brand link (same as PublicHeader)
      - Navigation links (Opportunities, etc.)
      - Right side:
        - `AuthLoading`: Skeleton circle (8x8)
        - `Unauthenticated`: "Sign In" Button linking to `/login`
        - `Authenticated`: Avatar with DropdownMenu
    - Dropdown menu items:
      - Profile (links to `/profile` - can be placeholder for now)
      - Settings (links to `/settings` - can be placeholder for now)
      - Separator
      - Logout (calls `signOut()`)
    - Avatar: Use initials or default icon (user image will come with profile in Phase 3)

    **Update `src/components/layout/public-header.tsx`:**
    - Keep this component for truly public pages where we don't want auth UI
    - Or merge functionality - use AuthHeader everywhere and it handles both states

    **Recommendation:** Create AuthHeader as the new default header. Update all routes to use AuthHeader instead of PublicHeader. Keep PublicHeader for reference but it may be deprecated.

    **Update routes to use AuthHeader:**
    - `src/routes/index.tsx` - use AuthHeader
    - `src/routes/opportunities/index.tsx` - use AuthHeader
    - `src/routes/opportunities/$id.tsx` - use AuthHeader
    - Admin routes can keep their own header or use AuthHeader too

  </action>
  <verify>
    - Navigate to `/` and see header
    - When logged out: "Sign In" button visible, clicking goes to `/login`
    - When logged in: Avatar visible, clicking shows dropdown
    - Dropdown has Profile, Settings, Logout
    - Clicking Logout signs out and updates header to show "Sign In"
    - Session persists after page refresh (still logged in)
  </verify>
  <done>
    - AuthHeader component shows Sign In button when logged out
    - AuthHeader component shows avatar dropdown when logged in
    - Dropdown menu includes Profile, Settings, Logout options
    - Logout successfully signs out user
    - All public routes updated to use AuthHeader
    - Session persists across browser refresh (AUTH-04)
  </done>
</task>

</tasks>

<verification>
Full authentication flow test:

1. **Sign Up Flow:**
   - Go to `/login`
   - Click "Sign Up" tab
   - Enter email and password (8+ chars, mixed case, number)
   - Click "Create Account"
   - Should be logged in and redirected

2. **Sign In Flow:**
   - Log out via header dropdown
   - Go to `/login`
   - Enter credentials
   - Click "Sign In"
   - Should be logged in

3. **OAuth Flow (if credentials configured):**
   - Log out
   - Go to `/login`
   - Click "Continue with Google" or "Continue with GitHub"
   - Complete OAuth flow
   - Should be logged in

4. **Session Persistence:**
   - While logged in, refresh the page
   - Should still be logged in (avatar visible)
   - Close browser tab, reopen
   - Should still be logged in

5. **Header States:**
   - Logged out: "Sign In" button visible
   - Logged in: Avatar dropdown visible
   - Loading: Skeleton visible briefly
     </verification>

<success_criteria>

- AUTH-01: User can sign up and log in with Google OAuth (button exists, flow works if credentials set)
- AUTH-02: User can sign up and log in with GitHub OAuth (button exists, flow works if credentials set)
- AUTH-03: User can sign up and log in with email/password (form works, validation enforced)
- AUTH-04: User session persists across browser refresh (ConvexAuthProvider handles this)
- Header shows appropriate auth state (Sign In vs Avatar dropdown)
  </success_criteria>

<output>
After completion, create `.planning/phases/02-authentication/02-02-SUMMARY.md`
</output>
