---
phase: 03-profiles
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - convex/schema.ts
  - convex/profiles.ts
  - src/routes/profile/edit.tsx
  - src/routes/profile/index.tsx
  - src/components/profile/wizard/ProfileWizard.tsx
  - src/components/profile/wizard/WizardProgress.tsx
  - src/components/profile/wizard/steps/BasicInfoStep.tsx
  - src/components/profile/wizard/steps/EducationStep.tsx
  - src/components/profile/wizard/steps/WorkHistoryStep.tsx
  - src/components/profile/wizard/steps/GoalsStep.tsx
  - src/components/profile/wizard/steps/SkillsStep.tsx
  - src/components/profile/wizard/steps/EnrichmentStep.tsx
  - src/components/profile/wizard/steps/PrivacyStep.tsx
  - src/components/profile/wizard/hooks/useAutoSave.ts
  - src/components/layout/auth-header.tsx
autonomous: true

must_haves:
  truths:
    - 'User can enter and save basic info (name, pronouns, location, headline)'
    - 'User can add and edit education history entries'
    - 'User can add and edit work history entries'
    - "User can describe career goals and what they're seeking"
    - 'User sees profile completeness checklist with section status'
    - 'Profile data persists across page refresh'
  artifacts:
    - path: 'convex/schema.ts'
      provides: 'profiles, enrichmentMessages, enrichmentExtractions, skillsTaxonomy tables'
      contains: 'defineTable'
    - path: 'convex/profiles.ts'
      provides: 'Profile CRUD mutations and queries'
      exports: ['getOrCreateProfile', 'updateField', 'getCompleteness']
    - path: 'src/routes/profile/edit.tsx'
      provides: 'Profile wizard entry point with URL step sync'
      contains: 'validateSearch'
    - path: 'src/components/profile/wizard/ProfileWizard.tsx'
      provides: 'Multi-step wizard container with step navigation'
      min_lines: 50
  key_links:
    - from: 'src/routes/profile/edit.tsx'
      to: 'ProfileWizard'
      via: 'component import and render'
      pattern: 'ProfileWizard'
    - from: 'ProfileWizard.tsx'
      to: 'step components'
      via: 'conditional rendering based on currentStep'
      pattern: 'currentStep.*BasicInfoStep|EducationStep|WorkHistoryStep|GoalsStep'
    - from: 'step components'
      to: 'useAutoSave'
      via: 'onBlur handlers calling saveField'
      pattern: 'useAutoSave.*saveField.*onBlur'
---

<objective>
Create profile data model and multi-step wizard with basic form steps

Purpose: Enable users to enter their background information (basic info, education, work history, career goals) through an intuitive multi-step wizard with auto-save on blur.

Output:

- Convex schema with profiles table and supporting tables
- Profile wizard at /profile/edit with URL-synced steps
- Four functional form steps (BasicInfo, Education, Work, Goals)
- Stub components for Skills, Enrichment, Privacy (implemented in later plans)
- Completeness checklist showing section status
  </objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-profiles/03-CONTEXT.md
@.planning/phases/03-profiles/03-RESEARCH.md

Key decisions from CONTEXT.md:

- Multi-step wizard (not single page)
- Auto-save on blur with debounce
- Linear progression with "Skip for now" option
- Checklist of sections (not progress bar)

Schema from RESEARCH.md defines profiles table structure.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Profile schema and CRUD mutations</name>
  <files>
    - convex/schema.ts
    - convex/profiles.ts
  </files>
  <action>
Extend convex/schema.ts with new tables (keep existing opportunities table):

1. **profiles** table with fields from RESEARCH.md:
   - userId (string, indexed)
   - Basic info: name, pronouns, location, headline (all optional strings)
   - education: optional array of objects (institution, degree, field, startYear, endYear, current)
   - workHistory: optional array of objects (organization, title, startDate, endDate, current, description)
   - skills: optional array of strings
   - careerGoals, aiSafetyInterests (array), seeking: optional strings
   - enrichmentSummary: optional string
   - hasEnrichmentConversation: optional boolean
   - privacySettings: optional object with defaultVisibility, sectionVisibility, hiddenFromOrgs
   - completedSections: optional array of strings
   - createdAt, updatedAt: numbers
   - Index: by_user on userId

2. **enrichmentMessages** table:
   - profileId (id of profiles)
   - role: union of "user" | "assistant"
   - content: string
   - createdAt: number
   - Index: by_profile on [profileId, createdAt]

3. **enrichmentExtractions** table:
   - profileId (id of profiles)
   - field: string
   - extractedValue: string
   - status: union of "pending" | "accepted" | "rejected" | "edited"
   - editedValue: optional string
   - createdAt: number
   - Index: by_profile on profileId

4. **skillsTaxonomy** table:
   - name: string
   - category: string
   - description: optional string
   - aliases: optional array of strings
   - Indexes: by_category, searchIndex on name

Create convex/profiles.ts with:

- getOrCreateProfile query: Get profile by userId or create empty one
- updateField mutation: Update specific field(s) with timestamp
- getCompleteness query: Return sections array with isComplete status per section

Section completeness rules:

- basicInfo: name AND location are non-empty
- education: education array has >= 1 entry
- workHistory: workHistory array has >= 1 entry
- careerGoals: careerGoals is non-empty
- skills: skills array has >= 1 entry
- enrichment: hasEnrichmentConversation is true
- privacy: privacySettings.defaultVisibility is set
  </action>
  <verify>
  Run `npx convex dev` - should compile without errors
  Run `npx convex dashboard` - verify tables appear in schema
  </verify>
  <done>
  Schema deployed with profiles, enrichmentMessages, enrichmentExtractions, skillsTaxonomy tables. getOrCreateProfile, updateField, getCompleteness functions work.
  </done>
  </task>

<task type="auto">
  <name>Task 2: Profile wizard with basic form steps</name>
  <files>
    - src/routes/profile/edit.tsx
    - src/routes/profile/index.tsx
    - src/components/profile/wizard/ProfileWizard.tsx
    - src/components/profile/wizard/WizardProgress.tsx
    - src/components/profile/wizard/steps/BasicInfoStep.tsx
    - src/components/profile/wizard/steps/EducationStep.tsx
    - src/components/profile/wizard/steps/WorkHistoryStep.tsx
    - src/components/profile/wizard/steps/GoalsStep.tsx
    - src/components/profile/wizard/steps/SkillsStep.tsx
    - src/components/profile/wizard/steps/EnrichmentStep.tsx
    - src/components/profile/wizard/steps/PrivacyStep.tsx
    - src/components/profile/wizard/hooks/useAutoSave.ts
    - src/components/layout/auth-header.tsx
  </files>
  <action>
**Route: src/routes/profile/edit.tsx**
- URL-synced step via TanStack Router search params
- validateSearch with zod: step = enum of 'basic' | 'education' | 'work' | 'goals' | 'skills' | 'enrichment' | 'privacy', default 'basic'
- Require authentication (redirect to /login if not authenticated)
- Render ProfileWizard with currentStep and onStepChange

**Route: src/routes/profile/index.tsx**

- Profile view page (read-only display)
- Show profile data fetched via getOrCreateProfile
- "Edit Profile" button linking to /profile/edit
- Use AuthHeader

**Component: ProfileWizard.tsx**

- Props: currentStep, onStepChange
- Fetch profile via getOrCreateProfile (uses current user)
- Render WizardProgress sidebar
- Render current step component based on currentStep prop
- Step navigation: Previous/Next buttons, plus "Skip for now" on each step
- Pass profile data and onFieldChange to each step

**Component: WizardProgress.tsx**

- Fetch completeness via getCompleteness
- Render checklist of 7 sections with checkmark or empty circle
- Show completed count / total (e.g., "3 of 7 complete")
- Feature unlock messaging: "Complete 4 sections to unlock smart matching"
- Each section clickable to jump to that step

**Hook: useAutoSave.ts**

- Takes profileId
- Returns { saveField } function
- Debounce 500ms, accumulate pending updates
- Call updateField mutation with batched changes

**Component: BasicInfoStep.tsx**

- Fields: name (input), pronouns (input), location (input), headline (textarea)
- Each field uses useState for local state
- onBlur calls saveField from useAutoSave
- Show subtle "Saved" indicator after successful save

**Component: EducationStep.tsx**

- Render list of education entries (editable)
- "Add Education" button to add new entry
- Each entry: institution (input), degree (input), field (input), startYear/endYear (number inputs), current (checkbox)
- Save entire education array on any change (debounced)

**Component: WorkHistoryStep.tsx**

- Similar to EducationStep but for work history
- Fields: organization, title, startDate/endDate (month/year pickers or inputs), current, description (textarea)

**Component: GoalsStep.tsx**

- careerGoals (textarea): "What are your career goals in AI safety?"
- aiSafetyInterests (multi-select or chips): "Which areas of AI safety interest you most?"
- seeking (textarea): "What are you looking for?" (roles, mentorship, collaboration, etc.)

**Stub Components: SkillsStep.tsx, EnrichmentStep.tsx, PrivacyStep.tsx**

- Simple placeholder: "Coming soon" message with step icon
- Will be implemented in Plans 02, 03, 04

**Update auth-header.tsx:**

- Change "Profile" dropdown link from "/" to "/profile"
- Ensure dropdown works correctly with new route

Use existing shadcn/ui components: Button, Input, Textarea, Checkbox, Card
Use OKLCH coral accent color for primary actions (established in Phase 1)
</action>
<verify>

1. Visit /profile/edit while logged in - wizard loads with BasicInfo step
2. Navigate between steps using Next/Previous buttons
3. Enter data in BasicInfo fields, blur - data saves (check Convex dashboard)
4. Add education entry - appears in list
5. Add work history entry - appears in list
6. Enter career goals - saves on blur
7. Click step in progress sidebar - navigates to that step
8. Visit /profile - see read-only profile view
9. Refresh page - data persists
10. Check WizardProgress shows correct completion status
    </verify>
    <done>
    Profile wizard functional at /profile/edit with URL-synced steps. BasicInfo, Education, Work, Goals steps save data with auto-save. WizardProgress shows completeness checklist. Skills/Enrichment/Privacy show placeholder content.
    </done>
    </task>

</tasks>

<verification>
- [ ] Schema deployed with all 4 new tables
- [ ] /profile/edit accessible when logged in
- [ ] All 7 steps navigable via Next/Previous or sidebar clicks
- [ ] Basic info fields save on blur
- [ ] Education entries can be added/edited
- [ ] Work history entries can be added/edited
- [ ] Career goals save on blur
- [ ] WizardProgress shows correct completion status
- [ ] Refresh preserves all data
- [ ] URL step param syncs with visible step
</verification>

<success_criteria>

1. User can navigate 7-step wizard with URL-synced steps
2. User can enter and save basic info (name, pronouns, location, headline)
3. User can add multiple education entries
4. User can add multiple work history entries
5. User can describe career goals, interests, and what they're seeking
6. All data persists across refresh
7. Completeness checklist shows accurate section status
8. Skills/Enrichment/Privacy steps show placeholder (ready for Plans 02-04)
   </success_criteria>

<output>
After completion, create `.planning/phases/03-profiles/03-01-SUMMARY.md`
</output>
