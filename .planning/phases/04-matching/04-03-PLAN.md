---
phase: 04-matching
plan: 03
type: execute
wave: 3
depends_on: ['04-02']
files_modified:
  - src/routes/matches/index.tsx
  - src/routes/matches/$id.tsx
  - src/components/matches/MatchCard.tsx
  - src/components/matches/MatchTierSection.tsx
  - src/components/matches/GrowthAreas.tsx
  - src/components/matches/ProbabilityBadge.tsx
autonomous: false

must_haves:
  truths:
    - 'User can navigate to /matches and see their matched opportunities'
    - 'Matches are grouped by tier (Great match / Good match / Worth exploring)'
    - 'Each match card shows tier badge, brief explanation preview, and opportunity details'
    - 'User can click through to full match detail with explanation and recommendations'
    - 'Match detail shows probability assessment with experimental label'
    - 'Growth Areas section shows aggregated recommendations'
  artifacts:
    - path: 'src/routes/matches/index.tsx'
      provides: 'Matches list page with tier sections'
    - path: 'src/routes/matches/$id.tsx'
      provides: 'Match detail page'
    - path: 'src/components/matches/MatchCard.tsx'
      provides: 'Match preview card component'
    - path: 'src/components/matches/MatchTierSection.tsx'
      provides: 'Tier grouping section'
    - path: 'src/components/matches/GrowthAreas.tsx'
      provides: 'Aggregated recommendations display'
    - path: 'src/components/matches/ProbabilityBadge.tsx'
      provides: 'Interview chance and ranking display'
  key_links:
    - from: 'src/routes/matches/index.tsx'
      to: 'convex/matches.ts'
      via: 'useQuery hook'
      pattern: "useQuery\\(api\\.matches\\.getMyMatches"
    - from: 'src/routes/matches/$id.tsx'
      to: 'convex/matches.ts'
      via: 'useQuery hook'
      pattern: "useQuery\\(api\\.matches\\.getMatchById"
    - from: 'src/routes/matches/index.tsx'
      to: 'convex/matches.ts'
      via: 'useAction hook for computation trigger'
      pattern: "useAction\\(api\\.matches\\.triggerMatchComputation"
---

<objective>
Build the matches UI: list page with tier sections and match detail page with full explanations and recommendations.

Purpose: Give users a clear view of their matched opportunities with actionable explanations and recommendations to improve their fit.
Output: /matches route with tier-grouped list, /matches/$id route with full detail, and supporting components.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-matching/04-CONTEXT.md
@.planning/phases/04-matching/04-02-SUMMARY.md
@src/routes/profile/index.tsx
@src/routes/opportunities/index.tsx
@src/components/layout/auth-header.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create matches list page with tier sections</name>
  <files>
    src/routes/matches/index.tsx
    src/components/matches/MatchCard.tsx
    src/components/matches/MatchTierSection.tsx
    src/components/matches/GrowthAreas.tsx
  </files>
  <action>
Create the matches list page and supporting components following existing patterns (profile/index.tsx, opportunities/index.tsx):

**1. src/components/matches/MatchCard.tsx**
Match preview card showing:

- Tier badge (colored: green for great, blue for good, amber for exploring)
- Opportunity title and organization
- Location (with remote indicator)
- 2-3 line explanation preview (first 2 strengths)
- "View details" link

```tsx
import { Link } from '@tanstack/react-router'
import { Card } from '~/components/ui/card'
import { Badge } from '~/components/ui/badge'
import { MapPin, ExternalLink, Sparkles, ThumbsUp, Compass } from 'lucide-react'

interface MatchCardProps {
  match: {
    _id: string
    tier: 'great' | 'good' | 'exploring'
    isNew: boolean
    explanation: {
      strengths: string[]
    }
    opportunity: {
      _id: string
      title: string
      organization: string
      location: string
      isRemote: boolean
      roleType: string
    }
  }
}

const tierConfig = {
  great: {
    label: 'Great match',
    color: 'bg-emerald-100 text-emerald-800',
    icon: Sparkles,
  },
  good: {
    label: 'Good match',
    color: 'bg-blue-100 text-blue-800',
    icon: ThumbsUp,
  },
  exploring: {
    label: 'Worth exploring',
    color: 'bg-amber-100 text-amber-800',
    icon: Compass,
  },
}

export function MatchCard({ match }: MatchCardProps) {
  const tier = tierConfig[match.tier]
  const TierIcon = tier.icon

  return (
    <Card className="p-4 hover:shadow-md transition-shadow">
      <div className="flex items-start justify-between gap-4">
        <div className="flex-1 min-w-0">
          <div className="flex items-center gap-2 mb-2">
            <Badge className={tier.color}>
              <TierIcon className="size-3 mr-1" />
              {tier.label}
            </Badge>
            {match.isNew && (
              <Badge
                variant="secondary"
                className="bg-coral-100 text-coral-800"
              >
                New
              </Badge>
            )}
          </div>

          <Link
            to="/matches/$id"
            params={{ id: match._id }}
            className="block group"
          >
            <h3 className="font-semibold text-slate-900 group-hover:text-primary truncate">
              {match.opportunity.title}
            </h3>
            <p className="text-sm text-slate-600">
              {match.opportunity.organization}
            </p>
          </Link>

          <div className="flex items-center gap-2 mt-2 text-sm text-slate-500">
            <MapPin className="size-3" />
            <span>{match.opportunity.location}</span>
            {match.opportunity.isRemote && (
              <Badge variant="outline" className="text-xs">
                Remote
              </Badge>
            )}
          </div>

          {/* Explanation preview - first 2 strengths */}
          <ul className="mt-3 space-y-1 text-sm text-slate-600">
            {match.explanation.strengths.slice(0, 2).map((strength, i) => (
              <li key={i} className="flex items-start gap-2">
                <span className="text-emerald-500 mt-0.5">+</span>
                <span className="line-clamp-1">{strength}</span>
              </li>
            ))}
          </ul>
        </div>

        <Link
          to="/matches/$id"
          params={{ id: match._id }}
          className="text-slate-400 hover:text-primary"
        >
          <ExternalLink className="size-5" />
        </Link>
      </div>
    </Card>
  )
}
```

**2. src/components/matches/MatchTierSection.tsx**
Section wrapper for grouping matches by tier:

```tsx
import { MatchCard } from './MatchCard'
import { Sparkles, ThumbsUp, Compass } from 'lucide-react'

interface MatchTierSectionProps {
  tier: 'great' | 'good' | 'exploring'
  matches: Array<{
    _id: string
    tier: 'great' | 'good' | 'exploring'
    isNew: boolean
    explanation: { strengths: string[] }
    opportunity: {
      _id: string
      title: string
      organization: string
      location: string
      isRemote: boolean
      roleType: string
    }
  }>
}

const tierMeta = {
  great: {
    title: 'Great Matches',
    description: 'Strong alignment with your background and goals',
    icon: Sparkles,
    color: 'text-emerald-600',
  },
  good: {
    title: 'Good Matches',
    description: 'Good fit with some areas to develop',
    icon: ThumbsUp,
    color: 'text-blue-600',
  },
  exploring: {
    title: 'Worth Exploring',
    description: 'Stretch opportunities that could expand your horizons',
    icon: Compass,
    color: 'text-amber-600',
  },
}

export function MatchTierSection({ tier, matches }: MatchTierSectionProps) {
  if (matches.length === 0) return null

  const meta = tierMeta[tier]
  const Icon = meta.icon

  return (
    <section className="mb-8">
      <div className="flex items-center gap-2 mb-2">
        <Icon className={`size-5 ${meta.color}`} />
        <h2 className="text-lg font-semibold text-slate-900">{meta.title}</h2>
        <span className="text-sm text-slate-500">({matches.length})</span>
      </div>
      <p className="text-sm text-slate-500 mb-4">{meta.description}</p>

      <div className="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
        {matches.map((match) => (
          <MatchCard key={match._id} match={match} />
        ))}
      </div>
    </section>
  )
}
```

**3. src/components/matches/GrowthAreas.tsx**
Aggregated recommendations display:

```tsx
import { Card } from '~/components/ui/card'
import { TrendingUp, Wrench, BookOpen, Briefcase } from 'lucide-react'

interface GrowthAreasProps {
  areas: Array<{
    theme: string
    items: string[]
  }>
}

const themeIcons: Record<string, typeof TrendingUp> = {
  'Skills to build': Wrench,
  'Experience to gain': Briefcase,
  'Knowledge to deepen': BookOpen,
}

export function GrowthAreas({ areas }: GrowthAreasProps) {
  if (!areas || areas.length === 0) return null

  return (
    <Card className="p-6 bg-slate-50">
      <div className="flex items-center gap-2 mb-4">
        <TrendingUp className="size-5 text-primary" />
        <h2 className="text-lg font-semibold text-slate-900">
          Your Growth Areas
        </h2>
      </div>
      <p className="text-sm text-slate-500 mb-4">
        Based on your matches, here are areas to focus on to improve your fit
      </p>

      <div className="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
        {areas.map((area) => {
          const Icon = themeIcons[area.theme] || TrendingUp
          return (
            <div key={area.theme} className="bg-white rounded-lg p-4 border">
              <div className="flex items-center gap-2 mb-2">
                <Icon className="size-4 text-slate-400" />
                <h3 className="font-medium text-slate-900">{area.theme}</h3>
              </div>
              <ul className="space-y-1 text-sm text-slate-600">
                {area.items.map((item, i) => (
                  <li key={i} className="flex items-start gap-2">
                    <span className="text-primary">•</span>
                    {item}
                  </li>
                ))}
              </ul>
            </div>
          )
        })}
      </div>
    </Card>
  )
}
```

**4. src/routes/matches/index.tsx**
Main matches page:

```tsx
import { createFileRoute, Link, useNavigate } from '@tanstack/react-router'
import { useQuery, useAction } from 'convex/react'
import { Authenticated, Unauthenticated, AuthLoading } from 'convex/react'
import { api } from '../../../convex/_generated/api'
import { AuthHeader } from '~/components/layout/auth-header'
import { Button } from '~/components/ui/button'
import { Card } from '~/components/ui/card'
import { Spinner } from '~/components/ui/spinner'
import { MatchTierSection } from '~/components/matches/MatchTierSection'
import { GrowthAreas } from '~/components/matches/GrowthAreas'
import { Sparkles, RefreshCw, User } from 'lucide-react'
import { useState, useEffect } from 'react'

export const Route = createFileRoute('/matches/')({
  component: MatchesPage,
})

function MatchesPage() {
  return (
    <div className="min-h-screen bg-slate-50">
      <AuthHeader />
      <AuthLoading>
        <LoadingState />
      </AuthLoading>
      <Unauthenticated>
        <UnauthenticatedRedirect />
      </Unauthenticated>
      <Authenticated>
        <MatchesContent />
      </Authenticated>
    </div>
  )
}

function LoadingState() {
  return (
    <div className="flex items-center justify-center min-h-[calc(100vh-65px)]">
      <Spinner />
    </div>
  )
}

function UnauthenticatedRedirect() {
  const navigate = useNavigate()
  useEffect(() => {
    navigate({ to: '/login' })
  }, [navigate])
  return <LoadingState />
}

function MatchesContent() {
  const matchesData = useQuery(api.matches.getMyMatches)
  const triggerComputation = useAction(api.matches.triggerMatchComputation)
  const markViewed = useAction(api.matches.markMatchesViewed)
  const [isComputing, setIsComputing] = useState(false)
  const [computeError, setComputeError] = useState<string | null>(null)

  // Mark matches as viewed on mount
  useEffect(() => {
    if (
      matchesData &&
      !matchesData.needsProfile &&
      !matchesData.needsComputation
    ) {
      markViewed().catch(console.error)
    }
  }, [matchesData?.matches, markViewed])

  // Auto-trigger computation if needed
  useEffect(() => {
    if (matchesData?.needsComputation && !isComputing) {
      handleCompute()
    }
  }, [matchesData?.needsComputation])

  const handleCompute = async () => {
    setIsComputing(true)
    setComputeError(null)
    try {
      await triggerComputation()
    } catch (err) {
      setComputeError(
        err instanceof Error ? err.message : 'Failed to compute matches',
      )
    } finally {
      setIsComputing(false)
    }
  }

  if (matchesData === undefined) {
    return <LoadingState />
  }

  // No profile yet
  if (matchesData.needsProfile) {
    return (
      <main className="container mx-auto px-4 py-8">
        <Card className="max-w-lg mx-auto p-8 text-center">
          <div className="size-16 rounded-full bg-primary/10 flex items-center justify-center mx-auto mb-4">
            <User className="size-8 text-primary" />
          </div>
          <h1 className="text-2xl font-bold text-slate-900 mb-2">
            Create Your Profile First
          </h1>
          <p className="text-slate-500 mb-6">
            Complete your profile to get matched with AI safety opportunities
            tailored to your background and goals.
          </p>
          <Button asChild>
            <Link to="/profile/edit">Create Profile</Link>
          </Button>
        </Card>
      </main>
    )
  }

  // Computing matches
  if (isComputing) {
    return (
      <main className="container mx-auto px-4 py-8">
        <Card className="max-w-lg mx-auto p-8 text-center">
          <div className="size-16 rounded-full bg-primary/10 flex items-center justify-center mx-auto mb-4">
            <Sparkles className="size-8 text-primary animate-pulse" />
          </div>
          <h1 className="text-2xl font-bold text-slate-900 mb-2">
            Finding Your Matches
          </h1>
          <p className="text-slate-500 mb-4">
            Our AI is analyzing opportunities against your profile...
          </p>
          <Spinner />
        </Card>
      </main>
    )
  }

  // Compute error
  if (computeError) {
    return (
      <main className="container mx-auto px-4 py-8">
        <Card className="max-w-lg mx-auto p-8 text-center">
          <h1 className="text-2xl font-bold text-slate-900 mb-2">
            Something went wrong
          </h1>
          <p className="text-red-500 mb-6">{computeError}</p>
          <Button onClick={handleCompute}>Try Again</Button>
        </Card>
      </main>
    )
  }

  const { matches, computedAt } = matchesData
  const hasMatches =
    matches.great.length + matches.good.length + matches.exploring.length > 0

  return (
    <main className="container mx-auto px-4 py-8">
      <div className="max-w-6xl mx-auto">
        {/* Header */}
        <div className="flex items-start justify-between mb-6">
          <div>
            <h1 className="text-2xl font-bold text-slate-900">Your Matches</h1>
            <p className="text-slate-500 mt-1">
              Opportunities matched to your profile and goals
            </p>
            {computedAt && (
              <p className="text-xs text-slate-400 mt-1">
                Last updated: {new Date(computedAt).toLocaleDateString()}
              </p>
            )}
          </div>
          <Button
            variant="outline"
            onClick={handleCompute}
            disabled={isComputing}
          >
            <RefreshCw
              className={`size-4 mr-2 ${isComputing ? 'animate-spin' : ''}`}
            />
            Refresh Matches
          </Button>
        </div>

        {/* No matches state */}
        {!hasMatches && (
          <Card className="p-8 text-center">
            <div className="size-16 rounded-full bg-slate-100 flex items-center justify-center mx-auto mb-4">
              <Sparkles className="size-8 text-slate-400" />
            </div>
            <h2 className="text-xl font-semibold text-slate-900 mb-2">
              No matches yet
            </h2>
            <p className="text-slate-500 mb-6 max-w-md mx-auto">
              We couldn't find strong matches right now. Try completing more of
              your profile or check back when new opportunities are posted.
            </p>
            <div className="flex gap-3 justify-center">
              <Button asChild variant="outline">
                <Link to="/profile/edit">Improve Profile</Link>
              </Button>
              <Button asChild>
                <Link to="/opportunities">Browse All Opportunities</Link>
              </Button>
            </div>
          </Card>
        )}

        {/* Match sections by tier */}
        {hasMatches && (
          <>
            <MatchTierSection tier="great" matches={matches.great} />
            <MatchTierSection tier="good" matches={matches.good} />
            <MatchTierSection tier="exploring" matches={matches.exploring} />

            {/* Growth Areas */}
            {/* Note: Growth areas come from the compute action - stored separately or in first match */}
          </>
        )}
      </div>
    </main>
  )
}
```

Ensure the coral color is defined in tailwind config for the "New" badge (or use a close existing color).
</action>
<verify>
Run `npm run dev` and navigate to /matches:

- Page loads without errors
- Shows "Create Profile First" if no profile
- Shows "Finding Your Matches" during computation
- Shows tier sections when matches exist
  </verify>
  <done>
  /matches page displays with tier sections (Great/Good/Exploring), MatchCard shows tier badge + explanation preview, GrowthAreas component exists
  </done>
  </task>

<task type="auto">
  <name>Task 2: Create match detail page with full explanation and recommendations</name>
  <files>
    src/routes/matches/$id.tsx
    src/components/matches/ProbabilityBadge.tsx
  </files>
  <action>
Create the match detail page showing full explanation, probability, and recommendations:

**1. src/components/matches/ProbabilityBadge.tsx**
Interview chance and ranking display with experimental label:

```tsx
import { Badge } from '~/components/ui/badge'
import { TrendingUp, AlertCircle } from 'lucide-react'

interface ProbabilityBadgeProps {
  probability: {
    interviewChance: string
    ranking: string
    confidence: string
  }
}

const chanceColors: Record<string, string> = {
  'Strong chance': 'bg-emerald-100 text-emerald-800',
  'Good chance': 'bg-blue-100 text-blue-800',
  'Moderate chance': 'bg-amber-100 text-amber-800',
}

export function ProbabilityBadge({ probability }: ProbabilityBadgeProps) {
  const chanceColor =
    chanceColors[probability.interviewChance] || 'bg-slate-100 text-slate-800'

  return (
    <div className="bg-slate-50 rounded-lg p-4 border">
      <div className="flex items-center gap-2 mb-3">
        <TrendingUp className="size-4 text-slate-400" />
        <span className="text-sm font-medium text-slate-700">
          Interview Likelihood
        </span>
        <Badge variant="outline" className="text-xs ml-auto">
          <AlertCircle className="size-3 mr-1" />
          experimental
        </Badge>
      </div>

      <div className="flex items-center gap-4">
        <Badge className={`${chanceColor} text-sm`}>
          {probability.interviewChance}
        </Badge>
        <span className="text-sm text-slate-600">{probability.ranking}</span>
      </div>

      {probability.confidence !== 'HIGH' && (
        <p className="text-xs text-slate-400 mt-2">
          Confidence: {probability.confidence.toLowerCase()}
        </p>
      )}
    </div>
  )
}
```

**2. src/routes/matches/$id.tsx**
Match detail page:

```tsx
import { createFileRoute, Link, useNavigate } from '@tanstack/react-router'
import { useQuery } from 'convex/react'
import { Authenticated, Unauthenticated, AuthLoading } from 'convex/react'
import { api } from '../../../convex/_generated/api'
import { Id } from '../../../convex/_generated/dataModel'
import { AuthHeader } from '~/components/layout/auth-header'
import { Button } from '~/components/ui/button'
import { Card } from '~/components/ui/card'
import { Badge } from '~/components/ui/badge'
import { Spinner } from '~/components/ui/spinner'
import { ProbabilityBadge } from '~/components/matches/ProbabilityBadge'
import {
  ArrowLeft,
  MapPin,
  ExternalLink,
  Sparkles,
  ThumbsUp,
  Compass,
  CheckCircle,
  AlertTriangle,
  Lightbulb,
  Calendar,
} from 'lucide-react'
import { useEffect } from 'react'

export const Route = createFileRoute('/matches/$id')({
  component: MatchDetailPage,
})

function MatchDetailPage() {
  return (
    <div className="min-h-screen bg-slate-50">
      <AuthHeader />
      <AuthLoading>
        <LoadingState />
      </AuthLoading>
      <Unauthenticated>
        <UnauthenticatedRedirect />
      </Unauthenticated>
      <Authenticated>
        <MatchDetailContent />
      </Authenticated>
    </div>
  )
}

function LoadingState() {
  return (
    <div className="flex items-center justify-center min-h-[calc(100vh-65px)]">
      <Spinner />
    </div>
  )
}

function UnauthenticatedRedirect() {
  const navigate = useNavigate()
  useEffect(() => {
    navigate({ to: '/login' })
  }, [navigate])
  return <LoadingState />
}

const tierConfig = {
  great: {
    label: 'Great match',
    color: 'bg-emerald-100 text-emerald-800',
    icon: Sparkles,
  },
  good: {
    label: 'Good match',
    color: 'bg-blue-100 text-blue-800',
    icon: ThumbsUp,
  },
  exploring: {
    label: 'Worth exploring',
    color: 'bg-amber-100 text-amber-800',
    icon: Compass,
  },
}

function MatchDetailContent() {
  const { id } = Route.useParams()
  const match = useQuery(api.matches.getMatchById, {
    matchId: id as Id<'matches'>,
  })

  if (match === undefined) {
    return <LoadingState />
  }

  if (match === null) {
    return (
      <main className="container mx-auto px-4 py-8">
        <Card className="max-w-lg mx-auto p-8 text-center">
          <h1 className="text-2xl font-bold text-slate-900 mb-2">
            Match Not Found
          </h1>
          <p className="text-slate-500 mb-6">
            This match may have been updated or removed.
          </p>
          <Button asChild>
            <Link to="/matches">Back to Matches</Link>
          </Button>
        </Card>
      </main>
    )
  }

  const tier = tierConfig[match.tier]
  const TierIcon = tier.icon

  return (
    <main className="container mx-auto px-4 py-8">
      <div className="max-w-3xl mx-auto">
        {/* Back link */}
        <Link
          to="/matches"
          className="inline-flex items-center text-sm text-slate-500 hover:text-slate-900 mb-6"
        >
          <ArrowLeft className="size-4 mr-1" />
          Back to matches
        </Link>

        {/* Opportunity header */}
        <Card className="p-6 mb-6">
          <div className="flex items-start justify-between gap-4">
            <div>
              <div className="flex items-center gap-2 mb-2">
                <Badge className={tier.color}>
                  <TierIcon className="size-3 mr-1" />
                  {tier.label}
                </Badge>
                {match.isNew && <Badge variant="secondary">New</Badge>}
              </div>

              <h1 className="text-2xl font-bold text-slate-900">
                {match.opportunity.title}
              </h1>
              <p className="text-lg text-slate-600 mt-1">
                {match.opportunity.organization}
              </p>

              <div className="flex flex-wrap items-center gap-4 mt-3 text-sm text-slate-500">
                <div className="flex items-center gap-1">
                  <MapPin className="size-4" />
                  {match.opportunity.location}
                  {match.opportunity.isRemote && (
                    <Badge variant="outline" className="ml-1">
                      Remote
                    </Badge>
                  )}
                </div>
                {match.opportunity.deadline && (
                  <div className="flex items-center gap-1">
                    <Calendar className="size-4" />
                    Deadline:{' '}
                    {new Date(match.opportunity.deadline).toLocaleDateString()}
                  </div>
                )}
              </div>
            </div>

            <Button asChild>
              <a
                href={match.opportunity.sourceUrl}
                target="_blank"
                rel="noopener noreferrer"
              >
                <ExternalLink className="size-4 mr-2" />
                Apply
              </a>
            </Button>
          </div>
        </Card>

        {/* Why this matches */}
        <Card className="p-6 mb-6">
          <h2 className="text-lg font-semibold text-slate-900 mb-4 flex items-center gap-2">
            <CheckCircle className="size-5 text-emerald-500" />
            Why This Fits You
          </h2>

          <ul className="space-y-3">
            {match.explanation.strengths.map((strength, i) => (
              <li key={i} className="flex items-start gap-3">
                <span className="size-6 rounded-full bg-emerald-100 text-emerald-600 flex items-center justify-center text-sm flex-shrink-0 mt-0.5">
                  +
                </span>
                <span className="text-slate-700">{strength}</span>
              </li>
            ))}
          </ul>

          {match.explanation.gap && (
            <div className="mt-6 pt-4 border-t">
              <h3 className="text-sm font-medium text-slate-700 mb-2 flex items-center gap-2">
                <AlertTriangle className="size-4 text-amber-500" />
                To strengthen your application
              </h3>
              <p className="text-slate-600 pl-6">{match.explanation.gap}</p>
            </div>
          )}
        </Card>

        {/* Probability assessment */}
        <Card className="p-6 mb-6">
          <ProbabilityBadge probability={match.probability} />
        </Card>

        {/* Recommendations */}
        <Card className="p-6 mb-6">
          <h2 className="text-lg font-semibold text-slate-900 mb-4 flex items-center gap-2">
            <Lightbulb className="size-5 text-primary" />
            Recommendations
          </h2>

          <div className="space-y-4">
            {match.recommendations.map((rec, i) => (
              <div
                key={i}
                className={`flex items-start gap-3 p-3 rounded-lg ${
                  rec.type === 'specific' ? 'bg-primary/5' : 'bg-slate-50'
                }`}
              >
                <Badge
                  variant="outline"
                  className={
                    rec.priority === 'high'
                      ? 'border-primary text-primary'
                      : rec.priority === 'medium'
                        ? 'border-blue-500 text-blue-500'
                        : 'border-slate-400 text-slate-400'
                  }
                >
                  {rec.type === 'specific' ? 'For this role' : rec.type}
                </Badge>
                <span className="text-slate-700">{rec.action}</span>
              </div>
            ))}
          </div>
        </Card>

        {/* Opportunity description */}
        <Card className="p-6">
          <h2 className="text-lg font-semibold text-slate-900 mb-4">
            About This Opportunity
          </h2>

          <div className="prose prose-slate max-w-none">
            <p className="whitespace-pre-wrap">
              {match.opportunity.description}
            </p>
          </div>

          {match.opportunity.requirements &&
            match.opportunity.requirements.length > 0 && (
              <div className="mt-6 pt-4 border-t">
                <h3 className="font-medium text-slate-900 mb-3">
                  Requirements
                </h3>
                <ul className="space-y-2">
                  {match.opportunity.requirements.map((req, i) => (
                    <li
                      key={i}
                      className="flex items-start gap-2 text-slate-600"
                    >
                      <span className="text-slate-400">•</span>
                      {req}
                    </li>
                  ))}
                </ul>
              </div>
            )}
        </Card>
      </div>
    </main>
  )
}
```

  </action>
  <verify>
Run `npm run dev`, navigate to /matches, click on a match card:
- Detail page loads with match data
- Shows tier badge, opportunity info
- Shows "Why This Fits You" with bullet points
- Shows probability badge with "experimental" label
- Shows recommendations section
- "Apply" button links to external source URL
  </verify>
  <done>
/matches/$id detail page shows full explanation, probability with experimental label (MATCH-03), and recommendations (MATCH-04)
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete matches UI: list page with tier sections, detail page with explanations, probability, and recommendations
  </what-built>
  <how-to-verify>
1. Start the dev server: `npm run dev`
2. Log in with a test account that has a profile
3. Navigate to /matches
4. Verify:
   - Page shows "Finding Your Matches" during computation (or cached matches if already computed)
   - Matches are grouped by tier: "Great Matches", "Good Matches", "Worth Exploring"
   - Each match card shows tier badge, opportunity title/org, location, brief explanation
   - "New" badge appears on first view of new matches
5. Click on a match card to view detail page
6. Verify detail page shows:
   - Tier badge and opportunity header
   - "Why This Fits You" section with bullet points
   - "To strengthen your application" section (if gap exists)
   - Probability badge with "Strong/Good/Moderate chance" + ranking + "(experimental)" label
   - Recommendations section with "For this role" and general recommendations
   - Full opportunity description
   - "Apply" button linking to external URL
7. Navigate back to /matches and verify "Refresh Matches" button works
8. Check that no matches state shows appropriate empty state with links to profile/opportunities
  </how-to-verify>
  <resume-signal>Type "approved" if all checks pass, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
After all tasks and checkpoint complete:
1. /matches page loads and displays tier-grouped matches
2. Match cards show tier badge, explanation preview, opportunity details
3. /matches/$id detail page shows full explanation with strengths and gap
4. Probability displayed with "experimental" label
5. Recommendations show specific + general guidance
6. Navigation between list and detail works correctly
7. Auth protection works (redirects to login if not authenticated)
8. Refresh matches button triggers recomputation
</verification>

<success_criteria>

- MATCH-01: User receives matched opportunities (visible on /matches page)
- MATCH-02: Each match includes explanation (strengths + actionable gap)
- MATCH-03: Each match shows probability with experimental label
- MATCH-04: User sees recommendations (specific + general)
- Matches grouped by tier (Great/Good/Exploring per CONTEXT.md)
- Encouraging tone throughout (per CONTEXT.md)
- Standard card density on list, full detail on click-through
  </success_criteria>

<output>
After completion, create `.planning/phases/04-matching/04-03-SUMMARY.md`
</output>
