---
phase: 05-engagement-org
plan: 03
type: execute
wave: 2
depends_on: ['05-01']
files_modified:
  - src/routes/settings/index.tsx
  - src/routes/settings/route.tsx
  - src/components/settings/NotificationPrefsForm.tsx
  - convex/profiles.ts
autonomous: true

must_haves:
  truths:
    - 'User can access settings page from authenticated navigation'
    - 'User can toggle match alerts on/off'
    - 'User can toggle weekly digest on/off'
    - 'User can set their timezone'
  artifacts:
    - path: 'src/routes/settings/index.tsx'
      provides: 'Settings page route'
      min_lines: 30
    - path: 'src/components/settings/NotificationPrefsForm.tsx'
      provides: 'Notification preferences form'
      exports: ['NotificationPrefsForm']
    - path: 'convex/profiles.ts'
      provides: 'Mutation to update notification preferences'
      exports: ['updateNotificationPreferences']
  key_links:
    - from: 'src/components/settings/NotificationPrefsForm.tsx'
      to: 'convex/profiles.ts'
      via: 'useMutation(api.profiles.updateNotificationPreferences)'
      pattern: 'useMutation.*updateNotificationPreferences'
---

<objective>
Create settings page with notification preferences UI where users can toggle match alerts, weekly digest, and set timezone.

Purpose: Allow users to configure notification preferences (NOTIF-03)
Output: /settings route with NotificationPrefsForm component
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-engagement-org/05-CONTEXT.md
@convex/profiles.ts
@src/routes/profile/edit.tsx
@src/components/layout/auth-header.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add mutation and query for notification preferences</name>
  <files>convex/profiles.ts</files>
  <action>
Add to `convex/profiles.ts`:

1. Query `getNotificationPreferences`:
   - Get current user's profile
   - Return notificationPreferences object or null if not set

2. Mutation `updateNotificationPreferences`:
   - Args: matchAlertsEnabled (boolean), weeklyDigestEnabled (boolean), timezone (string)
   - Validate timezone is valid IANA identifier (basic check: contains "/")
   - Update profile's notificationPreferences field
   - Return success

Per CONTEXT.md: Users should be asked to set preferences (not defaulted). The form will prompt them to configure on first visit to settings.

Common IANA timezones to support:

- Americas: America/New_York, America/Chicago, America/Denver, America/Los_Angeles, America/Sao_Paulo
- Europe: Europe/London, Europe/Paris, Europe/Berlin
- Asia: Asia/Tokyo, Asia/Shanghai, Asia/Singapore, Asia/Kolkata
- Pacific: Australia/Sydney, Pacific/Auckland
  </action>
  <verify>
  `bun run lint` passes, `bunx convex dev --once` deploys
  </verify>
  <done>
  Convex functions exist to read and update notification preferences
  </done>
  </task>

<task type="auto">
  <name>Task 2: Create settings route and notification preferences form</name>
  <files>
    - src/routes/settings/route.tsx
    - src/routes/settings/index.tsx
    - src/components/settings/NotificationPrefsForm.tsx
  </files>
  <action>
Create `src/routes/settings/route.tsx`:
- Pathless layout route for /settings/*
- Uses AuthHeader component
- Requires authentication (redirect to /login if not authenticated)

Create `src/routes/settings/index.tsx`:

- Main settings page at /settings
- Page title "Settings", subtitle "Manage your notification preferences and account settings"
- Renders NotificationPrefsForm component
- Follow pattern from /profile/edit.tsx (Authenticated/Unauthenticated/AuthLoading)

Create `src/components/settings/NotificationPrefsForm.tsx`:

- useQuery to get current notification preferences
- Form with:
  - Switch for "Match Alerts" with description "Get notified when we find great-fit opportunities for you"
  - Switch for "Weekly Digest" with description "Receive a weekly summary of new matches and profile tips"
  - Select dropdown for timezone with common IANA timezones grouped by region
- Auto-detect browser timezone for initial suggestion: `Intl.DateTimeFormat().resolvedOptions().timeZone`
- useMutation to update preferences on toggle/change
- Show success toast on save
- If preferences not set, show "Set up notifications" prompt with encouraging copy

Use shadcn/ui components: Switch, Select, Card, Label, Button, toast (sonner)
Style with Tailwind, match existing app aesthetic (slate colors, coral accent)
</action>
<verify>
Routes exist, `bun run dev` shows /settings page, form renders without errors
</verify>
<done>
/settings page exists with working notification preferences form
</done>
</task>

</tasks>

<verification>
1. `bun run lint` passes
2. Navigate to /settings when logged in - page loads
3. Toggle switches update preferences (verify in Convex dashboard)
4. Timezone dropdown shows grouped options
5. Success toast appears after saving
</verification>

<success_criteria>

- /settings route accessible to authenticated users
- User can toggle match alerts on/off
- User can toggle weekly digest on/off
- User can select timezone from dropdown with auto-detection
- Preferences persist across page refresh
  </success_criteria>

<output>
After completion, create `.planning/phases/05-engagement-org/05-03-SUMMARY.md`
</output>
