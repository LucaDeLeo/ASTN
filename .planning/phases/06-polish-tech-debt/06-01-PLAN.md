---
phase: 06-polish-tech-debt
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/layout/auth-header.tsx
  - src/routes/admin/route.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "/matches link is visible in main navigation for authenticated users"
    - "Unauthenticated users cannot access /admin/* routes (frontend guard)"
  artifacts:
    - path: "src/components/layout/auth-header.tsx"
      provides: "Matches navigation link"
      contains: "/matches"
    - path: "src/routes/admin/route.tsx"
      provides: "Authentication wrapper for admin routes"
      contains: "Authenticated"
  key_links:
    - from: "auth-header.tsx"
      to: "/matches"
      via: "Link component"
      pattern: "to=\"/matches\""
    - from: "admin/route.tsx"
      to: "Authenticated"
      via: "convex/react import"
      pattern: "Authenticated.*Unauthenticated"
---

<objective>
Fix navigation discoverability and add frontend auth guard to admin routes.

Purpose: Address two integration gaps from v1-MILESTONE-AUDIT.md - users need to discover the matches page via navigation, and admin routes should have defense-in-depth frontend protection.
Output: Updated AuthHeader with /matches link, AdminLayout with Authenticated wrapper.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/v1-MILESTONE-AUDIT.md
@src/components/layout/auth-header.tsx
@src/routes/admin/route.tsx
@src/routes/profile/index.tsx (reference for Authenticated pattern)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add /matches link to AuthHeader navigation</name>
  <files>src/components/layout/auth-header.tsx</files>
  <action>
Add a "Matches" link to the AuthHeader nav section, after the "Opportunities" link but before the auth state section.

The link should:
- Only appear for authenticated users (inside a separate Authenticated wrapper)
- Use the same styling as the Opportunities link
- Link to "/matches"
- Have active state styling like other nav links

Pattern to follow (from line 23-28 in current file):
```tsx
<Link
  to="/matches"
  className="text-sm text-slate-600 hover:text-slate-900 [&.active]:text-slate-900 [&.active]:font-medium"
>
  Matches
</Link>
```

This link should be wrapped in `<Authenticated>` since only logged-in users can access matches.
  </action>
  <verify>
1. Run `bun run lint` - no errors
2. Grep for "to=\"/matches\"" in auth-header.tsx
3. Verify Authenticated import is present
  </verify>
  <done>
- AuthHeader shows "Opportunities" link always
- AuthHeader shows "Matches" link only for authenticated users
- Link navigates to /matches and has active styling
  </done>
</task>

<task type="auto">
  <name>Task 2: Add Authenticated wrapper to admin route layout</name>
  <files>src/routes/admin/route.tsx</files>
  <action>
Wrap the AdminLayout content with Authenticated/Unauthenticated/AuthLoading components for defense-in-depth.

Import from convex/react:
```tsx
import { AuthLoading, Authenticated, Unauthenticated } from "convex/react";
```

Import Spinner component:
```tsx
import { Spinner } from "~/components/ui/spinner";
```

Update AdminLayout to wrap the returned JSX:
1. Show Spinner during AuthLoading
2. Show Unauthenticated redirect to /login (same pattern as profile/index.tsx)
3. Only render the actual admin layout inside Authenticated

Pattern from profile/index.tsx lines 22-38:
```tsx
function AdminLayout() {
  return (
    <>
      <AuthLoading>
        <div className="flex items-center justify-center min-h-screen">
          <Spinner />
        </div>
      </AuthLoading>
      <Unauthenticated>
        <UnauthenticatedRedirect />
      </Unauthenticated>
      <Authenticated>
        {/* existing admin layout JSX */}
      </Authenticated>
    </>
  );
}
```

Add UnauthenticatedRedirect component (copy from profile/index.tsx):
```tsx
function UnauthenticatedRedirect() {
  const navigate = useNavigate();
  navigate({ to: "/login" });
  return (
    <div className="flex items-center justify-center min-h-screen">
      <Spinner />
    </div>
  );
}
```

Import useNavigate from @tanstack/react-router.

Note: Backend still enforces auth - this is defense in depth for better UX.
  </action>
  <verify>
1. Run `bun run lint` - no errors
2. Grep for "Authenticated" in admin/route.tsx
3. Grep for "Unauthenticated" in admin/route.tsx
  </verify>
  <done>
- Admin route shows loading spinner during auth check
- Admin route redirects unauthenticated users to /login
- Admin route renders admin content for authenticated users
- Backend auth still enforced (defense in depth)
  </done>
</task>

</tasks>

<verification>
1. `bun run lint` passes
2. `grep -r "to=\"/matches\"" src/components/layout/auth-header.tsx` returns result
3. `grep -r "Authenticated" src/routes/admin/route.tsx` returns result
4. Manual test: Visit /admin while logged out - should redirect to /login
5. Manual test: Sign in and verify /matches appears in nav
</verification>

<success_criteria>
- /matches link visible in header navigation when authenticated
- /admin route has frontend auth wrapper
- All linting passes
- Both tasks complete integration gaps from audit
</success_criteria>

<output>
After completion, create `.planning/phases/06-polish-tech-debt/06-01-SUMMARY.md`
</output>
