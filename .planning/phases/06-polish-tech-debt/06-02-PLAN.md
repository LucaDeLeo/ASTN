---
phase: 06-polish-tech-debt
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - .planning/phases/04-matching/04-VERIFICATION.md
  - src/routes/org/$slug/admin/index.tsx
  - convex/profiles.ts
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Phase 04 has formal VERIFICATION.md documenting completion"
    - "Create Invite Link button creates an invite link when clicked"
    - "profiles.getById query is removed (dead code cleanup)"
  artifacts:
    - path: ".planning/phases/04-matching/04-VERIFICATION.md"
      provides: "Phase 04 completion documentation"
      min_lines: 50
    - path: "src/routes/org/$slug/admin/index.tsx"
      provides: "Working Create Invite Link button"
      contains: "createInviteLink"
    - path: "convex/profiles.ts"
      provides: "Clean profiles module without unused getById"
      excludes: "export const getById"
  key_links:
    - from: "admin/index.tsx"
      to: "admin.createInviteLink"
      via: "useMutation"
      pattern: "useMutation.*createInviteLink"
---

<objective>
Clean up tech debt identified in v1-MILESTONE-AUDIT.md.

Purpose: Address documentation gap (missing Phase 04 verification), UI gap (Create Invite Link button), and dead code (unused profiles.getById query).
Output: Phase 04 VERIFICATION.md, working invite button, cleaned profiles.ts.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/v1-MILESTONE-AUDIT.md
@.planning/phases/04-matching/04-01-SUMMARY.md
@.planning/phases/04-matching/04-02-SUMMARY.md
@.planning/phases/04-matching/04-03-SUMMARY.md
@.planning/phases/05-engagement-org/05-VERIFICATION.md (template reference)
@src/routes/org/$slug/admin/index.tsx
@convex/orgs/admin.ts (createInviteLink mutation)
@convex/profiles.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Phase 04 VERIFICATION.md</name>
  <files>.planning/phases/04-matching/04-VERIFICATION.md</files>
  <action>
Create VERIFICATION.md documenting Phase 04 completion. Use 05-VERIFICATION.md as template.

Structure:
1. YAML frontmatter with phase, verified date (now), status: passed, score: 4/4
2. must_haves section with truths, artifacts, key_links from Phase 4 success criteria
3. Markdown body with goal achievement, observable truths table, required artifacts table, key link verification table

Phase 4 success criteria from ROADMAP.md:
1. User receives matched opportunities based on their profile
2. Each match includes explanation of why the opportunity fits the user
3. Each match shows LLM-estimated acceptance probability (labeled experimental)
4. User receives personalized "what to do next" recommendations to improve fit

Key artifacts to verify:
- convex/schema.ts (matches table)
- convex/matching/queries.ts (getMatchesForProfile, getMatchById)
- convex/matching/mutations.ts (createMatch, markMatchViewed)
- convex/matching/compute.ts (computeMatchesForProfile)
- convex/matching/prompts.ts (buildMatchingPrompt, parseMatchingResponse)
- src/routes/matches/index.tsx (matches list page)
- src/routes/matches/$id.tsx (match detail page)
- src/components/matches/MatchCard.tsx
- src/components/matches/ProbabilityBadge.tsx

Key links to verify:
- matches/index.tsx -> matching/queries.getMatchesForProfile
- matches/$id.tsx -> matching/queries.getMatchById
- compute.ts -> prompts.ts (buildMatchingPrompt)
- Cron -> compute.computeMatchesForProfile

Read the three SUMMARY files to extract specific implementation details for the verification.
  </action>
  <verify>
1. File exists at .planning/phases/04-matching/04-VERIFICATION.md
2. YAML frontmatter is valid
3. All 4 success criteria documented with evidence
  </verify>
  <done>
- Phase 04 has formal VERIFICATION.md
- All 4 success criteria documented with evidence
- Artifacts and key links verified
  </done>
</task>

<task type="auto">
  <name>Task 2: Enable Create Invite Link button</name>
  <files>src/routes/org/$slug/admin/index.tsx</files>
  <action>
The InviteLinkButton component (lines 203-239) currently shows "Create Invite Link" as a disabled button when no active link exists. Enable it to call the createInviteLink mutation.

Changes needed:
1. Import useMutation from convex/react
2. Inside InviteLinkButton, add: `const createInvite = useMutation(api.orgs.admin.createInviteLink);`
3. Add state for loading: `const [isCreating, setIsCreating] = useState(false);`
4. Change the disabled button to an active one with onClick handler:

```tsx
const handleCreate = async () => {
  setIsCreating(true);
  try {
    await createInvite({ orgId });
  } finally {
    setIsCreating(false);
  }
};

return (
  <Button
    variant="outline"
    className="h-auto py-4"
    onClick={handleCreate}
    disabled={isCreating}
  >
    <UserPlus className="size-5 mr-2" />
    {isCreating ? "Creating..." : "Create Invite Link"}
  </Button>
);
```

Import useState from react if not already imported.

After creation, the inviteLinks query will refresh and show the new link with "Copy Invite Link" button.
  </action>
  <verify>
1. Run `bun run lint` - no errors
2. Grep for "createInviteLink" in admin/index.tsx
3. Grep for "useMutation" in admin/index.tsx
4. Verify button is no longer disabled in JSX
  </verify>
  <done>
- Create Invite Link button is clickable
- Button calls createInviteLink mutation with orgId
- Button shows loading state during creation
- After creation, UI refreshes to show "Copy Invite Link"
  </done>
</task>

<task type="auto">
  <name>Task 3: Remove unused profiles.getById query</name>
  <files>convex/profiles.ts</files>
  <action>
Remove the unused getById query (lines 77-83) from profiles.ts.

The query:
```typescript
// Get profile by ID (for internal use)
export const getById = query({
  args: { profileId: v.id("profiles") },
  handler: async (ctx, { profileId }) => {
    return await ctx.db.get("profiles", profileId);
  },
});
```

Delete these 7 lines. The comment says "for internal use" but grep shows it's not used anywhere in the codebase except in planning docs.

Note: Other places that need a profile by ID use ctx.db.get() directly, which is more appropriate for internal use.
  </action>
  <verify>
1. Run `bun run lint` - no errors
2. Run `bun run build` - no errors (confirm nothing was depending on it)
3. Grep for "getById" in convex/profiles.ts - should return no results
4. Grep for "profiles.getById" in src/ - should return no results
  </verify>
  <done>
- profiles.getById query removed
- No build errors (confirms nothing depended on it)
- Codebase is cleaner
  </done>
</task>

</tasks>

<verification>
1. `bun run lint` passes
2. `bun run build` passes (confirms dead code removal was safe)
3. File exists: `.planning/phases/04-matching/04-VERIFICATION.md`
4. `grep "createInviteLink" src/routes/org/\$slug/admin/index.tsx` returns useMutation usage
5. `grep "export const getById" convex/profiles.ts` returns no results
</verification>

<success_criteria>
- Phase 04 VERIFICATION.md exists with complete documentation
- Create Invite Link button is functional
- profiles.getById removed from codebase
- All linting and build passes
</success_criteria>

<output>
After completion, create `.planning/phases/06-polish-tech-debt/06-02-SUMMARY.md`
</output>
