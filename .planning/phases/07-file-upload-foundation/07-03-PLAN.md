---
phase: 07-file-upload-foundation
plan: 03
type: execute
wave: 2
depends_on:
  - "07-01"
  - "07-02"
files_modified:
  - package.json
  - bun.lockb
  - src/components/profile/upload/DocumentUpload.tsx
  - src/components/profile/upload/FilePreview.tsx
  - src/components/profile/upload/UploadProgress.tsx
  - src/styles/app.css
autonomous: true

must_haves:
  truths:
    - "User can drag a PDF onto the upload zone and see it accepted"
    - "User can click Browse button to open file picker"
    - "User sees 10MB file size limit displayed"
    - "User sees filename and size after selection"
    - "User sees animated progress bar during upload"
    - "User sees shake animation on errors"
  artifacts:
    - path: "src/components/profile/upload/DocumentUpload.tsx"
      provides: "Main drag-drop upload zone"
      min_lines: 80
    - path: "src/components/profile/upload/FilePreview.tsx"
      provides: "Selected file display"
      min_lines: 30
    - path: "src/components/profile/upload/UploadProgress.tsx"
      provides: "Animated progress bar"
      min_lines: 25
    - path: "src/styles/app.css"
      provides: "Reveal and processing animations"
      contains: "@keyframes reveal"
  key_links:
    - from: "src/components/profile/upload/DocumentUpload.tsx"
      to: "react-dropzone"
      via: "useDropzone hook"
      pattern: "useDropzone"
    - from: "src/components/profile/upload/DocumentUpload.tsx"
      to: "src/components/profile/upload/hooks/useFileUpload.ts"
      via: "import"
      pattern: "import.*useFileUpload"
---

<objective>
Build the main upload zone UI with drag-and-drop, file preview, and progress indication.

Purpose: Create the primary upload interface with "playful confidence" personality per CONTEXT.md - bold colors, bouncy interactions, encouraging copy. This is what users see when uploading their resume/CV.

Output: DocumentUpload component (drag-drop zone), FilePreview component (selected state), UploadProgress component (animated bar), custom CSS animations.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-file-upload-foundation/07-CONTEXT.md
@.planning/phases/07-file-upload-foundation/07-RESEARCH.md

Key context from CONTEXT.md:
- Playful confidence: bold colors, bouncy micro-interactions, encouraging copy
- On drag hover: reveal animation - hidden element animates in to "catch" the file
- After file selected: zone transforms to show filename, size, remove/replace button
- Progress: animated horizontal bar with percentage
- Errors: quick shake + inline message, not scolding

Key context from RESEARCH.md:
- react-dropzone for drag-drop (useDropzone hook)
- Existing animate-shake class in app.css
- Add minimum 500ms animation duration for small file uploads
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install react-dropzone and create DocumentUpload component</name>
  <files>package.json, bun.lockb, src/components/profile/upload/DocumentUpload.tsx</files>
  <action>
First install react-dropzone:
```bash
bun add react-dropzone
```

Create DocumentUpload.tsx with these features:

1. Use useDropzone hook with configuration:
   - accept: { "application/pdf": [".pdf"] }
   - maxSize: 10 * 1024 * 1024 (10MB)
   - maxFiles: 1
   - multiple: false

2. Three visual states:
   a) Idle state (waiting for file):
      - Prominent card with dashed border
      - Icon (Upload or FileText from lucide-react)
      - Encouraging headline: "Drop your resume here" or similar
      - Subtext showing "PDF up to 10MB"
      - Visible "Browse files" button (triggers file picker via onClick)

   b) Drag active state (file hovering):
      - Apply animate-reveal class to reveal element
      - Border color change (use primary color)
      - Scale up slightly (transform: scale(1.02))
      - The "reveal element" - an icon or shape that appears excited to receive file

   c) Drag reject state (wrong file type):
      - Red border, shake animation
      - Show rejection message inline

3. Error handling:
   - On drop rejection: show error message with shake animation
   - Format specific errors: "Please upload a PDF" for wrong type, "File exceeds 10MB (yours: X MB)" for too large

4. Integration:
   - Accept onFileSelect callback prop for when valid file is dropped
   - Accept error state prop to show upload errors (network failures, etc.)

Props interface:
```typescript
interface DocumentUploadProps {
  onFileSelect: (file: File) => void;
  error?: string | null;
  onErrorDismiss?: () => void;
  disabled?: boolean;
}
```

Use cn() from ~/lib/utils for conditional classes. Use existing color variables (--primary, --destructive).
  </action>
  <verify>
`bun run lint` passes; component renders without errors; drag-drop triggers onFileSelect callback
  </verify>
  <done>DocumentUpload component renders idle state, accepts drops, shows drag active/reject states, displays 10MB limit</done>
</task>

<task type="auto">
  <name>Task 2: Create FilePreview component</name>
  <files>src/components/profile/upload/FilePreview.tsx</files>
  <action>
Create FilePreview component showing selected file state:

Props:
```typescript
interface FilePreviewProps {
  file: File;
  onRemove: () => void;
  onReplace?: () => void;
  disabled?: boolean;
}
```

Layout:
- Card with subtle background (bg-muted/50)
- File icon (FileText from lucide-react)
- Filename (truncate if long with ellipsis)
- File size formatted nicely (e.g., "245 KB", "1.2 MB")
- Remove button (X icon) on right side
- Optional "Replace" button if onReplace provided

Styling:
- Smooth transition when appearing (use animate-in from tw-animate-css)
- Hover state on remove button
- File size in muted color

Helper function for formatting bytes:
```typescript
function formatBytes(bytes: number): string {
  if (bytes < 1024) return `${bytes} B`;
  if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;
  return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;
}
```
  </action>
  <verify>`bun run lint` passes; component shows filename and size correctly</verify>
  <done>FilePreview component displays file info with remove button, proper formatting</done>
</task>

<task type="auto">
  <name>Task 3: Create UploadProgress component and CSS animations</name>
  <files>src/components/profile/upload/UploadProgress.tsx, src/styles/app.css</files>
  <action>
Create UploadProgress component:

Props:
```typescript
interface UploadProgressProps {
  progress: number; // 0-100
  status: "uploading" | "processing";
  fileName?: string;
}
```

Features:
- Horizontal progress bar (full width)
- Percentage text (e.g., "45%")
- Status text: "Uploading..." or "Analyzing your resume..."
- Progress bar fills from left with smooth transition (500ms minimum duration)
- Different animation for "processing" status (use pulse/breathing)

Structure:
```
[Status text: "Uploading resume.pdf..."]
[================-------] 67%
```

Progress bar implementation:
- Container: w-full h-2 bg-muted rounded-full overflow-hidden
- Fill: h-full bg-primary transition-all duration-500 ease-out
- Use style={{ width: `${progress}%` }}

Add CSS animations to src/styles/app.css:

1. Reveal animation (for drag hover state):
```css
@keyframes reveal {
  0% {
    opacity: 0;
    transform: scale(0.8) translateY(8px);
  }
  100% {
    opacity: 1;
    transform: scale(1) translateY(0);
  }
}

.animate-reveal {
  animation: reveal 200ms ease-out forwards;
}
```

2. Processing pulse animation (for "Analyzing..." state):
```css
@keyframes pulse-processing {
  0%, 100% {
    opacity: 1;
  }
  50% {
    opacity: 0.6;
  }
}

.animate-pulse-processing {
  animation: pulse-processing 1.5s ease-in-out infinite;
}
```

Place new animations after existing .animate-shake class.
  </action>
  <verify>
`bun run lint` passes; progress bar renders with correct percentage; animations defined in CSS
  </verify>
  <done>UploadProgress shows animated progress bar with percentage; reveal and processing animations added to app.css</done>
</task>

</tasks>

<verification>
- `bun add react-dropzone` succeeds and package appears in package.json
- `bun run lint` passes with no TypeScript errors
- DocumentUpload renders and responds to drag events
- FilePreview shows formatted file info
- UploadProgress bar animates smoothly
- CSS animations (animate-reveal, animate-pulse-processing) are defined
</verification>

<success_criteria>
- User can drag PDF file onto zone and see visual feedback
- User can click Browse to open file picker
- 10MB limit is displayed in the upload zone
- Selected file shows name, size, and remove button
- Progress bar animates during upload with percentage display
- Errors trigger shake animation
- All components use existing design tokens (--primary, --muted, etc.)
</success_criteria>

<output>
After completion, create `.planning/phases/07-file-upload-foundation/07-03-SUMMARY.md`
</output>
