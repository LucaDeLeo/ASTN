---
phase: 07-file-upload-foundation
plan: 04
type: execute
wave: 3
depends_on:
  - "07-03"
files_modified:
  - src/components/profile/upload/TextPasteZone.tsx
  - src/components/profile/upload/index.ts
autonomous: false

must_haves:
  truths:
    - "User can paste a block of text containing career info"
    - "User sees encouraging placeholder in paste area"
    - "User sees soft warning for excessive text length"
    - "Full upload flow works end-to-end"
  artifacts:
    - path: "src/components/profile/upload/TextPasteZone.tsx"
      provides: "Text paste fallback component"
      min_lines: 40
    - path: "src/components/profile/upload/index.ts"
      provides: "Barrel export for upload components"
      exports: ["DocumentUpload", "TextPasteZone", "FilePreview", "UploadProgress", "useFileUpload"]
  key_links:
    - from: "src/components/profile/upload/TextPasteZone.tsx"
      to: "internal state"
      via: "useState for text value"
      pattern: "useState.*string"
---

<objective>
Create the text paste fallback zone and verify the complete upload flow works.

Purpose: Provide an alternative input method for users who prefer to paste text (from LinkedIn, existing resume, etc.) rather than upload a file. Complete the upload foundation by verifying all pieces work together.

Output: TextPasteZone component, barrel export file, verified working upload flow.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-file-upload-foundation/07-CONTEXT.md
@.planning/phases/07-file-upload-foundation/07-03-SUMMARY.md

Key context from CONTEXT.md:
- Text paste is fallback - secondary option below primary upload zone
- On click: reveal with flair - playful animation matching upload zone energy
- Placeholder: encouraging - "Paste your resume, LinkedIn summary, or anything career-related..."
- Limits: soft warning - no hard limit, friendly nudge if text seems excessive
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TextPasteZone component</name>
  <files>src/components/profile/upload/TextPasteZone.tsx</files>
  <action>
Create TextPasteZone as a collapsible text input area:

Props:
```typescript
interface TextPasteZoneProps {
  onTextSubmit: (text: string) => void;
  disabled?: boolean;
}
```

Features:

1. Collapsed state (default):
   - Text link: "Or paste text instead" or similar
   - Small icon (ClipboardPaste from lucide-react)
   - On click: expand with animate-reveal animation

2. Expanded state:
   - Textarea with encouraging placeholder: "Paste your resume, LinkedIn summary, career bio, or anything career-related..."
   - Character count display (bottom right)
   - Soft warning if text > 10000 characters: "That's quite a lot! We'll do our best." (not blocking)
   - "Continue" button to submit
   - "Cancel" link to collapse back

3. Visual styling:
   - Use existing Card component or similar styling
   - Textarea: min-height 150px, resize: vertical
   - Muted text for placeholder
   - Primary color for Continue button

State management:
- isExpanded: boolean
- text: string (controlled textarea)

Animation:
- Use animate-reveal class when expanding
- Consider adding smooth height transition

DO NOT save to database - this component just captures text and calls onTextSubmit. Phase 8 will handle extraction from the text.
  </action>
  <verify>`bun run lint` passes; component renders collapsed and expands on click</verify>
  <done>TextPasteZone shows collapsed state, expands with animation, accepts text input, has soft length warning</done>
</task>

<task type="auto">
  <name>Task 2: Create barrel export file</name>
  <files>src/components/profile/upload/index.ts</files>
  <action>
Create barrel export for all upload components and hooks:

```typescript
// Components
export { DocumentUpload } from "./DocumentUpload";
export { FilePreview } from "./FilePreview";
export { UploadProgress } from "./UploadProgress";
export { TextPasteZone } from "./TextPasteZone";

// Hooks
export { useFileUpload } from "./hooks/useFileUpload";

// Utilities
export { uploadWithProgress } from "./utils/uploadWithProgress";

// Types (re-export if needed)
export type { UploadState } from "./hooks/useFileUpload";
```

This allows consumers to import from a single path:
```typescript
import { DocumentUpload, TextPasteZone, useFileUpload } from "~/components/profile/upload";
```
  </action>
  <verify>`bun run lint` passes; imports resolve correctly</verify>
  <done>All upload components and hooks exported from index.ts</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete file upload foundation: drag-drop zone, file preview, progress bar, text paste fallback, backend mutations, and upload hook.
  </what-built>
  <how-to-verify>
1. Start dev server: `bun run dev`

2. Create a test route to verify (temporary):
   - Add a minimal test at src/routes/test-upload.tsx that imports and renders DocumentUpload + TextPasteZone
   - Or test in browser console using Convex mutations directly

3. Test drag-and-drop:
   - Drag a PDF file onto the upload zone
   - Verify: Zone highlights, reveal animation plays
   - Drop the file
   - Verify: FilePreview shows with filename and size

4. Test file picker:
   - Click "Browse files" button
   - Select a PDF
   - Verify: Same FilePreview appears

5. Test validation:
   - Drag a non-PDF file (e.g., .txt)
   - Verify: Red border, shake animation, error message
   - Drag a file > 10MB (if available)
   - Verify: Error shows actual size vs limit

6. Test progress (requires actual upload):
   - If upload mutation works, trigger upload
   - Verify: Progress bar animates, percentage updates

7. Test text paste:
   - Click "Or paste text instead"
   - Verify: Zone expands with animation
   - Paste some text
   - Verify: Character count shows
   - Paste very long text (>10k chars)
   - Verify: Soft warning appears (not blocking)

8. Test error recovery:
   - Simulate network error (disable network in devtools, try upload)
   - Verify: Error state shows with retry option
   - Re-enable network, click retry
   - Verify: Upload continues with same file
  </how-to-verify>
  <resume-signal>Type "verified" if all checks pass, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
- `bun run lint` passes with no errors
- All components export correctly from index.ts
- Drag-and-drop works with visual feedback
- File picker opens via Browse button
- Progress bar animates during upload
- Text paste zone expands with animation
- Errors show shake animation and can retry
</verification>

<success_criteria>
- UPLD-01: User can upload PDF via drag-and-drop zone - VERIFIED
- UPLD-02: User can upload PDF via file picker button - VERIFIED
- UPLD-03: User can paste text block with career info - VERIFIED
- UPLD-04: User sees progress indicator during upload - VERIFIED
- UPLD-05: User sees file size limit (10MB) before uploading - VERIFIED
- UPLD-06: User sees clear error message if upload fails - VERIFIED
</success_criteria>

<output>
After completion, create `.planning/phases/07-file-upload-foundation/07-04-SUMMARY.md`
</output>
