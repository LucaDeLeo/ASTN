---
phase: 09-review-apply-ui
plan: 02
type: execute
wave: 2
depends_on: ["09-01"]
files_modified:
  - src/components/profile/extraction/ExtractionFieldCard.tsx
  - src/components/profile/extraction/ExpandableEntryCard.tsx
  - src/components/profile/extraction/ResumeExtractionReview.tsx
  - src/components/profile/extraction/index.ts
autonomous: true

must_haves:
  truths:
    - "User sees all extracted fields organized by section (Basic Info, Education, Work History, Skills)"
    - "User can accept, reject, or edit any individual field"
    - "Education and work history entries show collapsed summary that expands to full details"
    - "User sees field counter: X of Y fields will be applied"
    - "Missing fields show placeholder text (Not found in document)"
  artifacts:
    - path: "src/components/profile/extraction/ExtractionFieldCard.tsx"
      provides: "Card component for simple fields with accept/reject/edit"
      exports: ["ExtractionFieldCard"]
    - path: "src/components/profile/extraction/ExpandableEntryCard.tsx"
      provides: "Expandable card for education/work array entries"
      exports: ["ExpandableEntryCard"]
    - path: "src/components/profile/extraction/ResumeExtractionReview.tsx"
      provides: "Main review container component"
      exports: ["ResumeExtractionReview"]
  key_links:
    - from: "ResumeExtractionReview"
      to: "useResumeReview"
      via: "hook consumption"
      pattern: "useResumeReview\\(extractedData\\)"
    - from: "ResumeExtractionReview"
      to: "ExtractionFieldCard"
      via: "renders simple fields"
      pattern: "<ExtractionFieldCard"
    - from: "ResumeExtractionReview"
      to: "ExpandableEntryCard"
      via: "renders array entries"
      pattern: "<ExpandableEntryCard"
---

<objective>
Build review UI components that let users accept, reject, and edit extracted data

Purpose: Provide intuitive interface for reviewing extraction results before applying to profile
Output: Card components and main review container matching existing ExtractionReview patterns
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-review-apply-ui/09-CONTEXT.md
@.planning/phases/09-review-apply-ui/09-RESEARCH.md
@src/components/profile/enrichment/ExtractionReview.tsx
@src/components/profile/extraction/types.ts
@src/components/profile/extraction/hooks/useResumeReview.ts
@src/components/profile/skills/SkillsInput.tsx
@src/components/ui/card.tsx
@src/components/ui/button.tsx
@src/components/ui/badge.tsx
@src/components/ui/input.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create field card and expandable entry components</name>
  <files>
    src/components/profile/extraction/ExtractionFieldCard.tsx
    src/components/profile/extraction/ExpandableEntryCard.tsx
  </files>
  <action>
Create two card components following ExtractionReview.tsx patterns exactly.

**ExtractionFieldCard.tsx:**
Reusable card for simple fields (name, location, email-display-only).

Props:
```typescript
interface ExtractionFieldCardProps {
  label: string;
  value: string | undefined;
  editedValue?: string;
  status: ResumeReviewStatus;
  onAccept: () => void;
  onReject: () => void;
  onEdit: (value: string) => void;
  displayOnly?: boolean; // For email - shows but can't be applied
  placeholder?: string;  // "Not found in document"
}
```

UI structure (match ExtractionReview.tsx exactly):
- Card with status-based styling (green for accepted, amber for edited, grey for rejected)
- Label + Badge (status indicator)
- Value display or Input when editing
- Action buttons: Check, X, Pencil (from lucide-react)
- Inline editing: click pencil -> shows input -> blur saves

For displayOnly fields: show value with "(for verification only)" note, hide action buttons.
For missing values: show placeholder text "Not found in document" in muted style.

**ExpandableEntryCard.tsx:**
Expandable card for education/work history array entries.

Props:
```typescript
interface ExpandableEntryCardProps {
  type: "education" | "workHistory";
  entry: EducationEntry | WorkHistoryEntry; // From types.ts
  editedEntry?: EducationEntry | WorkHistoryEntry;
  status: ResumeReviewStatus;
  onAccept: () => void;
  onReject: () => void;
  onEdit: (entry: EducationEntry | WorkHistoryEntry) => void;
}
```

UI structure:
- Collapsed state: Card header button with:
  - Title summary: "Software Engineer at Anthropic" or "PhD at MIT"
  - Date range: "(2022-2024)" or "(Jan 2021 - Present)"
  - ChevronDown icon that rotates 180deg when expanded
  - Status badge (accepted/edited/rejected)
  - Action buttons (accept/reject/edit)
- Expanded state (triggered by clicking card header):
  - All fields as editable inputs (organization, title, dates, description for work; institution, degree, field, years for education)
  - Changes update via onEdit callback

Date formatting for display:
- Work: "startDate - endDate" or "startDate - Present" if current
- Education: "startYear - endYear" or "startYear - Present" if current

Use smooth transition for expand/collapse: animate height or use CSS grid trick.
  </action>
  <verify>
- Components render without errors
- TypeScript compiles: `npx tsc --noEmit`
- Status colors match ExtractionReview.tsx (green-50/300 accepted, amber-50/300 edited, slate-50/200 rejected)
  </verify>
  <done>
- ExtractionFieldCard handles simple string fields with inline editing
- ExpandableEntryCard shows collapsed summary, expands to full editable form
- Both components use consistent status-based styling from ExtractionReview pattern
  </done>
</task>

<task type="auto">
  <name>Task 2: Create main review container with skills and footer</name>
  <files>
    src/components/profile/extraction/ResumeExtractionReview.tsx
    src/components/profile/extraction/index.ts
  </files>
  <action>
Create main container component that orchestrates the review UI.

**ResumeExtractionReview.tsx:**

Props:
```typescript
interface ResumeExtractionReviewProps {
  extractedData: ExtractedData;
  onApply: (data: AppliedData) => Promise<void>;
  onSkip: () => void;
  isApplying?: boolean;
}
```

Structure:
```
<div className="space-y-6">
  {/* Header */}
  <div>
    <h3>Review Extracted Information</h3>
    <p>Accept, reject, or edit the information extracted from your document.</p>
  </div>

  {/* Basic Info Section */}
  <section>
    <h4>Basic Information</h4>
    <ExtractionFieldCard ... for name />
    <ExtractionFieldCard ... for location />
    <ExtractionFieldCard ... for email displayOnly />
  </section>

  {/* Education Section */}
  {extractedData.education?.length > 0 && (
    <section>
      <h4>Education</h4>
      {education.map((entry, i) => (
        <ExpandableEntryCard key={i} type="education" ... />
      ))}
    </section>
  )}

  {/* Work History Section */}
  {extractedData.workHistory?.length > 0 && (
    <section>
      <h4>Work History</h4>
      {workHistory.map((entry, i) => (
        <ExpandableEntryCard key={i} type="workHistory" ... />
      ))}
    </section>
  )}

  {/* Skills Section */}
  {(skills?.length > 0 || rawSkills?.length > 0) && (
    <section>
      <h4>Skills</h4>
      {/* Show matched skills with SkillsInput for editing */}
      <SkillsInput
        selectedSkills={editedSkills ?? skills ?? []}
        onSkillsChange={(s) => updateSkillsValue(s)}
      />
      {/* Show rawSkills as reference: "Also mentioned: ..." */}
      {rawSkills?.length > 0 && (
        <p className="text-sm text-muted-foreground mt-2">
          Also mentioned: {rawSkills.join(", ")}
        </p>
      )}
      {/* Accept/reject buttons for skills as a group */}
    </section>
  )}

  {/* Gap indicator footer */}
  <div className="flex items-center justify-between pt-4 border-t">
    <div>
      <p className="text-sm text-slate-500">
        {acceptedCount} of {totalFields} fields will be applied
      </p>
      {hasGaps && (
        <p className="text-xs text-muted-foreground">
          Enrichment chat can help fill in the remaining details
        </p>
      )}
    </div>
    <div className="flex gap-2">
      <Button variant="outline" onClick={onSkip}>
        Skip to Manual Entry
      </Button>
      <Button onClick={handleApply} disabled={!hasAcceptedFields || isApplying}>
        {isApplying ? "Applying..." : "Apply to Profile"}
      </Button>
    </div>
  </div>
</div>
```

Use useResumeReview hook for all state management:
- Items list transformation
- Status updates
- Value editing
- Get accepted data for apply

On apply:
1. Call getAcceptedData() from hook
2. Pass to onApply prop
3. Parent handles mutation and navigation

**Update index.ts:**
Add exports for new components:
```typescript
export { ExtractionFieldCard } from "./ExtractionFieldCard";
export { ExpandableEntryCard } from "./ExpandableEntryCard";
export { ResumeExtractionReview } from "./ResumeExtractionReview";
```
  </action>
  <verify>
- Component renders with mock data
- TypeScript compiles: `npx tsc --noEmit`
- All sections appear when data present
- Missing sections hidden gracefully
- Counter shows correct accepted/total counts
  </verify>
  <done>
- ResumeExtractionReview organizes fields by section
- Uses useResumeReview hook for state
- Integrates SkillsInput for skill editing
- Shows field counter and Apply button
- All components exported from index.ts
  </done>
</task>

</tasks>

<verification>
1. TypeScript compiles: `npx tsc --noEmit`
2. Lint passes: `bun run lint`
3. Components match ExtractionReview.tsx visual patterns
4. All exports available from src/components/profile/extraction/index.ts
</verification>

<success_criteria>
- ExtractionFieldCard handles simple fields with accept/reject/edit
- ExpandableEntryCard shows collapsed summary, expands for editing
- ResumeExtractionReview organizes all fields by section
- Skills section integrates SkillsInput component
- Footer shows "X of Y fields" counter
- All components follow existing ExtractionReview styling patterns
</success_criteria>

<output>
After completion, create `.planning/phases/09-review-apply-ui/09-02-SUMMARY.md`
</output>
