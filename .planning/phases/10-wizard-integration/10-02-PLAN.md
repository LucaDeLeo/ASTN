---
phase: 10-wizard-integration
plan: 02
type: execute
wave: 2
depends_on: ['10-01']
files_modified:
  - src/components/profile/wizard/ProfileCreationWizard.tsx
  - src/components/profile/wizard/PostApplySummary.tsx
  - src/components/profile/wizard/index.ts
autonomous: true

must_haves:
  truths:
    - 'User can navigate back from extraction/review without losing extracted data'
    - 'After applying extraction, user sees profile completeness percentage'
    - 'User can skip enrichment from the summary screen'
    - 'Full flow works: entry selection -> upload -> extract -> review -> apply -> summary -> enrich'
  artifacts:
    - path: 'src/components/profile/wizard/ProfileCreationWizard.tsx'
      provides: 'State machine orchestrating full profile creation flow'
      exports: ['ProfileCreationWizard']
    - path: 'src/components/profile/wizard/PostApplySummary.tsx'
      provides: 'Completeness display with enrichment skip option'
      exports: ['PostApplySummary']
  key_links:
    - from: 'ProfileCreationWizard'
      to: 'useFileUpload, useExtraction hooks'
      via: 'hook composition'
      pattern: 'useFileUpload|useExtraction'
    - from: 'ProfileCreationWizard'
      to: 'EntryPointSelector, WizardStepIndicator'
      via: 'conditional rendering based on state'
      pattern: "wizardState\\."
    - from: 'PostApplySummary'
      to: 'api.profiles.getMyCompleteness'
      via: 'useQuery'
      pattern: 'useQuery.*getMyCompleteness'
---

<objective>
Create the wizard orchestration layer that ties together all existing components into a cohesive profile creation flow.

Purpose: Users need a seamless experience from choosing their entry point through extraction, review, and enrichment. The orchestrator manages state transitions and ensures data isn't lost during navigation.

Output: ProfileCreationWizard (main orchestrator) and PostApplySummary (post-extraction completeness screen)
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-wizard-integration/10-CONTEXT.md
@.planning/phases/10-wizard-integration/10-RESEARCH.md
@.planning/phases/10-wizard-integration/10-01-SUMMARY.md

Key existing components to reuse:

- useFileUpload hook (src/components/profile/upload/hooks/useFileUpload.ts)
- useExtraction hook (src/components/profile/upload/hooks/useExtraction.ts)
- DocumentUpload, TextPasteZone, FilePreview, UploadProgress, ExtractionProgress, ExtractionError
- ResumeExtractionReview (src/components/profile/extraction/ResumeExtractionReview.tsx)
- api.profiles.applyExtractedProfile mutation
- api.profiles.getMyCompleteness query

Reference test-upload.tsx for the complete upload/extraction flow pattern.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PostApplySummary component</name>
  <files>src/components/profile/wizard/PostApplySummary.tsx</files>
  <action>
Create the summary screen shown after extraction data is applied to profile.

Props interface:

- onContinueToEnrichment: () => void
- onSkip: () => void
- onBackToManual: () => void

Display:

- Success message: "Profile updated from your resume!"
- Completeness indicator using api.profiles.getMyCompleteness query
  - Show percentage: "Your profile is X% complete"
  - Use Progress component or visual bar
- Summary of what was imported (optional - can show section counts)
- Call to action: "Continue to chat with our AI to fill in the gaps"

Actions:

- Primary button: "Continue to Enrichment" -> onContinueToEnrichment
- Secondary text link: "Skip enrichment for now" -> onSkip
- Tertiary option: "Or edit your profile manually" -> onBackToManual

Visual design:

- Card container with success styling (green accent or CheckCircle icon)
- Centered layout
- Clear visual hierarchy: success > completeness > actions
- Use shadcn Card, Button, Progress components
  </action>
  <verify>Component shows completeness percentage from query, buttons trigger callbacks correctly</verify>
  <done>PostApplySummary displays completeness, success message, and all three action buttons work</done>
  </task>

<task type="auto">
  <name>Task 2: Create ProfileCreationWizard orchestrator</name>
  <files>src/components/profile/wizard/ProfileCreationWizard.tsx</files>
  <action>
Create the main wizard container that orchestrates the full profile creation flow.

Props interface:

- onComplete: () => void - Called when wizard flow ends (skip or finish enrichment)
- initialStep?: "input" | "manual" | "chat" - Where to start (default: "input")

State machine (discriminated union):

```typescript
type WizardState =
  | { step: 'input'; entryPoint?: undefined }
  | { step: 'uploading'; entryPoint: 'upload'; file: File }
  | { step: 'extracting'; entryPoint: 'upload' | 'paste' }
  | {
      step: 'review'
      entryPoint: 'upload' | 'paste'
      extractedData: ExtractedData
    }
  | { step: 'summary' }
  | { step: 'enrich'; fromExtraction: boolean }
  | { step: 'manual' }
```

Compose existing hooks at wizard level (lifted state):

- const { state: uploadState, selectFile, clearFile, upload } = useFileUpload()
- const { state: extractionState, extractFromDocument, extractFromText, reset } = useExtraction()
- Store extractedData in wizard state when extraction succeeds

Flow logic:

1. **input step**: Render WizardStepIndicator (step="input") + EntryPointSelector
   - onSelect("upload") -> set entryPoint, wait for file selection
   - onSelect("paste") -> set entryPoint, show TextPasteZone
   - onSelect("manual") -> transition to step: "manual"
   - onSelect("chat") -> transition to step: "enrich", fromExtraction: false

2. **upload flow** (entryPoint="upload"):
   - Show DocumentUpload, on file select transition to "uploading"
   - "uploading": Show FilePreview + UploadProgress, auto-trigger extraction on success
   - "extracting": Show ExtractionProgress
   - On extraction success: transition to "review" with extractedData
   - On extraction error: Show ExtractionError with retry/paste fallback/manual options

3. **paste flow** (entryPoint="paste"):
   - Show TextPasteZone expanded
   - On submit: extractFromText, transition to "extracting"
   - Same extraction -> review flow

4. **review step**: Render WizardStepIndicator (step="review") + ResumeExtractionReview
   - Back button: Return to "input" step BUT preserve extractedData in state
   - Apply button: Call applyExtractedProfile mutation, transition to "summary"

5. **summary step**: Render WizardStepIndicator (step="enrich") + PostApplySummary
   - Continue to Enrichment: transition to "enrich", fromExtraction: true
   - Skip: call onComplete
   - Edit manually: transition to "manual"

6. **enrich step**: Render existing EnrichmentStep component with fromExtraction prop

7. **manual step**: Signal to parent to show ProfileWizard with step="basic"

Use grid overlay pattern from test-upload.tsx for smooth transitions between states.

Key behaviors:

- Preserve extractedData when user clicks back from review
- Auto-trigger extraction when upload completes (useEffect)
- Handle retry for both upload and extraction errors
  </action>
  <verify>Full flow works: select upload -> select file -> upload -> extract -> review -> apply -> summary -> enrich</verify>
  <done>ProfileCreationWizard orchestrates full flow with state preservation on back navigation</done>
  </task>

<task type="auto">
  <name>Task 3: Update wizard barrel export</name>
  <files>src/components/profile/wizard/index.ts</files>
  <action>
Update or create barrel export for the wizard module.

Add exports:

- export { WizardStepIndicator } from "./WizardStepIndicator"
- export { EntryPointSelector } from "./EntryPointSelector"
- export { PostApplySummary } from "./PostApplySummary"
- export { ProfileCreationWizard } from "./ProfileCreationWizard"

Keep existing exports (ProfileWizard, WizardProgress, etc.)
</action>
<verify>All new components can be imported from ~/components/profile/wizard</verify>
<done>Barrel export updated with all new wizard components</done>
</task>

</tasks>

<verification>
1. TypeScript compiles without errors
2. ProfileCreationWizard renders entry point selection initially
3. Upload flow: file select -> upload -> extraction -> review -> apply works
4. Paste flow: text entry -> extraction -> review -> apply works
5. Back from review returns to input selection with extractedData preserved
6. PostApplySummary shows correct completeness percentage
7. Skip enrichment calls onComplete
8. Continue to enrichment shows EnrichmentStep with fromExtraction=true
</verification>

<success_criteria>

- ProfileCreationWizard.tsx exports working component
- PostApplySummary.tsx exports working component
- Full upload-to-enrichment flow executes without errors
- State preservation on back navigation works
- No duplicate state management (hooks composed at wizard level)
  </success_criteria>

<output>
After completion, create `.planning/phases/10-wizard-integration/10-02-SUMMARY.md`
</output>
