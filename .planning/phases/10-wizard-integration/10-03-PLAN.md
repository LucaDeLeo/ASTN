---
phase: 10-wizard-integration
plan: 03
type: execute
wave: 3
depends_on: ["10-02"]
files_modified:
  - src/routes/profile/edit.tsx
  - src/components/profile/wizard/steps/EnrichmentStep.tsx
  - src/components/profile/wizard/ProfileWizard.tsx
autonomous: false

must_haves:
  truths:
    - "New users see entry point selection when navigating to profile edit"
    - "Chat-first entry asks about CV before starting questions"
    - "User can switch from upload to manual entry at any point"
    - "Full integrated flow works end-to-end"
  artifacts:
    - path: "src/routes/profile/edit.tsx"
      provides: "Route with input step for new profile creation"
      contains: "ProfileCreationWizard"
    - path: "src/components/profile/wizard/steps/EnrichmentStep.tsx"
      provides: "Chat-first CV prompt"
      contains: "Do you have a CV"
  key_links:
    - from: "/profile/edit?step=input"
      to: "ProfileCreationWizard"
      via: "route search params"
      pattern: "step.*input"
    - from: "EnrichmentStep"
      to: "conversation opening"
      via: "conditional greeting based on entry point"
      pattern: "fromExtraction|chatFirst"
---

<objective>
Integrate the wizard into the existing profile edit route and add chat-first CV prompt.

Purpose: Connect all the pieces so users have a unified experience. New users should see the entry point selection, and users who choose chat-first should be asked about uploading a CV before the AI starts asking questions.

Output: Integrated profile creation flow accessible at /profile/edit with entry point selection
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-wizard-integration/10-CONTEXT.md
@.planning/phases/10-wizard-integration/10-RESEARCH.md
@.planning/phases/10-wizard-integration/10-01-SUMMARY.md
@.planning/phases/10-wizard-integration/10-02-SUMMARY.md

From CONTEXT.md:
- Chat-first entry point: ask "Do you have a CV I could look at?" before starting questions

Existing route structure:
- /profile/edit uses search params for step (basic, education, work, goals, skills, enrichment, privacy)
- fromExtraction param already handled for enrichment step
</context>

<tasks>

<task type="auto">
  <name>Task 1: Integrate ProfileCreationWizard into route</name>
  <files>src/routes/profile/edit.tsx</files>
  <action>
Extend the profile edit route to support the new wizard flow.

Update search schema:
```typescript
const stepSchema = z.enum([
  "input",      // NEW - entry point selection
  "basic",
  "education",
  "work",
  "goals",
  "skills",
  "enrichment",
  "privacy",
]);

const searchSchema = z.object({
  step: stepSchema.optional().default("input"),  // Changed default to "input"
  fromExtraction: z.string().optional(),
  entryPoint: z.enum(["upload", "paste", "manual", "chat"]).optional(),
});
```

Update AuthenticatedContent:
- If step === "input": Render ProfileCreationWizard
  - onComplete={() => navigate({ to: "/profile" })} - go to profile view
  - When wizard signals "manual", change step to "basic"
  - When wizard signals "enrich", change step to "enrichment" with fromExtraction
- If step is manual step (basic/education/etc): Render ProfileWizard as before
- If step === "enrichment": Render ProfileWizard with enrichment step

Handle wizard completion:
- ProfileCreationWizard.onComplete -> navigate to /profile (done)
- Manual entry from wizard -> set step="basic"
- Enrich from wizard -> set step="enrichment", fromExtraction="true"

Detection for new vs returning users:
- For simplicity, default to "input" step
- User can skip to any step via URL params if they want
- Existing profiles don't need special handling - they can still use entry flow or go direct

Update page title/description based on step:
- step="input": "Create Your Profile" / "Choose how to get started"
- step="enrichment": "Profile Enrichment" / existing text
- other steps: "Edit Profile" / existing text
  </action>
  <verify>Navigate to /profile/edit shows entry point selection, selecting upload starts wizard flow</verify>
  <done>Route shows ProfileCreationWizard for input step, transitions to ProfileWizard for manual steps</done>
</task>

<task type="auto">
  <name>Task 2: Add chat-first CV prompt to EnrichmentStep</name>
  <files>src/components/profile/wizard/steps/EnrichmentStep.tsx</files>
  <action>
Enhance EnrichmentStep to handle chat-first entry point with CV prompt.

Add new prop:
```typescript
interface EnrichmentStepProps {
  profile: { ... } | null;
  fromExtraction?: boolean;
  chatFirst?: boolean;  // NEW - started from chat-first entry point
}
```

Update auto-greet logic:
```typescript
useEffect(() => {
  if (profile?._id && messages.length === 0 && !isLoading && !hasAutoGreeted.current) {
    hasAutoGreeted.current = true;

    if (fromExtraction) {
      // Existing behavior
      void sendMessage("Hi! I just imported my resume. Can you help me complete my profile?");
    } else if (chatFirst) {
      // NEW: Chat-first prompt about CV
      void sendMessage("Hi! I'd like help creating my profile. I'm starting from scratch.");
    }
    // If neither, no auto-greet (user types first)
  }
}, [fromExtraction, chatFirst, profile?._id, messages.length, isLoading, sendMessage]);
```

Note: The actual "Do you have a CV?" question will come from Claude's response to the chat-first greeting. The conversation.ts already has profile context and will adapt its questions based on what's missing. We seed the conversation with the user's intent.

Alternative approach (if Claude response isn't asking about CV):
- Could add a small banner/card above the chat: "Tip: Have a resume? Go back and upload it for faster setup"
- Keep this simple for now - Claude's conversational AI should naturally ask about documents
  </action>
  <verify>Chat-first entry auto-sends greeting message, enrichment from extraction works as before</verify>
  <done>EnrichmentStep handles chatFirst prop with appropriate auto-greeting</done>
</task>

<task type="auto">
  <name>Task 3: Wire chatFirst through ProfileWizard</name>
  <files>src/components/profile/wizard/ProfileWizard.tsx</files>
  <action>
Update ProfileWizard to pass chatFirst prop to EnrichmentStep.

Add new prop to ProfileWizard:
```typescript
interface ProfileWizardProps {
  currentStep: StepId;
  onStepChange: (step: StepId) => void;
  fromExtraction?: boolean;
  chatFirst?: boolean;  // NEW
}
```

Pass to EnrichmentStep:
```typescript
case "enrichment":
  return <EnrichmentStep profile={profile} fromExtraction={fromExtraction} chatFirst={chatFirst} />;
```

This allows the route to signal when enrichment was reached via chat-first path.
  </action>
  <verify>ProfileWizard passes chatFirst prop to EnrichmentStep</verify>
  <done>chatFirst prop flows from route through ProfileWizard to EnrichmentStep</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete profile creation wizard with:
- Entry point selection (4 options)
- Step indicator (Input/Review/Enrich)
- Upload flow with extraction
- Paste flow with extraction
- Review UI with back navigation preserving data
- Post-apply summary with completeness
- Manual entry fallback
- Chat-first entry with CV prompt
  </what-built>
  <how-to-verify>
1. Navigate to /profile/edit (or clear profile and return)
2. Verify entry point selection shows 4 options with Upload highlighted
3. Click "How to get your LinkedIn PDF" - verify it expands with instructions

Test Upload flow:
4. Select "Upload your resume"
5. Upload a PDF resume
6. Verify extraction progress shows
7. Verify review screen appears with extracted data
8. Click Apply - verify summary screen shows completeness %
9. Click "Continue to Enrichment" - verify chat starts with context-aware greeting

Test Paste flow:
10. Start over (navigate to /profile/edit?step=input)
11. Select "Paste text"
12. Paste resume text, click Continue
13. Verify same extraction -> review -> summary flow

Test Manual entry:
14. Start over
15. Select "Fill out manually"
16. Verify redirects to ProfileWizard basic step

Test Chat-first:
17. Start over
18. Select "Chat with AI"
19. Verify enrichment chat opens with greeting message sent

Test back navigation:
20. Upload and extract a resume
21. On review screen, click Back
22. Verify entry selection shows again
23. Select upload again - verify previously extracted data is NOT lost (this is stretch goal, may reset)

Expected: All flows work smoothly with appropriate transitions and data preservation
  </how-to-verify>
  <resume-signal>Type "approved" or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
1. /profile/edit shows entry point selection by default
2. All 4 entry points navigate to correct flow
3. Upload -> extract -> review -> apply -> summary -> enrich works
4. Paste -> extract -> review -> apply -> summary -> enrich works
5. Manual entry -> ProfileWizard basic step
6. Chat-first -> EnrichmentStep with auto-greeting
7. Step indicator reflects current position
8. Completeness percentage shows on summary screen
</verification>

<success_criteria>
- INTG-01: Profile wizard offers four entry points - VERIFIED
- INTG-03: Enrichment chat is context-aware - VERIFIED (existing + chatFirst)
- INTG-04: User can switch from upload to manual - VERIFIED
- All TypeScript errors resolved
- Human verification checkpoint passed
</success_criteria>

<output>
After completion, create `.planning/phases/10-wizard-integration/10-03-SUMMARY.md`
</output>
