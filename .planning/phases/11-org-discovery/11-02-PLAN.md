---
phase: 11-org-discovery
plan: 02
type: execute
wave: 2
depends_on: ["11-01"]
files_modified:
  - src/components/org/OrgCard.tsx
  - src/components/org/OrgCarousel.tsx
  - src/routes/index.tsx
  - src/components/settings/LocationPrivacyToggle.tsx
  - src/routes/settings/index.tsx
autonomous: true

must_haves:
  truths:
    - "User sees org suggestions carousel on authenticated dashboard"
    - "Each org card shows name, location, member count, description"
    - "User can scroll horizontally through suggestions"
    - "User can toggle location discoverability in settings"
    - "Empty state prompts user to enable location or shows global orgs"
  artifacts:
    - path: "src/components/org/OrgCard.tsx"
      provides: "Reusable org display card"
      exports: ["OrgCard"]
    - path: "src/components/org/OrgCarousel.tsx"
      provides: "Horizontal scroll container for org cards"
      exports: ["OrgCarousel"]
    - path: "src/routes/index.tsx"
      provides: "Dashboard with org suggestions section"
      contains: "getSuggestedOrgs"
    - path: "src/components/settings/LocationPrivacyToggle.tsx"
      provides: "Location privacy control component"
      exports: ["LocationPrivacyToggle"]
  key_links:
    - from: "src/routes/index.tsx"
      to: "api.orgs.discovery.getSuggestedOrgs"
      via: "useQuery hook"
      pattern: "useQuery.*getSuggestedOrgs"
    - from: "src/components/settings/LocationPrivacyToggle.tsx"
      to: "api.profiles.updateLocationPrivacy"
      via: "useMutation hook"
      pattern: "useMutation.*updateLocationPrivacy"
---

<objective>
Build dashboard org suggestions section and settings location toggle.

Purpose: Surface relevant organizations to users on their dashboard while giving them control over location-based features.
Output: OrgCard, OrgCarousel components, dashboard suggestions section, and LocationPrivacyToggle in settings.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-org-discovery/11-CONTEXT.md
@.planning/phases/11-org-discovery/11-RESEARCH.md
@.planning/phases/11-org-discovery/11-01-SUMMARY.md

# Patterns to follow
@src/components/org/MemberDirectory.tsx
@src/components/settings/NotificationPrefsForm.tsx
@src/routes/index.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create OrgCard and OrgCarousel components</name>
  <files>src/components/org/OrgCard.tsx, src/components/org/OrgCarousel.tsx</files>
  <action>
Create src/components/org/OrgCard.tsx:
- Accept org prop with: _id, name, slug, logoUrl, description, city, country, memberCount, upcomingEventCount
- Accept optional variant prop: "carousel" | "list" (default "carousel")
- Display:
  - Logo or Building2 icon placeholder (size-12, rounded-lg)
  - Org name (truncated if long)
  - Location badge: MapPin icon + city, country (if available)
  - Description snippet (line-clamp-2)
  - Stats row: Users icon + member count, Calendar icon + upcoming events (if > 0)
  - "View Organization" button linking to /org/$slug
- Use Card from shadcn/ui
- Follow MemberDirectory.tsx card styling patterns
- Use lucide-react icons: Building2, MapPin, Users, Calendar
- Width: w-72 for carousel variant, full width for list variant

Create src/components/org/OrgCarousel.tsx:
- Accept orgs array prop
- Accept optional emptyState prop for custom empty content
- Use CSS scroll-snap for horizontal scrolling:
  ```
  className="flex gap-4 overflow-x-auto snap-x snap-mandatory pb-4 -mx-4 px-4"
  ```
- Each card wrapper: `className="snap-start shrink-0"`
- Include subtle scroll hint (gradient fade on right edge)
- If empty and emptyState provided, render emptyState
- If empty and no emptyState, render nothing
  </action>
  <verify>
Run `bun run lint` - no errors.
Components compile without TypeScript errors.
  </verify>
  <done>
OrgCard displays rich organization information with consistent styling. OrgCarousel provides smooth horizontal scrolling using native CSS scroll-snap.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add org suggestions section to dashboard</name>
  <files>src/routes/index.tsx</files>
  <action>
Modify src/routes/index.tsx to show org suggestions for authenticated users:

1. Import necessary components and hooks:
   - AuthLoading, Authenticated, Unauthenticated from convex/react
   - useQuery from convex/react
   - api from convex/_generated/api
   - OrgCarousel from ~/components/org/OrgCarousel
   - OrgCard from ~/components/org/OrgCard
   - Button, Link from existing imports
   - MapPin icon from lucide-react

2. Keep existing landing page content for unauthenticated users

3. For authenticated users, render a dashboard view instead:
   - Section header: "Suggested Organizations"
   - Subheader text: "Organizations near you or with global presence"
   - useQuery(api.orgs.discovery.getSuggestedOrgs) to fetch suggestions
   - Render OrgCarousel with fetched orgs
   - Loading state: show spinner while query loading

4. Empty state handling:
   - If getSuggestedOrgs returns empty array AND user has no location set:
     Show prompt card: "Enable location-based suggestions to discover organizations near you"
     Include "Enable in Settings" button linking to /settings
   - If returns empty but user has location: Show "No organizations near you yet. Check back later!"

5. Structure the authenticated view:
   ```tsx
   <section className="mb-8">
     <h2 className="text-xl font-semibold text-slate-900 mb-2">Suggested Organizations</h2>
     <p className="text-slate-600 mb-4">Organizations near you or with global presence</p>
     {suggestedOrgs === undefined ? (
       <Spinner />
     ) : suggestedOrgs.length > 0 ? (
       <OrgCarousel orgs={suggestedOrgs} />
     ) : (
       <EmptyStatePrompt />
     )}
   </section>
   ```

6. Keep existing "Browse Opportunities" CTA below the suggestions section
  </action>
  <verify>
Run `bun run lint` - no errors.
Navigate to / while authenticated - see org suggestions section.
Navigate to / while unauthenticated - see existing landing page.
  </verify>
  <done>
Authenticated users see org suggestions carousel on dashboard. Empty states provide appropriate prompts. Unauthenticated users see existing landing page.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add location privacy toggle to settings</name>
  <files>src/components/settings/LocationPrivacyToggle.tsx, src/routes/settings/index.tsx</files>
  <action>
Create src/components/settings/LocationPrivacyToggle.tsx:
- Follow NotificationPrefsForm.tsx pattern closely
- Use useQuery(api.profiles.getLocationPrivacy) to get current state
- Use useMutation(api.profiles.updateLocationPrivacy) to toggle
- Display:
  - Card wrapper with header: "Location Privacy" with MapPin icon
  - Description: "Control how your location is used for organization suggestions"
  - Toggle row:
    - Label: "Location-Based Suggestions" with MapPin icon
    - Description: "Get organization suggestions based on your city. Your exact location is never shared with organizations."
    - Switch component
- On toggle: call mutation, show toast success/error
- Loading state: show Spinner inside Card
- Include informational note: "When enabled, we match you with organizations in your city. Only city-level location is used - your exact address is never stored or shared."

Update src/routes/settings/index.tsx:
- If this file doesn't exist, check src/routes/settings/route.tsx - it's a layout
- Create src/routes/settings/index.tsx if needed (child route)
- Import LocationPrivacyToggle
- Add LocationPrivacyToggle below NotificationPrefsForm (or in appropriate section)
- Section structure:
  ```tsx
  <main className="container mx-auto px-4 py-8 space-y-8">
    <h1 className="text-2xl font-bold text-slate-900">Settings</h1>
    <NotificationPrefsForm />
    <LocationPrivacyToggle />
  </main>
  ```
  </action>
  <verify>
Run `bun run lint` - no errors.
Navigate to /settings - see both notification and location privacy sections.
Toggle location privacy - verify toast appears and setting persists.
  </verify>
  <done>
LocationPrivacyToggle component provides clear privacy control. Settings page includes both notification and location privacy sections. Toggle persists to database and shows appropriate feedback.
  </done>
</task>

</tasks>

<verification>
1. OrgCard renders correctly with all fields (manual visual check)
2. OrgCarousel scrolls horizontally with snap behavior
3. Dashboard shows suggestions for authenticated users
4. Dashboard shows empty state prompt when no suggestions
5. Location privacy toggle appears in settings
6. Toggle persists value (check Convex dashboard)
7. All TypeScript compiles, lint passes
</verification>

<success_criteria>
- OrgCard component displays org info with proper styling
- OrgCarousel enables horizontal scrolling with CSS scroll-snap
- Authenticated dashboard shows "Suggested Organizations" section
- Empty states handled appropriately with prompts
- LocationPrivacyToggle in settings works end-to-end
- No TypeScript errors, lint passes
</success_criteria>

<output>
After completion, create `.planning/phases/11-org-discovery/11-02-SUMMARY.md`
</output>
