---
phase: 12-event-management
plan: 02
type: execute
wave: 2
depends_on: ['12-01']
files_modified:
  - convex/orgs/admin.ts
  - src/routes/org/$slug/events.tsx
  - src/routes/org/$slug/admin/settings.tsx
  - src/routes/org/$slug/index.tsx
  - src/components/events/LumaEmbed.tsx
autonomous: true

must_haves:
  truths:
    - 'Org admin can configure lu.ma calendar URL in admin settings'
    - 'Org has public events page showing lu.ma embed'
    - 'Org header links to events page when lu.ma configured'
  artifacts:
    - path: 'src/routes/org/$slug/events.tsx'
      provides: 'Public org events page with lu.ma embed'
      min_lines: 50
    - path: 'src/routes/org/$slug/admin/settings.tsx'
      provides: 'Admin settings page with lu.ma config'
      min_lines: 80
    - path: 'src/components/events/LumaEmbed.tsx'
      provides: 'Lu.ma embed component wrapper'
      exports: ['LumaEmbed']
    - path: 'convex/orgs/admin.ts'
      provides: 'Mutation for updating lu.ma config'
      exports: ['updateLumaConfig']
  key_links:
    - from: 'src/routes/org/$slug/admin/settings.tsx'
      to: 'convex/orgs/admin.ts'
      via: 'useMutation updateLumaConfig'
      pattern: 'useMutation.*updateLumaConfig'
    - from: 'src/routes/org/$slug/events.tsx'
      to: 'src/components/events/LumaEmbed.tsx'
      via: 'LumaEmbed component'
      pattern: '<LumaEmbed'
---

<objective>
Create org events page with lu.ma embed and admin settings for configuring lu.ma integration.

Purpose: Org admins can connect their lu.ma calendar; members and visitors can view events on the org's event page
Output: Events page with embed, admin settings for lu.ma config, navigation links
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-event-management/12-CONTEXT.md
@.planning/phases/12-event-management/12-RESEARCH.md
@.planning/phases/12-event-management/12-01-SUMMARY.md

@src/routes/org/$slug/index.tsx
@src/routes/org/$slug/admin/index.tsx
@convex/orgs/admin.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create LumaEmbed component and org events page</name>
  <files>src/components/events/LumaEmbed.tsx, src/routes/org/$slug/events.tsx</files>
  <action>
Create `src/components/events/LumaEmbed.tsx`:
```typescript
interface LumaEmbedProps {
  calendarUrl: string;  // e.g., "https://lu.ma/baish"
  height?: number;
}

export function LumaEmbed({ calendarUrl, height = 600 }: LumaEmbedProps) {
// Append ?embed=true to calendar URL for embed mode
const embedUrl = calendarUrl.includes('?')
? `${calendarUrl}&embed=true`
: `${calendarUrl}?embed=true`;

return (

<iframe
src={embedUrl}
className="w-full border-0 rounded-lg"
style={{ height: `${height}px` }}
allow="payment"
loading="lazy"
title="Events Calendar"
/>
);
}

```

Create `src/routes/org/$slug/events.tsx`:
- Use createFileRoute("/org/$slug/events")
- Query org by slug via api.orgs.directory.getOrgBySlug
- Show loading state, not found state (like index.tsx pattern)
- If org has no lumaCalendarUrl configured, show empty state: "This organization hasn't set up their event calendar yet"
- If org has lumaCalendarUrl, render LumaEmbed with the URL
- Include org header at top (similar to index.tsx but simpler)
- Add "View on lu.ma" text link below embed that opens calendar in new tab
  </action>
  <verify>
Navigate to /org/[slug]/events - page renders
If org has lumaCalendarUrl, embed shows
If org has no lumaCalendarUrl, empty state shows
  </verify>
  <done>Org events page displays lu.ma embed when configured, empty state otherwise</done>
</task>

<task type="auto">
  <name>Task 2: Create admin settings page with lu.ma configuration</name>
  <files>src/routes/org/$slug/admin/settings.tsx, convex/orgs/admin.ts</files>
  <action>
Add to `convex/orgs/admin.ts`:
- Export `updateLumaConfig` mutation
  - Args: orgId, lumaCalendarUrl (optional string), lumaApiKey (optional string)
  - Verify caller is admin of the org
  - Update org with new lu.ma fields
  - Return success

Create `src/routes/org/$slug/admin/settings.tsx`:
- Use createFileRoute("/org/$slug/admin/settings")
- Require admin access (same pattern as admin/index.tsx)
- Show form with:
  - Lu.ma Calendar URL input (text field)
    - Help text: "Your public lu.ma calendar URL (e.g., https://lu.ma/your-calendar)"
  - Lu.ma API Key input (text field, type="password" for security)
    - Help text: "Optional - enables event display on dashboard. Requires Luma Plus."
  - Save button
- Use React Hook Form with optimistic updates
- Show toast on save success/failure
- Include breadcrumb navigation back to admin dashboard
  </action>
  <verify>
Navigate to /org/[slug]/admin/settings as admin
Form shows current values (if any)
Can update lu.ma URL and save
Changes persist after page refresh
  </verify>
  <done>Admin can configure lu.ma integration in org settings</done>
</task>

<task type="auto">
  <name>Task 3: Add events navigation to org pages</name>
  <files>src/routes/org/$slug/index.tsx, src/routes/org/$slug/admin/index.tsx</files>
  <action>
Update `src/routes/org/$slug/index.tsx`:
- In OrgHeader component, add Events link/button next to Member badge
- Only show if org has lumaCalendarUrl configured
- Use Calendar icon from lucide-react
- Link to /org/$slug/events

Update `src/routes/org/$slug/admin/index.tsx`:
- Add Settings link in Quick Actions section
- Use Settings icon, link to /org/$slug/admin/settings
- Add "Events" stat card showing whether lu.ma is configured
  - If configured: "Connected" with green indicator
  - If not: "Not configured" with link to settings
  </action>
  <verify>
On org page, Events link appears if lumaCalendarUrl is set
Admin dashboard has Settings link and shows lu.ma connection status
  </verify>
  <done>Navigation to events page integrated into org header and admin dashboard</done>
</task>

</tasks>

<verification>
1. /org/[slug]/events shows lu.ma embed when configured
2. /org/[slug]/admin/settings allows lu.ma configuration
3. Org page header shows Events link when lu.ma is configured
4. Admin dashboard shows lu.ma connection status
</verification>

<success_criteria>
- [ ] LumaEmbed component renders iframe with calendar URL
- [ ] Org events page shows embed or empty state based on config
- [ ] Admin settings page allows updating lu.ma URL and API key
- [ ] Org header shows Events link when lu.ma configured
- [ ] Admin dashboard shows settings link and lu.ma status
</success_criteria>

<output>
After completion, create `.planning/phases/12-event-management/12-02-SUMMARY.md`
</output>
```
