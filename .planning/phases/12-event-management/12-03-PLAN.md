---
phase: 12-event-management
plan: 03
type: execute
wave: 2
depends_on: ['12-01']
files_modified:
  - convex/events/queries.ts
  - src/components/events/EventCard.tsx
  - src/routes/index.tsx
autonomous: true

must_haves:
  truths:
    - 'User can see events from their orgs on their dashboard'
    - 'Events are grouped by organization'
    - "User's joined orgs' events appear first"
    - 'Event card shows title, date/time, location, and link to lu.ma'
  artifacts:
    - path: 'convex/events/queries.ts'
      provides: 'Query for dashboard event aggregation'
      exports: ['getDashboardEvents']
    - path: 'src/components/events/EventCard.tsx'
      provides: 'Event display card for dashboard'
      exports: ['EventCard']
    - path: 'src/routes/index.tsx'
      provides: 'Dashboard with events section'
      contains: 'Events'
  key_links:
    - from: 'src/routes/index.tsx'
      to: 'convex/events/queries.ts'
      via: 'useQuery getDashboardEvents'
      pattern: 'useQuery.*getDashboardEvents'
    - from: 'src/routes/index.tsx'
      to: 'src/components/events/EventCard.tsx'
      via: 'EventCard component'
      pattern: '<EventCard'
---

<objective>
Add events section to dashboard showing aggregated events from user's orgs.

Purpose: Users see upcoming events from organizations they've joined, making ASTN a central hub for community activity
Output: EventCard component, getDashboardEvents query, dashboard events section
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-event-management/12-CONTEXT.md
@.planning/phases/12-event-management/12-RESEARCH.md
@.planning/phases/12-event-management/12-01-SUMMARY.md

@src/routes/index.tsx
@src/components/org/OrgCard.tsx
@convex/events/queries.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create getDashboardEvents query</name>
  <files>convex/events/queries.ts</files>
  <action>
Add to existing `convex/events/queries.ts`:

Export `getDashboardEvents` query (public, requires auth):

- Get current user identity
- Get user's org memberships via orgMemberships table
- Collect userOrgIds Set
- Query upcoming events (next 30 days) from events table
  - Filter: startAt >= now AND startAt <= now + 30 days
  - Order by startAt ascending
  - Limit to 50 events
- For each event, fetch the org details
- Return object with:
  - userOrgEvents: events from orgs user has joined
  - otherOrgEvents: events from orgs user hasn't joined (for discovery)
  - Each event enriched with org name, slug, logoUrl

Use the pattern from RESEARCH.md getDashboardEvents example.
</action>
<verify>
Query compiles without errors.
Can test in Convex dashboard function runner.
</verify>
<done>getDashboardEvents returns user's org events and other org events separately</done>
</task>

<task type="auto">
  <name>Task 2: Create EventCard component</name>
  <files>src/components/events/EventCard.tsx</files>
  <action>
Create `src/components/events/EventCard.tsx`:

Props interface:

```typescript
interface EventCardProps {
  event: {
    _id: Id<'events'>
    title: string
    startAt: number
    endAt?: number
    location?: string
    isVirtual: boolean
    url: string
    coverUrl?: string
    org: {
      name: string
      slug?: string
      logoUrl?: string
    }
  }
}
```

Card design:

- Compact horizontal card (similar to OrgCard style)
- Left side: event cover image (if coverUrl) or org logo fallback, or Calendar icon placeholder
- Content:
  - Event title (font-medium, truncate if long)
  - Date/time formatted using date-fns: "Fri, Jan 24 at 6:00 PM" format
  - Location (if physical) or "Online" badge (if isVirtual)
  - Org name in muted text
- Right side: External link icon
- Entire card is clickable link to event.url (opens in new tab)

Use existing UI components: Card, Badge from shadcn/ui.
Use date-fns for formatting (already in codebase).
</action>
<verify>Component renders without errors with mock data</verify>
<done>EventCard displays event info with link to lu.ma</done>
</task>

<task type="auto">
  <name>Task 3: Add events section to dashboard</name>
  <files>src/routes/index.tsx</files>
  <action>
Update Dashboard component in `src/routes/index.tsx`:

Add after Org Suggestions section, before Browse Opportunities CTA:

```tsx
{
  /* Upcoming Events Section */
}
;<section className="mb-8">
  <h2 className="text-xl font-semibold text-slate-900 mb-2">Upcoming Events</h2>
  <p className="text-slate-600 mb-4">Events from your organizations</p>

  {/* Events content */}
</section>
```

Query events using useQuery(api.events.queries.getDashboardEvents).

Display logic:

1. If loading: show Spinner
2. If user has org events: show them grouped by org
   - Section header per org: "BAISH Events" etc.
   - List of EventCards
3. If user has NO org events but other org events exist:
   - Show "No events from your organizations" message
   - Show "Discover events from other orgs:" section with a few other org events
4. If NO events at all:
   - Show empty state: "No upcoming events. Join organizations to see their events."
   - Link to /orgs browse page

Keep the events section compact - show max 5 events per org, with "View all" link to org's events page.
</action>
<verify>
Dashboard shows events section
Events grouped by org
External links work (open lu.ma in new tab)
</verify>
<done>Dashboard displays upcoming events from user's orgs with proper grouping</done>
</task>

</tasks>

<verification>
1. getDashboardEvents returns events grouped by membership
2. EventCard renders event info with date formatting
3. Dashboard shows events section with org grouping
4. Empty states handle no-events and no-orgs cases
</verification>

<success_criteria>

- [ ] getDashboardEvents query returns userOrgEvents and otherOrgEvents
- [ ] EventCard shows title, date, location, org name
- [ ] EventCard links to lu.ma event page (new tab)
- [ ] Dashboard events section shows user's org events first
- [ ] Empty states guide users appropriately
      </success_criteria>

<output>
After completion, create `.planning/phases/12-event-management/12-03-SUMMARY.md`
</output>
