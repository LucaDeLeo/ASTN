---
phase: 14-attendance-tracking
plan: 02
type: execute
wave: 2
depends_on: ['14-01']
files_modified:
  - src/components/attendance/StarRating.tsx
  - src/components/attendance/AttendancePrompt.tsx
  - src/components/attendance/FeedbackForm.tsx
  - src/components/attendance/index.ts
  - src/components/notifications/NotificationList.tsx
autonomous: true

must_haves:
  truths:
    - 'User can rate events with 1-5 stars'
    - 'User can respond Yes/No/Partial to attendance prompt'
    - 'User can snooze attendance prompt'
    - 'Feedback form appears after confirming attendance'
    - 'Soft nudge appears when user tries to skip feedback'
    - 'Attendance prompts render in notification list'
  artifacts:
    - path: 'src/components/attendance/StarRating.tsx'
      provides: 'Interactive star rating component'
      min_lines: 25
    - path: 'src/components/attendance/AttendancePrompt.tsx'
      provides: 'Yes/No/Partial/Snooze buttons component'
      min_lines: 50
    - path: 'src/components/attendance/FeedbackForm.tsx'
      provides: 'Star rating + text + soft nudge skip'
      min_lines: 60
    - path: 'src/components/notifications/NotificationList.tsx'
      provides: 'Renders AttendancePrompt for attendance_prompt type'
      contains: 'attendance_prompt'
  key_links:
    - from: 'src/components/attendance/AttendancePrompt.tsx'
      to: 'convex/attendance/mutations.ts'
      via: 'useMutation calls recordAttendance'
      pattern: 'useMutation.*recordAttendance'
    - from: 'src/components/attendance/FeedbackForm.tsx'
      to: 'convex/attendance/mutations.ts'
      via: 'useMutation calls submitFeedback'
      pattern: 'useMutation.*submitFeedback'
    - from: 'src/components/notifications/NotificationList.tsx'
      to: 'src/components/attendance/AttendancePrompt.tsx'
      via: 'imports and renders AttendancePrompt'
      pattern: 'import.*AttendancePrompt'
---

<objective>
Build attendance tracking UI components: star rating, attendance prompt, feedback form, and integrate with notification center.

Purpose: Enable users to respond to "Did you attend?" prompts and submit feedback through the notification center.
Output: Complete UI components for attendance interaction flow.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-attendance-tracking/14-CONTEXT.md
@.planning/phases/14-attendance-tracking/14-RESEARCH.md
@.planning/phases/14-attendance-tracking/14-01-SUMMARY.md
@src/components/notifications/NotificationList.tsx
@src/components/ui/button.tsx
@src/components/ui/textarea.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create StarRating and base attendance components</name>
  <files>src/components/attendance/StarRating.tsx, src/components/attendance/index.ts</files>
  <action>
Create `src/components/attendance/` directory with:

**StarRating.tsx:**

```typescript
import { Star } from "lucide-react";
import { cn } from "~/lib/utils";

interface StarRatingProps {
  value: number;
  onChange: (value: number) => void;
  max?: number;
  size?: "sm" | "md";
}

export function StarRating({ value, onChange, max = 5, size = "md" }: StarRatingProps) {
  const sizeClasses = {
    sm: "size-5",
    md: "size-6",
  };

  return (
    <div className="flex gap-1" role="radiogroup" aria-label="Rating">
      {Array.from({ length: max }, (_, i) => i + 1).map((star) => (
        <button
          key={star}
          type="button"
          onClick={() => onChange(star)}
          className="p-0.5 hover:scale-110 transition-transform focus:outline-none focus:ring-2 focus:ring-primary/50 rounded"
          aria-label={`${star} star${star > 1 ? "s" : ""}`}
          aria-checked={value >= star}
        >
          <Star
            className={cn(
              sizeClasses[size],
              "transition-colors",
              value >= star
                ? "fill-yellow-400 text-yellow-400"
                : "text-slate-300 hover:text-yellow-300"
            )}
          />
        </button>
      ))}
    </div>
  );
}
```

**index.ts:**

```typescript
export { StarRating } from './StarRating'
export { AttendancePrompt } from './AttendancePrompt'
export { FeedbackForm } from './FeedbackForm'
```

  </action>
  <verify>Import StarRating in a test file or Storybook. Verify stars highlight on click and hover.</verify>
  <done>StarRating component renders 5 interactive stars with proper accessibility attributes and visual feedback.</done>
</task>

<task type="auto">
  <name>Task 2: Create AttendancePrompt and FeedbackForm components</name>
  <files>src/components/attendance/AttendancePrompt.tsx, src/components/attendance/FeedbackForm.tsx</files>
  <action>
**AttendancePrompt.tsx:**
- Props: notificationId, eventId, eventTitle, orgName, onDismiss (callback when done)
- State: showFeedback (boolean), attendanceStatus (string | null)
- Uses useMutation for recordAttendance and snoozeAttendancePrompt
- Displays "Did you attend?" with event title and org name
- Four buttons: Yes (CheckCircle icon, green), Partial (MinusCircle icon, amber), No (XCircle icon, gray), Later (Clock icon)
- On Yes/Partial click: call recordAttendance, set showFeedback=true
- On No click: call recordAttendance, call onDismiss
- On Later click: call snoozeAttendancePrompt, call onDismiss
- If showFeedback=true, render FeedbackForm instead of buttons

**FeedbackForm.tsx:**

- Props: eventId, eventTitle, onComplete (callback)
- State: rating (number, default 0), text (string), showSkipConfirm (boolean), submitting (boolean)
- Uses useMutation for submitFeedback
- Displays "How was {eventTitle}?" with helper text
- StarRating component for rating selection
- Textarea for optional comments
- Two buttons: "Submit Feedback" (disabled if rating=0 or submitting), "Skip"
- Skip behavior (soft nudge per CONTEXT.md):
  - First click: set showSkipConfirm=true, button text changes to "Yes, skip feedback"
  - Show amber warning: "Are you sure you don't want to share feedback?"
  - Second click: call onComplete() without submitting
- Submit: call submitFeedback, then onComplete()

Both components should use existing Button, Textarea from shadcn/ui.
Icons from lucide-react: CheckCircle, XCircle, MinusCircle, Clock
</action>
<verify>Import components and test the full flow: prompt -> Yes -> feedback form -> submit/skip.</verify>
<done>AttendancePrompt shows 4 response options and transitions to FeedbackForm. FeedbackForm has soft nudge before skip.</done>
</task>

<task type="auto">
  <name>Task 3: Integrate AttendancePrompt into NotificationList</name>
  <files>src/components/notifications/NotificationList.tsx</files>
  <action>
Extend NotificationList to handle attendance_prompt notifications:

1. Add "attendance_prompt" to Notification interface type union
2. Add HelpCircle to typeIcons mapping for attendance_prompt (or use a question mark icon)
3. In the render logic, check if notification.type === "attendance_prompt":
   - Instead of rendering the standard button, render AttendancePrompt component
   - Pass notificationId, eventId (from notification.eventId), title/body for event info
   - Add onDismiss prop that removes the notification from the list (or marks as read)

4. For standard notifications, keep existing behavior (click to mark read + navigate)

The NotificationList already receives notifications array. The attendance_prompt type will have:

- eventId (required)
- orgId (required)
- title: "Did you attend?" or similar
- body: event title
- actionUrl: undefined (no navigation, inline interaction)

Handle the case where AttendancePrompt calls onDismiss - the parent should trigger a re-query or optimistically remove.
</action>
<verify>Create a test attendance_prompt notification in database. Open notification bell and verify AttendancePrompt renders with interactive buttons.</verify>
<done>NotificationList renders AttendancePrompt for attendance_prompt type with full interactivity. Standard notifications unchanged.</done>
</task>

</tasks>

<verification>
1. StarRating: Click each star, verify fill state updates, keyboard accessible
2. AttendancePrompt: Click Yes -> FeedbackForm appears, Click Partial -> FeedbackForm appears, Click No -> dismisses, Click Later -> snoozes
3. FeedbackForm: Select rating + type text + submit, try skip (see soft nudge), skip again to dismiss
4. NotificationList: Create attendance_prompt notification, verify it renders as interactive prompt not standard notification
5. Full flow: After "Yes" + feedback submit, attendance record exists in database with rating
</verification>

<success_criteria>

- StarRating displays 5 interactive stars with hover and selected states
- AttendancePrompt shows Yes/No/Partial/Later options
- Yes/Partial triggers FeedbackForm, No/Later dismisses
- FeedbackForm requires rating, has soft nudge before skip
- NotificationList renders AttendancePrompt for attendance_prompt type
- Full flow works: prompt -> response -> feedback -> recorded
  </success_criteria>

<output>
After completion, create `.planning/phases/14-attendance-tracking/14-02-SUMMARY.md`
</output>
