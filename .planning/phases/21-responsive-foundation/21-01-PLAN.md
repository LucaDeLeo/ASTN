---
phase: 21-responsive-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ui/skeleton.tsx
  - src/hooks/use-media-query.ts
  - src/components/ui/responsive-sheet.tsx
autonomous: true

must_haves:
  truths:
    - "Skeleton component renders with pulse animation"
    - "useIsMobile hook returns true on mobile viewports"
    - "ResponsiveSheet opens from bottom on mobile, centered dialog on desktop"
  artifacts:
    - path: "src/components/ui/skeleton.tsx"
      provides: "Skeleton loading primitive"
      exports: ["Skeleton"]
    - path: "src/hooks/use-media-query.ts"
      provides: "Responsive detection hooks"
      exports: ["useMediaQuery", "useIsMobile", "useIsDesktop"]
    - path: "src/components/ui/responsive-sheet.tsx"
      provides: "Mobile bottom sheet component"
      exports: ["ResponsiveSheet", "ResponsiveSheetContent", "ResponsiveSheetTrigger"]
  key_links:
    - from: "src/hooks/use-media-query.ts"
      to: "window.matchMedia"
      via: "browser API"
      pattern: "matchMedia"
    - from: "src/components/ui/responsive-sheet.tsx"
      to: "src/components/ui/dialog.tsx"
      via: "Dialog primitives"
      pattern: "DialogContent"
---

<objective>
Create foundation utilities for responsive implementation across the app.

Purpose: These utilities enable consistent responsive patterns throughout Phase 21. Skeleton provides loading states, useMediaQuery enables JS-based layout decisions, and ResponsiveSheet creates mobile-native bottom sheet behavior.

Output: Three new files that other plans will use for responsive layouts.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/21-responsive-foundation/21-CONTEXT.md
@.planning/phases/21-responsive-foundation/21-RESEARCH.md

@src/components/ui/dialog.tsx
@src/lib/utils.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Skeleton component</name>
  <files>src/components/ui/skeleton.tsx</files>
  <action>
Create the Skeleton component following shadcn/ui official pattern from RESEARCH.md:

```tsx
import { cn } from "~/lib/utils"

function Skeleton({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) {
  return (
    <div
      className={cn("animate-pulse rounded-md bg-muted", className)}
      {...props}
    />
  )
}

export { Skeleton }
```

This is the base primitive. Usage patterns (CardSkeleton, ListSkeleton) will be created inline where needed in other plans rather than here, keeping this file minimal.
  </action>
  <verify>
Import the component in a test file or verify TypeScript compiles:
`bunx tsc --noEmit src/components/ui/skeleton.tsx`
  </verify>
  <done>Skeleton component exists with animate-pulse animation and can be imported</done>
</task>

<task type="auto">
  <name>Task 2: Add useMediaQuery hook</name>
  <files>src/hooks/use-media-query.ts</files>
  <action>
Create the useMediaQuery hook with convenience exports:

```tsx
import { useEffect, useState } from "react"

export function useMediaQuery(query: string): boolean {
  const [matches, setMatches] = useState(false)

  useEffect(() => {
    const media = window.matchMedia(query)
    setMatches(media.matches)

    const listener = (e: MediaQueryListEvent) => setMatches(e.matches)
    media.addEventListener("change", listener)
    return () => media.removeEventListener("change", listener)
  }, [query])

  return matches
}

// Convenience hooks matching Tailwind breakpoints
export const useIsMobile = () => !useMediaQuery("(min-width: 768px)")
export const useIsDesktop = () => useMediaQuery("(min-width: 768px)")
```

Important: Initial state is `false` (SSR-safe). The value updates on mount in the browser. This means during hydration, mobile layouts may briefly show desktop state - this is acceptable and preferable to hydration mismatches. For critical layout decisions, prefer CSS-only responsive with hidden/block classes.
  </action>
  <verify>
TypeScript compiles: `bunx tsc --noEmit src/hooks/use-media-query.ts`
  </verify>
  <done>useMediaQuery, useIsMobile, useIsDesktop hooks exist and are type-safe</done>
</task>

<task type="auto">
  <name>Task 3: Create ResponsiveSheet component</name>
  <files>src/components/ui/responsive-sheet.tsx</files>
  <action>
Create a responsive sheet that renders as bottom sheet on mobile, standard dialog on desktop. Uses existing Dialog primitives with mobile-specific positioning:

```tsx
import * as React from "react"
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogDescription,
  DialogTrigger,
  DialogClose,
} from "~/components/ui/dialog"
import { useIsMobile } from "~/hooks/use-media-query"
import { cn } from "~/lib/utils"

interface ResponsiveSheetProps {
  children: React.ReactNode
  open?: boolean
  onOpenChange?: (open: boolean) => void
}

function ResponsiveSheet({ children, ...props }: ResponsiveSheetProps) {
  return <Dialog {...props}>{children}</Dialog>
}

interface ResponsiveSheetContentProps
  extends React.ComponentProps<typeof DialogContent> {
  children: React.ReactNode
}

function ResponsiveSheetContent({
  children,
  className,
  ...props
}: ResponsiveSheetContentProps) {
  const isMobile = useIsMobile()

  return (
    <DialogContent
      className={cn(
        isMobile && [
          // Bottom sheet positioning
          "fixed bottom-0 top-auto left-0 right-0",
          "translate-x-0 translate-y-0",
          "max-w-full w-full",
          "rounded-t-xl rounded-b-none",
          "max-h-[85vh]",
          // Slide up animation
          "data-[state=open]:animate-in data-[state=open]:slide-in-from-bottom",
          "data-[state=closed]:animate-out data-[state=closed]:slide-out-to-bottom",
        ],
        className
      )}
      {...props}
    >
      {/* Drag handle indicator for mobile */}
      {isMobile && (
        <div className="mx-auto mb-4 h-1.5 w-12 rounded-full bg-muted-foreground/20" />
      )}
      {children}
    </DialogContent>
  )
}

const ResponsiveSheetTrigger = DialogTrigger
const ResponsiveSheetClose = DialogClose
const ResponsiveSheetHeader = DialogHeader
const ResponsiveSheetTitle = DialogTitle
const ResponsiveSheetDescription = DialogDescription

export {
  ResponsiveSheet,
  ResponsiveSheetContent,
  ResponsiveSheetTrigger,
  ResponsiveSheetClose,
  ResponsiveSheetHeader,
  ResponsiveSheetTitle,
  ResponsiveSheetDescription,
}
```

The component reuses Dialog primitives for accessibility (focus trap, escape to close) while adding bottom sheet styling on mobile. The drag handle is visual only (not functional dragging) - good enough for v2.0.
  </action>
  <verify>
TypeScript compiles: `bunx tsc --noEmit src/components/ui/responsive-sheet.tsx`
Test visually: Open a sheet on mobile viewport (375px) - should slide from bottom
  </verify>
  <done>ResponsiveSheet renders as bottom sheet on mobile with slide-up animation, standard centered dialog on desktop</done>
</task>

</tasks>

<verification>
After completing all tasks:
1. Run `bun run lint` - should pass with no errors
2. Run `bun run build` - should compile successfully
3. Verify imports work by checking that TypeScript finds the exports
</verification>

<success_criteria>
- Skeleton, useMediaQuery hooks, and ResponsiveSheet all exist and compile
- No lint errors introduced
- Components follow existing design system patterns (cn utility, consistent naming)
- ResponsiveSheet uses Dialog primitives (not a separate implementation)
</success_criteria>

<output>
After completion, create `.planning/phases/21-responsive-foundation/21-01-SUMMARY.md`
</output>
