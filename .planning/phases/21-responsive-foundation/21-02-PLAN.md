---
phase: 21-responsive-foundation
plan: 02
type: execute
wave: 2
depends_on: [21-01]
files_modified:
  - src/components/opportunities/mobile-filters.tsx
  - src/components/opportunities/opportunity-filters.tsx
  - src/components/opportunities/opportunity-list.tsx
autonomous: true

must_haves:
  truths:
    - 'User can filter opportunities on mobile via chips and sheet'
    - 'Active filters display as removable chips on mobile'
    - 'Skeleton cards appear while opportunities load'
  artifacts:
    - path: 'src/components/opportunities/mobile-filters.tsx'
      provides: 'Mobile-optimized filter UI'
      exports: ['MobileFilters']
    - path: 'src/components/opportunities/opportunity-filters.tsx'
      provides: 'Responsive filter bar'
      contains: 'md:hidden'
    - path: 'src/components/opportunities/opportunity-list.tsx'
      provides: 'Loading skeleton for opportunity cards'
      contains: 'Skeleton'
  key_links:
    - from: 'src/components/opportunities/mobile-filters.tsx'
      to: 'src/components/ui/responsive-sheet.tsx'
      via: 'ResponsiveSheet import'
      pattern: 'ResponsiveSheet'
    - from: 'src/components/opportunities/opportunity-list.tsx'
      to: 'src/components/ui/skeleton.tsx'
      via: 'Skeleton import'
      pattern: 'Skeleton'
---

<objective>
Make opportunity views responsive with mobile-friendly filters and skeleton loading states.

Purpose: Per CONTEXT.md, filters should "show active filters as chips, Filter button opens full filter sheet" on mobile. This plan implements that pattern along with skeleton loading for better perceived performance.

Output: Opportunity browsing works well on mobile with intuitive filtering and loading feedback.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/21-responsive-foundation/21-CONTEXT.md
@.planning/phases/21-responsive-foundation/21-RESEARCH.md

@src/components/opportunities/opportunity-filters.tsx
@src/components/opportunities/opportunity-list.tsx
@src/components/ui/responsive-sheet.tsx
@src/components/ui/skeleton.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create MobileFilters component</name>
  <files>src/components/opportunities/mobile-filters.tsx</files>
  <action>
Create a mobile-specific filter component that shows:
1. Active filters as removable badge/chips
2. A "Filter" button that opens ResponsiveSheet with full filter options

```tsx
import { useState } from 'react'
import { Filter, X } from 'lucide-react'
import { Badge } from '~/components/ui/badge'
import { Button } from '~/components/ui/button'
import { Input } from '~/components/ui/input'
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '~/components/ui/select'
import {
  ResponsiveSheet,
  ResponsiveSheetContent,
  ResponsiveSheetHeader,
  ResponsiveSheetTitle,
  ResponsiveSheetTrigger,
} from '~/components/ui/responsive-sheet'

const ROLE_TYPES = [
  { value: 'all', label: 'All Roles' },
  { value: 'research', label: 'Research' },
  { value: 'engineering', label: 'Engineering' },
  { value: 'operations', label: 'Operations' },
  { value: 'policy', label: 'Policy' },
  { value: 'other', label: 'Other' },
]

const LOCATION_OPTIONS = [
  { value: 'all', label: 'All Locations' },
  { value: 'remote', label: 'Remote Only' },
  { value: 'onsite', label: 'On-site Only' },
]

interface MobileFiltersProps {
  roleType: string
  locationFilter: string
  searchTerm: string
  onRoleChange: (value: string) => void
  onLocationChange: (value: string) => void
  onSearchChange: (value: string) => void
  onClearFilters: () => void
}

export function MobileFilters({
  roleType,
  locationFilter,
  searchTerm,
  onRoleChange,
  onLocationChange,
  onSearchChange,
  onClearFilters,
}: MobileFiltersProps) {
  const [sheetOpen, setSheetOpen] = useState(false)

  // Build active filter chips
  const activeFilters: Array<{
    key: string
    label: string
    onRemove: () => void
  }> = []

  if (roleType && roleType !== 'all') {
    const roleLabel =
      ROLE_TYPES.find((r) => r.value === roleType)?.label || roleType
    activeFilters.push({
      key: 'role',
      label: roleLabel,
      onRemove: () => onRoleChange('all'),
    })
  }

  if (locationFilter && locationFilter !== 'all') {
    const locLabel =
      LOCATION_OPTIONS.find((l) => l.value === locationFilter)?.label ||
      locationFilter
    activeFilters.push({
      key: 'location',
      label: locLabel,
      onRemove: () => onLocationChange('all'),
    })
  }

  if (searchTerm) {
    activeFilters.push({
      key: 'search',
      label: `"${searchTerm}"`,
      onRemove: () => onSearchChange(''),
    })
  }

  return (
    <div className="space-y-3">
      {/* Active filter chips */}
      {activeFilters.length > 0 && (
        <div className="flex flex-wrap gap-2">
          {activeFilters.map((filter) => (
            <Badge key={filter.key} variant="secondary" className="pr-1 gap-1">
              {filter.label}
              <button
                onClick={filter.onRemove}
                className="ml-1 rounded-full hover:bg-muted-foreground/20 p-0.5"
                aria-label={`Remove ${filter.label} filter`}
              >
                <X className="size-3" />
              </button>
            </Badge>
          ))}
          <button
            onClick={onClearFilters}
            className="text-sm text-muted-foreground hover:text-foreground"
          >
            Clear all
          </button>
        </div>
      )}

      {/* Filter button */}
      <ResponsiveSheet open={sheetOpen} onOpenChange={setSheetOpen}>
        <ResponsiveSheetTrigger asChild>
          <Button variant="outline" className="w-full min-h-11">
            <Filter className="size-4 mr-2" />
            Filter Opportunities
            {activeFilters.length > 0 && (
              <Badge variant="secondary" className="ml-2">
                {activeFilters.length}
              </Badge>
            )}
          </Button>
        </ResponsiveSheetTrigger>
        <ResponsiveSheetContent>
          <ResponsiveSheetHeader>
            <ResponsiveSheetTitle>Filter Opportunities</ResponsiveSheetTitle>
          </ResponsiveSheetHeader>

          <div className="space-y-4 py-4">
            {/* Search */}
            <div className="space-y-2">
              <label className="text-sm font-medium">Search</label>
              <Input
                type="search"
                placeholder="Search opportunities..."
                value={searchTerm}
                onChange={(e) => onSearchChange(e.target.value)}
              />
            </div>

            {/* Role Type */}
            <div className="space-y-2">
              <label className="text-sm font-medium">Role Type</label>
              <Select value={roleType || 'all'} onValueChange={onRoleChange}>
                <SelectTrigger className="min-h-11">
                  <SelectValue placeholder="All Roles" />
                </SelectTrigger>
                <SelectContent>
                  {ROLE_TYPES.map((type) => (
                    <SelectItem key={type.value} value={type.value}>
                      {type.label}
                    </SelectItem>
                  ))}
                </SelectContent>
              </Select>
            </div>

            {/* Location */}
            <div className="space-y-2">
              <label className="text-sm font-medium">Location</label>
              <Select
                value={locationFilter || 'all'}
                onValueChange={onLocationChange}
              >
                <SelectTrigger className="min-h-11">
                  <SelectValue placeholder="All Locations" />
                </SelectTrigger>
                <SelectContent>
                  {LOCATION_OPTIONS.map((opt) => (
                    <SelectItem key={opt.value} value={opt.value}>
                      {opt.label}
                    </SelectItem>
                  ))}
                </SelectContent>
              </Select>
            </div>
          </div>

          {/* Apply button */}
          <Button
            className="w-full min-h-11"
            onClick={() => setSheetOpen(false)}
          >
            Show Results
          </Button>
        </ResponsiveSheetContent>
      </ResponsiveSheet>
    </div>
  )
}
```

Key points:

- All interactive elements have min-h-11 (44px touch target)
- Labels above inputs per CONTEXT.md
- Filter changes apply immediately (no separate apply action except closing sheet)
- Clear all link when filters are active
  </action>
  <verify>
  TypeScript compiles: `bunx tsc --noEmit src/components/opportunities/mobile-filters.tsx`
  </verify>
  <done>MobileFilters component shows active filters as chips and opens filter sheet on button tap</done>
  </task>

<task type="auto">
  <name>Task 2: Make OpportunityFilters responsive</name>
  <files>src/components/opportunities/opportunity-filters.tsx</files>
  <action>
Update OpportunityFilters to show MobileFilters on mobile, existing inline filters on desktop:

1. Import MobileFilters
2. Extract filter state/handlers into reusable form
3. Render MobileFilters with md:hidden, existing layout with hidden md:flex

Changes to make:

```tsx
import { MobileFilters } from './mobile-filters'

// ... keep existing ROLE_TYPES, LOCATION_OPTIONS, type definitions

export function OpportunityFilters() {
  const navigate = useNavigate()
  const search = useSearch({ from: '/opportunities/' })

  const roleType = search.role || 'all'
  const locationFilter = search.location || 'all'
  const searchTerm = search.q || ''

  // ... keep existing updateFilter and clearFilters functions

  const hasActiveFilters =
    roleType !== 'all' || locationFilter !== 'all' || searchTerm !== ''

  return (
    <div className="bg-white dark:bg-card border-b border-slate-200 dark:border-border sticky top-0 z-10">
      <div className="container mx-auto px-4 py-4">
        {/* Mobile filters */}
        <div className="md:hidden">
          <MobileFilters
            roleType={roleType}
            locationFilter={locationFilter}
            searchTerm={searchTerm}
            onRoleChange={(v) => updateFilter('role', v)}
            onLocationChange={(v) => updateFilter('location', v)}
            onSearchChange={(v) => updateFilter('q', v)}
            onClearFilters={clearFilters}
          />
        </div>

        {/* Desktop filters - existing layout */}
        <div className="hidden md:flex flex-wrap items-center gap-3">
          {/* ... existing search input, selects, clear button - unchanged */}
        </div>
      </div>
    </div>
  )
}
```

The desktop layout stays exactly as-is. Mobile gets the new MobileFilters component.
</action>
<verify>

1. TypeScript compiles: `bunx tsc --noEmit src/components/opportunities/opportunity-filters.tsx`
2. Visual test: At 375px width, filter button and chips appear; at 768px+, inline filters appear
   </verify>
   <done>OpportunityFilters shows mobile pattern on small screens, desktop pattern on md+ screens</done>
   </task>

<task type="auto">
  <name>Task 3: Add skeleton loading to OpportunityList</name>
  <files>src/components/opportunities/opportunity-list.tsx</files>
  <action>
Replace the text-only loading state with skeleton cards for better perceived performance:

1. Import Skeleton component
2. Create OpportunityCardSkeleton inline
3. Replace loading state with skeleton array

```tsx
import { Skeleton } from "~/components/ui/skeleton"
import { Card, CardContent } from "~/components/ui/card"

// Add skeleton component
function OpportunityCardSkeleton() {
  return (
    <Card className="border-slate-200 dark:border-border rounded-none sm:rounded-sm">
      <CardContent className="p-5">
        <div className="flex gap-4">
          {/* Logo skeleton */}
          <Skeleton className="size-12 rounded-sm shrink-0" />

          <div className="flex-1 min-w-0 space-y-3">
            {/* Title and org */}
            <div className="space-y-1.5">
              <Skeleton className="h-5 w-3/4" />
              <Skeleton className="h-4 w-1/2" />
            </div>

            {/* Meta info */}
            <div className="flex flex-wrap gap-3">
              <Skeleton className="h-4 w-24" />
              <Skeleton className="h-4 w-20" />
              <Skeleton className="h-4 w-28" />
            </div>

            {/* Timestamp */}
            <Skeleton className="h-3 w-32" />
          </div>

          {/* Badge skeleton */}
          <Skeleton className="h-5 w-16 rounded-sm shrink-0" />
        </div>
      </CardContent>
    </Card>
  )
}

// Update loading state in OpportunityList
export function OpportunityList({ ... }) {
  if (isLoading) {
    return (
      <div className="space-y-4">
        {Array.from({ length: 5 }).map((_, i) => (
          <OpportunityCardSkeleton key={i} />
        ))}
      </div>
    )
  }

  // ... rest unchanged
}
```

The skeleton matches the OpportunityCard layout for smooth transition when data loads.
</action>
<verify>

1. TypeScript compiles: `bunx tsc --noEmit src/components/opportunities/opportunity-list.tsx`
2. Visual test: Navigate to /opportunities - should see 5 skeleton cards during load
   </verify>
   <done>OpportunityList shows 5 skeleton cards while loading instead of spinner with text</done>
   </task>

</tasks>

<verification>
After completing all tasks:
1. Run `bun run lint` - should pass
2. Run `bun run dev` and test:
   - At 375px viewport: Filter button + chips pattern visible
   - At 768px+ viewport: Inline filters visible
   - Initial load shows skeleton cards
   - Filter sheet opens from bottom on mobile
</verification>

<success_criteria>

- Mobile filter pattern works: chips + sheet
- Desktop filter pattern unchanged: inline filters
- Skeleton loading replaces text loading state
- All touch targets meet 44px minimum (min-h-11)
- No horizontal scroll at 375px
  </success_criteria>

<output>
After completion, create `.planning/phases/21-responsive-foundation/21-02-SUMMARY.md`
</output>
