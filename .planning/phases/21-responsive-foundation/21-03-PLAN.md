---
phase: 21-responsive-foundation
plan: 03
type: execute
wave: 2
depends_on: [21-01]
files_modified:
  - src/components/profile/wizard/WizardProgress.tsx
  - src/components/profile/wizard/ProfileWizard.tsx
  - src/components/profile/wizard/steps/BasicInfoStep.tsx
autonomous: true

must_haves:
  truths:
    - 'User can navigate wizard steps on mobile viewport'
    - 'Profile wizard layout stacks vertically on mobile'
    - 'Form fields have labels above inputs on all viewports'
  artifacts:
    - path: 'src/components/profile/wizard/WizardProgress.tsx'
      provides: 'Responsive step navigation'
      contains: 'md:hidden'
    - path: 'src/components/profile/wizard/ProfileWizard.tsx'
      provides: 'Responsive wizard layout'
      contains: 'md:flex-row'
  key_links:
    - from: 'src/components/profile/wizard/ProfileWizard.tsx'
      to: 'src/components/profile/wizard/WizardProgress.tsx'
      via: 'component composition'
      pattern: 'WizardProgress'
---

<objective>
Make the profile wizard responsive for mobile users.

Purpose: The profile wizard currently has a fixed 264px sidebar that doesn't work on mobile. Per CONTEXT.md, layouts should stack on mobile with "profile sections all visible with scroll (not accordion/tabs)". This plan converts the sidebar to a horizontal step indicator on mobile.

Output: Profile editing works well on mobile with clear step navigation and properly formatted forms.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/21-responsive-foundation/21-CONTEXT.md
@.planning/phases/21-responsive-foundation/21-RESEARCH.md

@src/components/profile/wizard/WizardProgress.tsx
@src/components/profile/wizard/ProfileWizard.tsx
@src/components/profile/wizard/steps/BasicInfoStep.tsx
@src/hooks/use-media-query.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Make WizardProgress responsive</name>
  <files>src/components/profile/wizard/WizardProgress.tsx</files>
  <action>
Convert WizardProgress from fixed sidebar to responsive layout:
- Mobile: Horizontal scrollable step pills with current step highlighted
- Desktop: Keep existing sidebar layout

Key changes:

1. Remove fixed w-64 wrapper, add responsive classes
2. Create two layouts: mobile (horizontal pills) and desktop (sidebar)
3. Simplify mobile view - just show step dots/names, hide completeness details

```tsx
import { useQuery } from "convex/react";
import { Check, Circle, Lock } from "lucide-react";
import { api } from "../../../../convex/_generated/api";
import { cn } from "~/lib/utils";

type StepId = /* ... existing ... */

interface WizardProgressProps {
  currentStep: StepId;
  onStepClick: (step: StepId) => void;
}

const STEP_TO_SECTION: Record<StepId, string> = { /* ... existing ... */ };
const STEPS: Array<{ id: StepId; label: string; shortLabel: string }> = [
  { id: "basic", label: "Basic Information", shortLabel: "Basic" },
  { id: "education", label: "Education", shortLabel: "Education" },
  { id: "work", label: "Work History", shortLabel: "Work" },
  { id: "goals", label: "Career Goals", shortLabel: "Goals" },
  { id: "skills", label: "Skills", shortLabel: "Skills" },
  { id: "enrichment", label: "Profile Enrichment", shortLabel: "Enrich" },
  { id: "privacy", label: "Privacy Settings", shortLabel: "Privacy" },
];

const UNLOCK_THRESHOLD = 4;

export function WizardProgress({ currentStep, onStepClick }: WizardProgressProps) {
  const completeness = useQuery(api.profiles.getMyCompleteness);

  const getSectionComplete = (stepId: StepId) => {
    if (!completeness) return false;
    const sectionId = STEP_TO_SECTION[stepId];
    return completeness.sections.find((s) => s.id === sectionId)?.isComplete ?? false;
  };

  const completedCount = completeness?.completedCount ?? 0;
  const totalCount = completeness?.totalCount ?? 7;
  const canUnlock = completedCount >= UNLOCK_THRESHOLD;
  const currentIndex = STEPS.findIndex((s) => s.id === currentStep);

  return (
    <>
      {/* Mobile: Horizontal step indicator */}
      <div className="md:hidden mb-6">
        {/* Progress bar */}
        <div className="flex items-center justify-between mb-3 px-1">
          <span className="text-sm font-medium text-foreground">
            Step {currentIndex + 1} of {STEPS.length}
          </span>
          <span className="text-sm text-muted-foreground">
            {completedCount}/{totalCount} complete
          </span>
        </div>

        {/* Step pills - horizontally scrollable */}
        <div className="flex gap-2 overflow-x-auto pb-2 -mx-4 px-4 scrollbar-hide">
          {STEPS.map((step, index) => {
            const isComplete = getSectionComplete(step.id);
            const isCurrent = currentStep === step.id;

            return (
              <button
                key={step.id}
                onClick={() => onStepClick(step.id)}
                className={cn(
                  "flex items-center gap-1.5 px-3 py-2 rounded-full text-sm whitespace-nowrap transition-colors min-h-11 shrink-0",
                  isCurrent
                    ? "bg-primary text-primary-foreground font-medium"
                    : isComplete
                      ? "bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300"
                      : "bg-muted text-muted-foreground hover:bg-muted/80"
                )}
              >
                {isComplete ? (
                  <Check className="size-3.5" />
                ) : (
                  <span className="size-5 flex items-center justify-center rounded-full bg-current/10 text-xs">
                    {index + 1}
                  </span>
                )}
                {step.shortLabel}
              </button>
            );
          })}
        </div>

        {/* Unlock status - compact */}
        <div
          className={cn(
            "mt-3 p-2.5 rounded-md text-sm flex items-center gap-2",
            canUnlock
              ? "bg-green-50 text-green-800 dark:bg-green-900/20 dark:text-green-300"
              : "bg-muted text-muted-foreground"
          )}
        >
          {canUnlock ? (
            <>
              <Check className="size-4" />
              <span>Smart matching unlocked!</span>
            </>
          ) : (
            <>
              <Lock className="size-4" />
              <span>
                {UNLOCK_THRESHOLD - completedCount} more to unlock matching
              </span>
            </>
          )}
        </div>
      </div>

      {/* Desktop: Sidebar (existing layout, refined) */}
      <div className="hidden md:block w-64 shrink-0">
        <div className="sticky top-8">
          <div className="bg-white dark:bg-card rounded-lg border p-4 space-y-4">
            <div className="text-sm font-medium text-foreground">
              Profile Completeness
            </div>

            <div className="text-2xl font-semibold text-foreground">
              {completedCount}{" "}
              <span className="text-base font-normal text-muted-foreground">
                of {totalCount} complete
              </span>
            </div>

            <nav className="space-y-1">
              {STEPS.map((step) => {
                const isComplete = getSectionComplete(step.id);
                const isCurrent = currentStep === step.id;

                return (
                  <button
                    key={step.id}
                    onClick={() => onStepClick(step.id)}
                    className={cn(
                      "w-full flex items-center gap-3 px-3 py-2 rounded-md text-sm text-left transition-colors",
                      isCurrent
                        ? "bg-primary/10 text-primary font-medium"
                        : "text-muted-foreground hover:bg-muted hover:text-foreground"
                    )}
                  >
                    {isComplete ? (
                      <Check className="size-4 text-green-600 shrink-0" />
                    ) : (
                      <Circle className="size-4 text-slate-300 shrink-0" />
                    )}
                    <span>{step.label}</span>
                  </button>
                );
              })}
            </nav>

            <div
              className={cn(
                "mt-4 p-3 rounded-md text-sm",
                canUnlock
                  ? "bg-green-50 text-green-800 dark:bg-green-900/20 dark:text-green-300"
                  : "bg-muted text-muted-foreground"
              )}
            >
              {canUnlock ? (
                <div className="flex items-center gap-2">
                  <Check className="size-4" />
                  <span>Smart matching unlocked!</span>
                </div>
              ) : (
                <div className="flex items-center gap-2">
                  <Lock className="size-4" />
                  <span>
                    Complete {UNLOCK_THRESHOLD - completedCount} more section
                    {UNLOCK_THRESHOLD - completedCount !== 1 ? "s" : ""} to unlock
                    smart matching
                  </span>
                </div>
              )}
            </div>
          </div>
        </div>
      </div>
    </>
  );
}
```

Key mobile UX points:

- Horizontal scrollable pills with step numbers
- Current step highlighted with primary color
- Completed steps show checkmark and green background
- Compact unlock status at bottom
- All buttons have min-h-11 (44px touch target)
- scrollbar-hide class hides scrollbar (add to CSS if needed)
  </action>
  <verify>

1. TypeScript compiles: `bunx tsc --noEmit src/components/profile/wizard/WizardProgress.tsx`
2. Visual test at 375px: Horizontal pills, scrollable
3. Visual test at 768px+: Sidebar layout
   </verify>
   <done>WizardProgress shows horizontal step pills on mobile, sidebar on desktop</done>
   </task>

<task type="auto">
  <name>Task 2: Make ProfileWizard layout responsive</name>
  <files>src/components/profile/wizard/ProfileWizard.tsx</files>
  <action>
Update ProfileWizard to stack on mobile instead of side-by-side:

1. Change flex layout from fixed "flex gap-8" to "flex flex-col md:flex-row md:gap-8"
2. Adjust the form container to not have min-w-0 constraint on mobile
3. Move WizardProgress before form content on mobile (natural stacking)

```tsx
// In ProfileWizard component, update the return statement:

return (
  <div className="flex flex-col md:flex-row md:gap-8">
    {/* Progress indicator - rendered first, appears on top on mobile, side on desktop */}
    <WizardProgress currentStep={currentStep} onStepClick={onStepChange} />

    {/* Form content */}
    <div className="flex-1 md:min-w-0">
      <div className="bg-white dark:bg-card rounded-lg border p-4 sm:p-6">
        {renderCurrentStep()}

        {/* Navigation - ensure touch targets */}
        {!isLastStep && (
          <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mt-8 pt-6 border-t">
            <Button
              variant="outline"
              onClick={goToPreviousStep}
              disabled={isFirstStep}
              className="min-h-11 w-full sm:w-auto order-2 sm:order-1"
            >
              <ChevronLeft className="size-4 mr-1" />
              Previous
            </Button>

            <div className="flex flex-col sm:flex-row items-stretch sm:items-center gap-2 order-1 sm:order-2">
              <Button
                variant="ghost"
                onClick={goToNextStep}
                className="min-h-11"
              >
                <SkipForward className="size-4 mr-1" />
                Skip for now
              </Button>

              <Button onClick={goToNextStep} className="min-h-11">
                Next
                <ChevronRight className="size-4 ml-1" />
              </Button>
            </div>
          </div>
        )}
      </div>
    </div>
  </div>
)
```

Key changes:

- `flex flex-col md:flex-row` - stacks on mobile, row on desktop
- Navigation buttons stack on mobile (flex-col) with reversed order so Next is prominent
- All buttons have min-h-11 for touch targets
- Reduced padding on mobile (p-4 sm:p-6)
  </action>
  <verify>

1. TypeScript compiles: `bunx tsc --noEmit src/components/profile/wizard/ProfileWizard.tsx`
2. Visual test at 375px: Progress on top, form below, buttons stacked
3. Visual test at 768px+: Progress sidebar on left, form on right
   </verify>
   <done>ProfileWizard stacks vertically on mobile, horizontal layout on desktop</done>
   </task>

<task type="auto">
  <name>Task 3: Ensure form steps have mobile-friendly layout</name>
  <files>src/components/profile/wizard/steps/BasicInfoStep.tsx</files>
  <action>
Review and update BasicInfoStep as the template for all form steps:

1. Ensure labels are always above inputs (already using space-y-2 pattern - verify)
2. Add sticky section headings if applicable
3. Verify Input has text-base for iOS zoom prevention
4. Ensure all interactive elements meet touch targets

Check the existing BasicInfoStep and make minimal adjustments if needed. If it already follows good patterns, document what patterns other steps should follow.

Key patterns to verify/implement:

- Labels use `<Label className="block">` not inline
- Form sections use vertical spacing (space-y-4 or space-y-6)
- For multi-section forms, section headings can be sticky:
  ```tsx
  <h3 className="sticky top-0 bg-background py-2 font-semibold border-b mb-4 z-10">
    Section Title
  </h3>
  ```
- All Select and Input components should work at mobile sizes (already have text-base in Input)

Since BasicInfoStep likely has minimal changes needed, focus on ensuring the pattern is clear and documenting what other steps should look like. If significant changes are needed, make them.

Also add scrollbar-hide utility to app.css if not present:

```css
/* Hide scrollbar for horizontal scroll areas */
.scrollbar-hide {
  -ms-overflow-style: none;
  scrollbar-width: none;
}
.scrollbar-hide::-webkit-scrollbar {
  display: none;
}
```

  </action>
  <verify>
1. TypeScript compiles for any modified files
2. Visual test BasicInfoStep at 375px - form fields readable and usable
3. No iOS zoom on input focus (font size >= 16px)
  </verify>
  <done>Form steps have labels above inputs, proper spacing, and no iOS zoom issues</done>
</task>

</tasks>

<verification>
After completing all tasks:
1. Run `bun run lint` - should pass
2. Run `bun run dev` and navigate to /profile/edit
3. Test at 375px:
   - Horizontal step pills visible and scrollable
   - Form content below progress
   - Buttons stacked appropriately
   - Can navigate between steps
4. Test at 768px+:
   - Sidebar visible on left
   - Form content on right
   - Original layout preserved
</verification>

<success_criteria>

- Wizard is usable at 375px viewport
- No horizontal scroll
- Step navigation works on mobile
- Form fields properly formatted with labels above
- Touch targets meet 44px minimum
- Layout transitions smoothly between breakpoints
  </success_criteria>

<output>
After completion, create `.planning/phases/21-responsive-foundation/21-03-SUMMARY.md`
</output>
