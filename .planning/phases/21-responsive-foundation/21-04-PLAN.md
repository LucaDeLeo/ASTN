---
phase: 21-responsive-foundation
plan: 04
type: execute
wave: 2
depends_on: [21-01]
files_modified:
  - src/routes/org/$slug/admin/members/index.tsx
  - src/components/org/MemberFilters.tsx
autonomous: true

must_haves:
  truths:
    - "Admin can view member list on mobile as compact cards"
    - "Admin can filter members on mobile via sheet"
    - "Member actions accessible via dropdown on mobile"
  artifacts:
    - path: "src/routes/org/$slug/admin/members/index.tsx"
      provides: "Responsive member management view"
      contains: "md:hidden"
    - path: "src/components/org/MemberFilters.tsx"
      provides: "Responsive member filters"
      contains: "ResponsiveSheet"
  key_links:
    - from: "src/routes/org/$slug/admin/members/index.tsx"
      to: "table layout"
      via: "responsive conditional"
      pattern: "hidden md:block"
---

<objective>
Make admin member management responsive for mobile administrators.

Purpose: Per CONTEXT.md, "Admin CRM tables become compact lists (avatar + name + key stat)" on mobile. This plan converts the 8-column members table to a mobile-friendly card/list layout while keeping the full table on desktop.

Output: Org admins can effectively manage members on mobile devices.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/21-responsive-foundation/21-CONTEXT.md
@.planning/phases/21-responsive-foundation/21-RESEARCH.md

@src/routes/org/$slug/admin/members/index.tsx
@src/components/org/MemberFilters.tsx
@src/components/ui/responsive-sheet.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create mobile member list component</name>
  <files>src/routes/org/$slug/admin/members/index.tsx</files>
  <action>
Add a MemberCardMobile component within the file that shows:
- Avatar or initials
- Name (primary)
- One key stat (engagement level or profile completeness)
- Dropdown menu for actions

Per CONTEXT.md: "avatar + name + key stat"

Add this component before MemberRow:

```tsx
function MemberCardMobile({
  member,
  engagement,
  orgId,
  slug,
  currentMembershipId
}: MemberRowProps) {
  const [isLoading, setIsLoading] = useState(false);
  const [overrideDialogOpen, setOverrideDialogOpen] = useState(false);

  const removeMember = useMutation(api.orgs.admin.removeMember);
  const promoteToAdmin = useMutation(api.orgs.admin.promoteToAdmin);
  const demoteToMember = useMutation(api.orgs.admin.demoteToMember);

  const isSelf = member.membership._id === currentMembershipId;
  const isAdmin = member.membership.role === "admin";
  const joinedDate = new Date(member.membership.joinedAt).toLocaleDateString(
    "en-US",
    { month: "short", day: "numeric", year: "numeric" }
  );

  const handlePromote = async () => {
    setIsLoading(true);
    try {
      await promoteToAdmin({ orgId, membershipId: member.membership._id });
    } catch (error) {
      console.error("Failed to promote member:", error);
    } finally {
      setIsLoading(false);
    }
  };

  const handleDemote = async () => {
    setIsLoading(true);
    try {
      await demoteToMember({ orgId, membershipId: member.membership._id });
    } catch (error) {
      console.error("Failed to demote member:", error);
    } finally {
      setIsLoading(false);
    }
  };

  const handleRemove = async () => {
    if (!confirm(`Remove ${member.profile?.name || "this member"} from the organization?`)) {
      return;
    }
    setIsLoading(true);
    try {
      await removeMember({ orgId, membershipId: member.membership._id });
    } catch (error) {
      console.error("Failed to remove member:", error);
    } finally {
      setIsLoading(false);
    }
  };

  // Get initials for avatar
  const initials = member.profile?.name
    ?.split(" ")
    .map((n) => n[0])
    .join("")
    .slice(0, 2)
    .toUpperCase() || "?";

  return (
    <>
      <div className="flex items-center gap-3 p-4 border-b last:border-b-0">
        {/* Avatar */}
        <Link
          to="/org/$slug/admin/members/$userId"
          params={{ slug, userId: member.membership.userId }}
          className="shrink-0"
        >
          <div className="size-10 rounded-full bg-primary/10 flex items-center justify-center text-sm font-medium text-primary">
            {initials}
          </div>
        </Link>

        {/* Content */}
        <div className="flex-1 min-w-0">
          <Link
            to="/org/$slug/admin/members/$userId"
            params={{ slug, userId: member.membership.userId }}
          >
            <div className="flex items-center gap-2">
              <span className="font-medium text-foreground truncate">
                {member.profile?.name || "No name"}
              </span>
              {isAdmin && (
                <Badge variant="secondary" className="shrink-0 text-xs">
                  <Shield className="size-3 mr-0.5" />
                  Admin
                </Badge>
              )}
            </div>
          </Link>
          <div className="flex items-center gap-2 mt-0.5">
            {/* Key stat: engagement */}
            {engagement ? (
              <EngagementBadge
                level={engagement.level}
                hasOverride={engagement.hasOverride}
                adminExplanation={engagement.adminExplanation}
                onClick={() => setOverrideDialogOpen(true)}
              />
            ) : (
              <PendingEngagementBadge />
            )}
            <span className="text-xs text-muted-foreground">
              Joined {joinedDate}
            </span>
          </div>
        </div>

        {/* Actions dropdown */}
        <DropdownMenu>
          <DropdownMenuTrigger asChild>
            <Button
              variant="ghost"
              size="icon"
              disabled={isLoading}
              className="min-h-11 min-w-11"
            >
              {isLoading ? (
                <Spinner className="size-4" />
              ) : (
                <MoreHorizontal className="size-4" />
              )}
            </Button>
          </DropdownMenuTrigger>
          <DropdownMenuContent align="end">
            <DropdownMenuItem asChild>
              <Link
                to="/org/$slug/admin/members/$userId"
                params={{ slug, userId: member.membership.userId }}
              >
                <User className="size-4 mr-2" />
                View Details
              </Link>
            </DropdownMenuItem>
            {engagement && (
              <>
                <DropdownMenuSeparator />
                <DropdownMenuItem onClick={() => setOverrideDialogOpen(true)}>
                  <Settings className="size-4 mr-2" />
                  Override Engagement
                </DropdownMenuItem>
              </>
            )}
            <DropdownMenuSeparator />
            {!isAdmin && (
              <DropdownMenuItem onClick={handlePromote}>
                <Shield className="size-4 mr-2" />
                Promote to Admin
              </DropdownMenuItem>
            )}
            {isAdmin && !isSelf && (
              <DropdownMenuItem onClick={handleDemote}>
                <ShieldOff className="size-4 mr-2" />
                Demote to Member
              </DropdownMenuItem>
            )}
            {!isSelf && (
              <>
                <DropdownMenuSeparator />
                <DropdownMenuItem onClick={handleRemove} className="text-red-600">
                  <Trash2 className="size-4 mr-2" />
                  Remove
                </DropdownMenuItem>
              </>
            )}
          </DropdownMenuContent>
        </DropdownMenu>
      </div>

      {/* Override Dialog */}
      {engagement && (
        <OverrideDialog
          open={overrideDialogOpen}
          onOpenChange={setOverrideDialogOpen}
          engagementId={engagement._id}
          memberName={member.profile?.name || "Member"}
          currentLevel={engagement.level}
          currentExplanation={engagement.adminExplanation}
          hasOverride={engagement.hasOverride}
          overrideNotes={engagement.overrideNotes}
          orgId={orgId}
          userId={member.membership.userId}
        />
      )}
    </>
  );
}
```

The component duplicates some logic from MemberRow but that's acceptable for clear separation between mobile and desktop views. Could be refactored to share state/handlers later if needed.
  </action>
  <verify>
TypeScript compiles: `bunx tsc --noEmit src/routes/org/$slug/admin/members/index.tsx`
  </verify>
  <done>MemberCardMobile component shows avatar, name, engagement, and action menu</done>
</task>

<task type="auto">
  <name>Task 2: Add responsive table/list switching</name>
  <files>src/routes/org/$slug/admin/members/index.tsx</files>
  <action>
Update the members display section to show:
- Mobile (md:hidden): Card list using MemberCardMobile
- Desktop (hidden md:block): Existing table

Find the section that renders the members table (inside the Card with overflow-hidden) and wrap it with responsive classes:

```tsx
{/* Members display */}
{members === undefined ? (
  <Card className="p-8 text-center">
    <Spinner className="size-8 mx-auto" />
  </Card>
) : filteredMembers.length === 0 ? (
  /* ... existing empty state ... */
) : (
  <>
    {/* Mobile: Card list */}
    <Card className="md:hidden">
      <div className="divide-y">
        {paginatedMembers.map((member) => (
          <MemberCardMobile
            key={member.membership._id}
            member={member}
            engagement={engagementMap.get(member.membership.userId) || null}
            orgId={org._id}
            slug={slug}
            currentMembershipId={membership._id}
          />
        ))}
      </div>
      {/* Mobile pagination */}
      {totalPages > 1 && (
        <div className="flex items-center justify-between p-4 border-t">
          <span className="text-sm text-muted-foreground">
            {(page - 1) * pageSize + 1}-{Math.min(page * pageSize, filteredMembers.length)} of {filteredMembers.length}
          </span>
          <div className="flex gap-2">
            <Button
              variant="outline"
              size="icon"
              onClick={() => setPage((p) => p - 1)}
              disabled={page === 1}
              className="min-h-11 min-w-11"
            >
              <ChevronLeft className="size-4" />
            </Button>
            <Button
              variant="outline"
              size="icon"
              onClick={() => setPage((p) => p + 1)}
              disabled={page === totalPages}
              className="min-h-11 min-w-11"
            >
              <ChevronRight className="size-4" />
            </Button>
          </div>
        </div>
      )}
    </Card>

    {/* Desktop: Full table */}
    <Card className="hidden md:block overflow-hidden">
      {/* ... existing table code unchanged ... */}
    </Card>
  </>
)}
```

Make sure to import any additional components if needed and keep the existing table code intact within the hidden md:block wrapper.
  </action>
  <verify>
1. TypeScript compiles
2. Visual test at 375px: Card list with avatars and dropdowns
3. Visual test at 768px+: Full table with all columns
  </verify>
  <done>Members page shows card list on mobile, full table on desktop</done>
</task>

<task type="auto">
  <name>Task 3: Make MemberFilters responsive</name>
  <files>src/components/org/MemberFilters.tsx</files>
  <action>
Update MemberFilters to use the same pattern as opportunity filters:
- Mobile: Active filters as chips + "Filter" button opening ResponsiveSheet
- Desktop: Keep existing inline layout

First, check what the current MemberFilters looks like, then apply similar pattern to MobileFilters:

```tsx
import { useState } from "react";
import { Filter, Search, X } from "lucide-react";
import { Badge } from "~/components/ui/badge";
import { Button } from "~/components/ui/button";
import { Input } from "~/components/ui/input";
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "~/components/ui/select";
import {
  ResponsiveSheet,
  ResponsiveSheetContent,
  ResponsiveSheetHeader,
  ResponsiveSheetTitle,
  ResponsiveSheetTrigger,
} from "~/components/ui/responsive-sheet";

// ... existing types and constants

export function MemberFilters({
  filters,
  onFiltersChange,
  availableSkills,
  availableLocations,
}: MemberFiltersProps) {
  const [sheetOpen, setSheetOpen] = useState(false);

  // Build active filter chips for mobile
  const activeFilters: Array<{ key: string; label: string; onRemove: () => void }> = [];

  if (filters.search) {
    activeFilters.push({
      key: "search",
      label: `"${filters.search}"`,
      onRemove: () => onFiltersChange({ ...filters, search: undefined }),
    });
  }
  if (filters.engagementLevels?.length) {
    activeFilters.push({
      key: "engagement",
      label: `${filters.engagementLevels.length} engagement levels`,
      onRemove: () => onFiltersChange({ ...filters, engagementLevels: undefined }),
    });
  }
  // Add more chip types as needed for skills, locations, dates

  const clearAllFilters = () => {
    onFiltersChange({});
  };

  const hasActiveFilters = Object.keys(filters).some(
    (k) => filters[k as keyof typeof filters] !== undefined
  );

  return (
    <div className="mb-6">
      {/* Mobile: Chips + Filter button */}
      <div className="md:hidden space-y-3">
        {/* Active filter chips */}
        {activeFilters.length > 0 && (
          <div className="flex flex-wrap gap-2">
            {activeFilters.map((filter) => (
              <Badge key={filter.key} variant="secondary" className="pr-1 gap-1">
                {filter.label}
                <button
                  onClick={filter.onRemove}
                  className="ml-1 rounded-full hover:bg-muted-foreground/20 p-0.5"
                >
                  <X className="size-3" />
                </button>
              </Badge>
            ))}
            <button
              onClick={clearAllFilters}
              className="text-sm text-muted-foreground hover:text-foreground"
            >
              Clear all
            </button>
          </div>
        )}

        {/* Filter button */}
        <ResponsiveSheet open={sheetOpen} onOpenChange={setSheetOpen}>
          <ResponsiveSheetTrigger asChild>
            <Button variant="outline" className="w-full min-h-11">
              <Filter className="size-4 mr-2" />
              Filter Members
              {hasActiveFilters && (
                <Badge variant="secondary" className="ml-2">
                  {activeFilters.length}
                </Badge>
              )}
            </Button>
          </ResponsiveSheetTrigger>
          <ResponsiveSheetContent className="overflow-y-auto">
            <ResponsiveSheetHeader>
              <ResponsiveSheetTitle>Filter Members</ResponsiveSheetTitle>
            </ResponsiveSheetHeader>

            <div className="space-y-4 py-4">
              {/* Search */}
              <div className="space-y-2">
                <label className="text-sm font-medium">Search</label>
                <Input
                  placeholder="Name or email..."
                  value={filters.search || ""}
                  onChange={(e) =>
                    onFiltersChange({ ...filters, search: e.target.value || undefined })
                  }
                />
              </div>

              {/* Engagement Level - simplified for mobile */}
              <div className="space-y-2">
                <label className="text-sm font-medium">Engagement</label>
                {/* Render engagement level checkboxes or select */}
              </div>

              {/* Add other filter controls as needed */}
            </div>

            <Button className="w-full min-h-11" onClick={() => setSheetOpen(false)}>
              Show Results
            </Button>
          </ResponsiveSheetContent>
        </ResponsiveSheet>
      </div>

      {/* Desktop: Keep existing inline layout */}
      <div className="hidden md:block">
        {/* ... existing desktop filter layout ... */}
      </div>
    </div>
  );
}
```

Adapt this pattern based on the actual current MemberFilters implementation - keep the desktop layout unchanged and add the mobile wrapper.
  </action>
  <verify>
1. TypeScript compiles
2. Visual test at 375px: Filter button with chips, sheet opens from bottom
3. Visual test at 768px+: Inline filters as before
  </verify>
  <done>MemberFilters shows chip/sheet pattern on mobile, inline filters on desktop</done>
</task>

</tasks>

<verification>
After completing all tasks:
1. Run `bun run lint` - should pass
2. Run `bun run dev`
3. Navigate to an org admin members page
4. Test at 375px:
   - Card list instead of table
   - Filter button opens sheet
   - Actions accessible via dropdown
   - Pagination works
5. Test at 768px+:
   - Full table with all columns
   - Inline filters
</verification>

<success_criteria>
- Admin members page usable on mobile
- No horizontal scroll at 375px
- All actions accessible (view, promote, demote, remove)
- Filters work on mobile
- Touch targets meet 44px minimum
</success_criteria>

<output>
After completion, create `.planning/phases/21-responsive-foundation/21-04-SUMMARY.md`
</output>
