---
phase: 22-mobile-navigation
plan: 04
type: execute
wave: 3
depends_on: [22-02, 22-03]
files_modified:
  - src/components/layout/mobile-shell.tsx
  - src/components/layout/mobile-header.tsx
  - src/routes/index.tsx
  - src/routes/opportunities/index.tsx
  - src/routes/matches/index.tsx
  - src/routes/profile/index.tsx
  - src/routes/settings/route.tsx
autonomous: false

must_haves:
  truths:
    - "User sees bottom tab bar on mobile viewports"
    - "User sees standard header on desktop viewports"
    - "User can access hamburger menu from mobile header"
    - "Main content is padded to not be hidden behind tab bar"
  artifacts:
    - path: "src/components/layout/mobile-shell.tsx"
      provides: "MobileShell wrapper with tab bar and header"
      exports: ["MobileShell"]
      min_lines: 30
    - path: "src/components/layout/mobile-header.tsx"
      provides: "Mobile header with logo and hamburger trigger"
      exports: ["MobileHeader"]
      min_lines: 25
  key_links:
    - from: "src/components/layout/mobile-shell.tsx"
      to: "src/components/layout/bottom-tab-bar.tsx"
      via: "imports BottomTabBar"
      pattern: "BottomTabBar"
    - from: "src/components/layout/mobile-shell.tsx"
      to: "src/components/layout/mobile-header.tsx"
      via: "imports MobileHeader"
      pattern: "MobileHeader"
    - from: "src/routes/index.tsx"
      to: "useIsMobile hook"
      via: "conditional rendering"
      pattern: "useIsMobile"
---

<objective>
Create MobileShell layout and integrate mobile navigation into authenticated routes.

Purpose: Authenticated pages need conditional layout - mobile shell (header + tab bar) on mobile viewports, standard AuthHeader on desktop.

Output: MobileShell and MobileHeader components, plus integration into the 5 primary authenticated routes (Home, Opportunities, Matches, Profile, Settings).
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/22-mobile-navigation/22-CONTEXT.md
@.planning/phases/22-mobile-navigation/22-RESEARCH.md
@.planning/phases/22-mobile-navigation/22-02-SUMMARY.md
@.planning/phases/22-mobile-navigation/22-03-SUMMARY.md
@src/components/layout/bottom-tab-bar.tsx
@src/components/layout/hamburger-menu.tsx
@src/components/layout/auth-header.tsx
@src/hooks/use-media-query.ts
@src/routes/index.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create MobileHeader component</name>
  <files>src/components/layout/mobile-header.tsx</files>
  <action>
Create MobileHeader - the top bar for mobile that contains logo and hamburger menu trigger.

Structure:
1. Fixed position at top, z-50
2. Safe area padding for notch: pt-[var(--safe-area-inset-top)]
3. Background: bg-background with border-b
4. Flex layout with justify-between
5. Left: Logo/app name - Link to "/" with "ASTN" text (font-semibold font-mono)
6. Right: HamburgerMenu component (accepts user prop)
7. Height: h-14 (56px) for content area

Accept props:
- user: { name: string; avatarUrl?: string } | null (passed to HamburgerMenu)

The header should NOT include the NotificationBell or ThemeToggle - these are available in Settings or can be added to hamburger menu later.
  </action>
  <verify>Read file and confirm fixed positioning, safe area padding, logo link, and HamburgerMenu integration.</verify>
  <done>MobileHeader provides mobile top bar with logo and hamburger menu access</done>
</task>

<task type="auto">
  <name>Task 2: Create MobileShell layout component</name>
  <files>src/components/layout/mobile-shell.tsx</files>
  <action>
Create MobileShell - the layout wrapper for authenticated mobile views.

Structure:
1. MobileHeader at top (fixed)
2. Main content area with:
   - pt-14 (header height)
   - pb-safe-bottom class (tab bar height + safe area from 22-01)
   - min-h-screen
3. BottomTabBar at bottom (fixed)

Accept props:
- children: React.ReactNode
- user: { name: string; avatarUrl?: string } | null

The shell handles all positioning so child components don't need to worry about header/tab bar overlap.
  </action>
  <verify>Read file and confirm MobileHeader, BottomTabBar, and proper content area padding classes.</verify>
  <done>MobileShell wraps mobile views with header and tab bar, handling all positioning</done>
</task>

<task type="auto">
  <name>Task 3: Integrate mobile navigation into primary routes</name>
  <files>
    src/routes/index.tsx
    src/routes/opportunities/index.tsx
    src/routes/matches/index.tsx
    src/routes/profile/index.tsx
    src/routes/settings/route.tsx
  </files>
  <action>
Update the 5 primary authenticated routes to use conditional mobile/desktop layout.

Pattern for each route:
1. Import useIsMobile from ~/hooks/use-media-query
2. Import MobileShell from ~/components/layout/mobile-shell
3. Import useQuery from convex/react and api for user data (if not already)
4. In the component, get user data for the header (name for display)
5. Use conditional rendering:

```tsx
const isMobile = useIsMobile();
const currentUser = useQuery(api.profiles.getCurrentUser); // or similar

// For authenticated content:
if (isMobile) {
  return (
    <MobileShell user={currentUser ? { name: currentUser.name } : null}>
      <GradientBg variant="subtle">
        {/* existing page content without AuthHeader */}
      </GradientBg>
    </MobileShell>
  );
}

return (
  <GradientBg variant="subtle">
    <AuthHeader />
    {/* existing page content */}
  </GradientBg>
);
```

Key points:
- Remove AuthHeader from mobile view (MobileShell provides MobileHeader)
- Keep AuthHeader for desktop view
- GradientBg goes inside MobileShell on mobile
- For index.tsx (Home), handle the Authenticated/Unauthenticated split appropriately - only authenticated users get MobileShell
- For settings/route.tsx, check if it uses a route layout pattern and adapt accordingly

DO NOT change:
- Unauthenticated views (they still use PublicHeader or landing page)
- Admin routes (they have their own layout)
- Org routes (separate concern)
  </action>
  <verify>
1. Check each file for useIsMobile conditional rendering
2. Confirm MobileShell is used for authenticated mobile views
3. Confirm AuthHeader remains for desktop views
4. Run `bun run lint` to check for type errors
  </verify>
  <done>5 primary routes conditionally render MobileShell on mobile and AuthHeader on desktop</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Mobile navigation system with bottom tab bar, hamburger menu, and responsive layout switching</what-built>
  <how-to-verify>
1. Start dev server: `bun run dev`
2. Open Chrome DevTools (F12) and enable device toolbar (Ctrl+Shift+M)
3. Select iPhone 14 Pro or similar notched device preset
4. Test bottom tab bar:
   - Navigate to each of the 5 tabs (Home, Opportunities, Matches, Profile, Settings)
   - Verify active tab shows coral/primary color with bold label
   - Tap active tab again - should scroll to top
5. Test hamburger menu:
   - Tap hamburger icon in top right
   - Menu should slide in from right
   - Verify Admin, Help, Logout items are present
   - Tap profile header - should navigate to profile
   - Test logout functionality
6. Test safe areas:
   - In DevTools, the simulated notch area should not overlap content
   - Tab bar should extend to screen edge with content padded
7. Test desktop fallback:
   - Disable device toolbar or use desktop viewport
   - Verify standard AuthHeader appears (no tab bar, no hamburger)
  </how-to-verify>
  <resume-signal>Type "approved" if navigation works correctly on mobile and desktop, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
1. Files exist: `ls src/components/layout/mobile-{shell,header}.tsx`
2. Routes updated: `grep -l "useIsMobile" src/routes/{index,opportunities/index,matches/index,profile/index,settings/route}.tsx`
3. Build passes: `bun run build`
</verification>

<success_criteria>
- Mobile users see bottom tab bar for primary navigation
- Mobile users can access Admin/Help/Logout via hamburger menu
- Desktop users see standard AuthHeader (no tab bar)
- Content respects safe areas on notched devices
- Active tab is clearly indicated with brand color
</success_criteria>

<output>
After completion, create `.planning/phases/22-mobile-navigation/22-04-SUMMARY.md`
</output>
