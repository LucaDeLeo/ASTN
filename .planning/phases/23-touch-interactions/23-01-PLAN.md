---
phase: 23-touch-interactions
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - bun.lockb
  - src/styles/app.css
  - src/hooks/use-haptic.ts
autonomous: true

must_haves:
  truths:
    - "Taps feel immediate with no 300ms delay"
    - "Browser tap highlight is suppressed in favor of custom active states"
    - "Haptic patterns available for key interactions"
  artifacts:
    - path: "src/hooks/use-haptic.ts"
      provides: "Vibration API wrapper with graceful Safari degradation"
      exports: ["useHaptic"]
    - path: "src/styles/app.css"
      provides: "Global touch optimization CSS"
      contains: "touch-action: manipulation"
  key_links:
    - from: "src/styles/app.css"
      to: "html element"
      via: "touch-action: manipulation"
      pattern: "html.*touch-action.*manipulation"
    - from: "src/hooks/use-haptic.ts"
      to: "navigator.vibrate"
      via: "feature detection"
      pattern: "'vibrate' in navigator"
---

<objective>
Establish touch interaction foundation with global CSS optimizations and haptic feedback utility

Purpose: Eliminate 300ms tap delay on mobile browsers and provide haptic feedback capability for native builds. This foundation enables Plans 02 and 03 to build gesture features.

Output: Global touch CSS rules in app.css, useHaptic hook for vibration patterns, @use-gesture library installed
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/23-touch-interactions/23-RESEARCH.md
@src/styles/app.css
@src/components/ui/button.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install @use-gesture/react</name>
  <files>package.json, bun.lockb</files>
  <action>
Install @use-gesture/react for gesture detection in upcoming plans.

```bash
bun add @use-gesture/react
```

This library provides unified touch/mouse/pointer event handling with built-in swipe detection, drag physics, and axis locking. It's tree-shakeable and works with React 19.

Do NOT install @react-spring/web yet - start with CSS transitions and only add spring physics if needed later.
  </action>
  <verify>
```bash
bun pm ls | grep @use-gesture
```
Should show @use-gesture/react installed.
  </verify>
  <done>@use-gesture/react appears in package.json dependencies</done>
</task>

<task type="auto">
  <name>Task 2: Add global touch CSS optimizations</name>
  <files>src/styles/app.css</files>
  <action>
Add CSS rules to optimize touch interactions globally. Add these in a new section after the safe area handling section:

```css
/* ==========================================================================
   TOUCH INTERACTION OPTIMIZATION - Native-feeling tap and gesture support
   ========================================================================== */

/* Remove 300ms tap delay globally - allows immediate response to touches */
html {
  touch-action: manipulation;
}

/* Suppress default browser tap highlight - we provide custom :active states */
* {
  -webkit-tap-highlight-color: transparent;
}

/* Utility for pull-to-refresh containers - prevents browser refresh competing */
.pull-to-refresh-container {
  overscroll-behavior-y: contain;
}

/* Utility for horizontal swipe elements - preserve vertical scroll */
.swipeable {
  touch-action: pan-y;
}

/* Faster tap feedback transition - 100ms per TOUCH-02 requirement */
.tap-feedback {
  transition: transform 100ms ease-out, opacity 100ms ease-out;
}

.tap-feedback:active {
  transform: scale(0.97);
  opacity: 0.9;
}
```

Note: The button component already has active:scale-[0.97] and transition-all. The touch-action: manipulation on html is the key fix for the 300ms delay.
  </action>
  <verify>
```bash
grep -A2 "touch-action: manipulation" src/styles/app.css
```
Should show the touch-action rule on html element.
  </verify>
  <done>app.css contains touch-action: manipulation on html, tap highlight suppression, pull-to-refresh container and swipeable utilities</done>
</task>

<task type="auto">
  <name>Task 3: Create useHaptic hook</name>
  <files>src/hooks/use-haptic.ts</files>
  <action>
Create a haptic feedback utility hook that wraps the Vibration API with graceful degradation for Safari (which doesn't support it).

Create `src/hooks/use-haptic.ts`:

```typescript
import { useCallback } from "react";

/**
 * Haptic feedback patterns using the Vibration API.
 * Gracefully degrades on unsupported browsers (Safari/iOS).
 *
 * Per TOUCH-04: haptics are for native builds only, but this hook
 * provides the foundation for when running in Tauri.
 */
export function useHaptic() {
  const vibrate = useCallback((pattern: number | number[]) => {
    // Feature detection - Safari doesn't support Vibration API
    if ("vibrate" in navigator) {
      try {
        navigator.vibrate(pattern);
      } catch {
        // Silently fail if vibration blocked by browser policy
      }
    }
    // Silent no-op on unsupported browsers
  }, []);

  return {
    /** Light tap feedback - 10ms */
    tap: useCallback(() => vibrate(10), [vibrate]),

    /** Success feedback - double pulse */
    success: useCallback(() => vibrate([10, 50, 10]), [vibrate]),

    /** Error feedback - longer pattern */
    error: useCallback(() => vibrate([50, 30, 50, 30, 50]), [vibrate]),

    /** Warning feedback - medium pattern */
    warning: useCallback(() => vibrate([30, 20, 30]), [vibrate]),

    /** Custom pattern - array of on/off durations in ms */
    custom: vibrate,
  };
}
```

Key design decisions:
- Feature detection before calling navigator.vibrate
- Try-catch for browsers that have the API but block it
- Silent degradation (no console warnings) for UX
- Memoized callbacks to prevent unnecessary re-renders
  </action>
  <verify>
```bash
# Check file exists and exports useHaptic
grep -l "export function useHaptic" src/hooks/use-haptic.ts
```
  </verify>
  <done>useHaptic hook exists with tap, success, error, warning, and custom methods, all with graceful Safari degradation</done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **Library installed:**
   ```bash
   bun pm ls | grep @use-gesture
   ```

2. **CSS optimizations present:**
   ```bash
   grep "touch-action: manipulation" src/styles/app.css
   grep "webkit-tap-highlight-color" src/styles/app.css
   ```

3. **Hook compiles:**
   ```bash
   bun run lint
   ```

4. **Manual test (optional):**
   - Open dev server on mobile device
   - Tap buttons - should respond immediately without 300ms delay
   - No blue/gray highlight rectangle on tap
</verification>

<success_criteria>
- @use-gesture/react installed (enables Plans 02 and 03)
- touch-action: manipulation applied to html element (fixes 300ms tap delay)
- webkit-tap-highlight-color: transparent applied globally (cleaner tap feedback)
- useHaptic hook available with tap/success/error/warning patterns
- Build passes with no lint errors
</success_criteria>

<output>
After completion, create `.planning/phases/23-touch-interactions/23-01-SUMMARY.md`
</output>
