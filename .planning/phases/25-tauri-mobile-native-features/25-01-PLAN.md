---
phase: 25-tauri-mobile-native-features
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src-tauri/Cargo.toml
  - src-tauri/tauri.conf.json
  - src-tauri/src/lib.rs
  - src-tauri/capabilities/default.json
  - vite.config.tauri.ts
  - src/lib/platform.ts
autonomous: true

must_haves:
  truths:
    - "Tauri CLI commands (tauri dev, tauri build) are available"
    - "SPA build produces static assets in dist/ suitable for Tauri"
    - "Platform detection correctly identifies Tauri vs web environment"
  artifacts:
    - path: "src-tauri/tauri.conf.json"
      provides: "Tauri app configuration with ASTN identity"
      contains: "ai.astn.app"
    - path: "src-tauri/Cargo.toml"
      provides: "Rust dependencies for Tauri plugins"
      contains: "tauri-plugin-deep-link"
    - path: "src-tauri/src/lib.rs"
      provides: "Plugin initialization for mobile entry point"
      contains: "mobile_entry_point"
    - path: "vite.config.tauri.ts"
      provides: "SPA build configuration without SSR"
      min_lines: 15
    - path: "src/lib/platform.ts"
      provides: "Platform detection utilities"
      exports: ["isTauri", "getPlatform"]
  key_links:
    - from: "package.json"
      to: "@tauri-apps/cli"
      via: "devDependencies"
      pattern: "@tauri-apps/cli"
    - from: "vite.config.tauri.ts"
      to: "dist/"
      via: "build.outDir"
      pattern: "outDir.*dist"
---

<objective>
Initialize Tauri project with mobile targets and create SPA build configuration

Purpose: Establish the foundation for iOS and Android app builds by setting up Tauri v2 with all required plugins and a separate Vite config that produces static SPA output (no SSR) suitable for WebView embedding.

Output: Working Tauri project structure with CLI commands available, plugin initialization, and platform detection utilities.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/25-tauri-mobile-native-features/25-RESEARCH.md

@package.json
@vite.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Tauri CLI and JavaScript packages</name>
  <files>package.json</files>
  <action>
Install Tauri development and runtime dependencies:

**Dev dependency:**
- @tauri-apps/cli ^2.6.0 (Tauri CLI for init, dev, build)

**Runtime dependencies:**
- @tauri-apps/api ^2.0.0 (JavaScript API bindings)
- @tauri-apps/plugin-deep-link ^2.4.6 (OAuth redirects)
- @tauri-apps/plugin-biometric ^2.2.1 (Face ID/Touch ID)
- @tauri-apps/plugin-store ^2.0.0 (Token persistence)
- @tauri-apps/plugin-notification ^2.0.0 (Local notifications)
- @tauri-apps/plugin-os ^2.0.0 (Platform detection)

Add to package.json scripts:
- "tauri": "tauri"
- "build:tauri": "vite build --config vite.config.tauri.ts"
- "dev:tauri": "tauri dev"

Use bun for installation: `bun add -D @tauri-apps/cli && bun add @tauri-apps/api @tauri-apps/plugin-deep-link @tauri-apps/plugin-biometric @tauri-apps/plugin-store @tauri-apps/plugin-notification @tauri-apps/plugin-os`
  </action>
  <verify>Run `bun tauri --version` to confirm CLI is installed (should show 2.x.x)</verify>
  <done>Tauri CLI available, all plugin packages in package.json</done>
</task>

<task type="auto">
  <name>Task 2: Initialize Tauri project with mobile configuration</name>
  <files>
    src-tauri/Cargo.toml
    src-tauri/tauri.conf.json
    src-tauri/src/lib.rs
    src-tauri/capabilities/default.json
  </files>
  <action>
Run `bun tauri init` with these responses:
- App name: ASTN
- Window title: ASTN
- Frontend dev URL: http://localhost:3000
- Frontend dist directory: ../dist
- Frontend dev command: bun run dev:web
- Frontend build command: bun run build:tauri

After init, update src-tauri/tauri.conf.json:
```json
{
  "$schema": "https://schema.tauri.app/config/2",
  "productName": "ASTN",
  "version": "2.0.0",
  "identifier": "ai.astn.app",
  "build": {
    "frontendDist": "../dist",
    "devUrl": "http://localhost:3000",
    "beforeDevCommand": "bun run dev:web",
    "beforeBuildCommand": "bun run build:tauri"
  },
  "app": {
    "withGlobalTauri": true,
    "windows": [
      {
        "title": "ASTN",
        "width": 390,
        "height": 844,
        "resizable": true
      }
    ]
  },
  "plugins": {
    "deep-link": {
      "mobile": [
        {
          "scheme": ["astn"],
          "appLink": false
        }
      ]
    }
  }
}
```

Update src-tauri/Cargo.toml to add plugin dependencies:
```toml
[dependencies]
tauri = { version = "2", features = [] }
tauri-plugin-deep-link = "2"
tauri-plugin-store = "2"
tauri-plugin-os = "2"
tauri-plugin-notification = "2"

[target.'cfg(mobile)'.dependencies]
tauri-plugin-biometric = "2"
```

Update src-tauri/src/lib.rs for plugin initialization:
```rust
#[cfg_attr(mobile, tauri::mobile_entry_point)]
pub fn run() {
    tauri::Builder::default()
        .plugin(tauri_plugin_deep_link::init())
        .plugin(tauri_plugin_store::Builder::new().build())
        .plugin(tauri_plugin_os::init())
        .plugin(tauri_plugin_notification::init())
        #[cfg(mobile)]
        .plugin(tauri_plugin_biometric::Builder::new().build())
        .run(tauri::generate_context!())
        .expect("error while running tauri application");
}
```

Create src-tauri/capabilities/default.json for permissions:
```json
{
  "$schema": "https://schema.tauri.app/config/2/capability",
  "identifier": "default",
  "description": "Default permissions for ASTN mobile app",
  "windows": ["main"],
  "permissions": [
    "core:default",
    "deep-link:default",
    "store:default",
    "os:default",
    "notification:default",
    "biometric:allow-authenticate",
    "biometric:allow-status"
  ]
}
```
  </action>
  <verify>Check that src-tauri/ directory exists with tauri.conf.json, Cargo.toml, and src/lib.rs</verify>
  <done>Tauri project initialized with ai.astn.app identifier and all plugins configured</done>
</task>

<task type="auto">
  <name>Task 3: Create SPA Vite config and platform utilities</name>
  <files>
    vite.config.tauri.ts
    src/lib/platform.ts
  </files>
  <action>
Create vite.config.tauri.ts for SPA builds (no TanStack Start SSR):

```typescript
// vite.config.tauri.ts
// Separate config for Tauri builds - produces static SPA (no SSR)
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import tailwindcss from '@tailwindcss/vite'
import tsConfigPaths from 'vite-tsconfig-paths'

export default defineConfig({
  plugins: [
    tailwindcss(),
    tsConfigPaths({
      projects: ['./tsconfig.json'],
    }),
    react({
      babel: {
        plugins: ['babel-plugin-react-compiler'],
      },
    }),
  ],
  build: {
    outDir: 'dist',
    // SPA: single index.html handles all routes
    rollupOptions: {
      input: 'index.html',
    },
  },
  // Required for Tauri to resolve paths correctly
  base: './',
  // Clear screen disabled for Tauri dev mode output
  clearScreen: false,
  server: {
    port: 3000,
    strictPort: true,
  },
})
```

Create src/lib/platform.ts for platform detection:

```typescript
// src/lib/platform.ts
// Platform detection utilities for Tauri mobile apps

/**
 * Check if running inside Tauri WebView
 */
export function isTauri(): boolean {
  return typeof window !== 'undefined' && '__TAURI_INTERNALS__' in window
}

export type Platform = 'ios' | 'android' | 'web'

/**
 * Get current platform (async - requires Tauri plugin)
 */
export async function getPlatform(): Promise<Platform> {
  if (!isTauri()) return 'web'

  try {
    const { type } = await import('@tauri-apps/plugin-os')
    const osType = type()

    if (osType === 'ios') return 'ios'
    if (osType === 'android') return 'android'
    return 'web' // Desktop Tauri falls back to web behavior
  } catch {
    return 'web'
  }
}

/**
 * Check if running on mobile (iOS or Android)
 */
export async function isMobile(): Promise<boolean> {
  const platform = await getPlatform()
  return platform === 'ios' || platform === 'android'
}
```

Note: The SPA config skips TanStack Start's SSR. For the Tauri build to work, you'll need to create a minimal index.html that loads the React app. This will be handled in the iOS/Android setup plans when testing the build.
  </action>
  <verify>
1. Run `bun run build:tauri` and verify dist/ is created with index.html and assets
2. Import isTauri from platform.ts in a test file to verify types resolve
  </verify>
  <done>SPA Vite config produces static build, platform utilities export isTauri and getPlatform</done>
</task>

</tasks>

<verification>
1. `bun tauri --version` outputs 2.x.x
2. `ls src-tauri/` shows Cargo.toml, tauri.conf.json, src/lib.rs, capabilities/
3. `bun run build:tauri` produces dist/ directory with static assets
4. `grep -r "ai.astn.app" src-tauri/` finds identifier in tauri.conf.json
</verification>

<success_criteria>
- Tauri CLI installed and functional (v2.x)
- src-tauri/ directory created with proper config and Rust setup
- All required plugins listed in Cargo.toml
- vite.config.tauri.ts produces SPA build
- Platform detection utilities available at src/lib/platform.ts
- Ready for iOS and Android init in subsequent plans
</success_criteria>

<output>
After completion, create `.planning/phases/25-tauri-mobile-native-features/25-01-SUMMARY.md`
</output>
