---
phase: 25-tauri-mobile-native-features
plan: 02
type: execute
wave: 2
depends_on: ['25-01']
files_modified:
  - src-tauri/gen/apple/
  - src-tauri/Info.ios.plist
  - src-tauri/tauri.conf.json
autonomous: false
user_setup:
  - service: apple-developer
    why: 'iOS code signing and provisioning'
    env_vars: []
    dashboard_config:
      - task: 'Create Apple Developer account (if not exists)'
        location: 'https://developer.apple.com/account/'
      - task: 'Note your Team ID from Membership details'
        location: 'Apple Developer > Account > Membership'

must_haves:
  truths:
    - 'iOS project files exist in src-tauri/gen/apple/'
    - 'App builds successfully for iOS simulator'
    - 'App launches and displays web content in iOS simulator'
  artifacts:
    - path: 'src-tauri/gen/apple/'
      provides: 'Generated Xcode project for iOS'
    - path: 'src-tauri/Info.ios.plist'
      provides: 'iOS plist with biometric and push permissions'
      contains: 'NSFaceIDUsageDescription'
    - path: 'src-tauri/tauri.conf.json'
      provides: 'iOS bundle configuration'
      contains: 'developmentTeam'
  key_links:
    - from: 'src-tauri/tauri.conf.json'
      to: 'src-tauri/gen/apple/'
      via: 'iOS build configuration'
      pattern: 'bundle.*iOS'
---

<objective>
Set up iOS build environment and verify app runs in simulator

Purpose: Configure Tauri for iOS development, add required plist permissions for biometrics and push notifications, and verify the app builds and runs in iOS Simulator.

Output: Working iOS build that displays the ASTN web app in the simulator, with all permissions configured for later native feature implementation.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/25-tauri-mobile-native-features/25-RESEARCH.md
@.planning/phases/25-tauri-mobile-native-features/25-01-SUMMARY.md

@src-tauri/tauri.conf.json
@src-tauri/Cargo.toml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize iOS target and configure permissions</name>
  <files>
    src-tauri/gen/apple/
    src-tauri/Info.ios.plist
    src-tauri/tauri.conf.json
  </files>
  <action>
Run Tauri iOS initialization:
```bash
bun tauri ios init
```

This creates src-tauri/gen/apple/ with the Xcode project structure.

Create src-tauri/Info.ios.plist with required permissions:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <!-- Biometric authentication -->
    <key>NSFaceIDUsageDescription</key>
    <string>Use Face ID to quickly unlock ASTN</string>

    <!-- Push notifications -->
    <key>UIBackgroundModes</key>
    <array>
        <string>remote-notification</string>
    </array>

    <!-- Deep linking -->
    <key>CFBundleURLTypes</key>
    <array>
        <dict>
            <key>CFBundleURLSchemes</key>
            <array>
                <string>astn</string>
            </array>
            <key>CFBundleURLName</key>
            <string>ai.astn.app</string>
        </dict>
    </array>
</dict>
</plist>
```

Update src-tauri/tauri.conf.json to add iOS bundle configuration. Add to the existing config:

```json
{
  "bundle": {
    "active": true,
    "iOS": {
      "developmentTeam": "TEAM_ID_HERE"
    }
  }
}
```

Note: The TEAM_ID_HERE placeholder will be replaced by the user's Apple Developer Team ID during the checkpoint.
</action>
<verify>

1. Check src-tauri/gen/apple/ directory exists
2. Check src-tauri/Info.ios.plist contains NSFaceIDUsageDescription
3. Run `bun tauri ios build --debug` (may fail on signing, that's expected before Team ID is set)
   </verify>
   <done>iOS project initialized with permissions for biometrics, push notifications, and deep linking</done>
   </task>

<task type="auto">
  <name>Task 2: Build and run iOS simulator</name>
  <files></files>
  <action>
Build the iOS app for simulator (debug mode):

```bash
# Build frontend first
bun run build:tauri

# Build iOS for simulator
bun tauri ios build --debug
```

If the build fails due to missing Team ID, that's expected. The checkpoint will have the user configure their Team ID.

List available iOS simulators:

```bash
xcrun simctl list devices available
```

Run in simulator (will launch Xcode or use simctl):

```bash
bun tauri ios dev
```

Note: If Xcode prompts for signing, select "Automatically manage signing" with the development team.

The app should:

1. Launch in iOS Simulator
2. Show the ASTN web interface
3. Navigate correctly between routes
   </action>
   <verify>iOS Simulator shows ASTN app with web content rendering correctly</verify>
   <done>iOS app builds and runs in simulator, web content displays</done>
   </task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>iOS Tauri app that runs in simulator</what-built>
  <how-to-verify>
1. If prompted, update src-tauri/tauri.conf.json with your Apple Developer Team ID:
   - Find your Team ID at: Apple Developer > Account > Membership
   - Replace "TEAM_ID_HERE" in bundle.iOS.developmentTeam

2. Run `bun tauri ios dev` to launch the app in iOS Simulator

3. Verify in the simulator:
   - App icon appears on home screen
   - App launches without crash
   - Login page displays correctly
   - Navigation works (tap around the app)
   - Text is readable, buttons are tappable

4. If you see a blank white screen, check the Xcode console for errors
   </how-to-verify>
   <resume-signal>Type "approved" if the app runs correctly in iOS Simulator, or describe any issues encountered</resume-signal>
   </task>

</tasks>

<verification>
1. `ls src-tauri/gen/apple/` shows iOS project files
2. `grep NSFaceIDUsageDescription src-tauri/Info.ios.plist` finds the permission
3. iOS Simulator runs the app and displays content
</verification>

<success_criteria>

- src-tauri/gen/apple/ exists with Xcode project
- Info.ios.plist contains biometric and push notification permissions
- Deep link URL scheme (astn://) configured
- App successfully builds for iOS simulator
- App launches and displays ASTN web content in simulator
- User has verified app works interactively
  </success_criteria>

<output>
After completion, create `.planning/phases/25-tauri-mobile-native-features/25-02-SUMMARY.md`
</output>
