---
phase: 25-tauri-mobile-native-features
plan: 03
type: execute
wave: 2
depends_on: ["25-01"]
files_modified:
  - src-tauri/gen/android/
  - src-tauri/gen/android/app/src/main/AndroidManifest.xml
autonomous: false
user_setup:
  - service: android-sdk
    why: "Android build toolchain"
    env_vars:
      - name: ANDROID_HOME
        source: "Android SDK installation path (e.g., ~/Android/Sdk or ~/Library/Android/sdk)"
      - name: JAVA_HOME
        source: "JDK installation path (JDK 17+ required)"
    dashboard_config:
      - task: "Install Android Studio or Android SDK command-line tools"
        location: "https://developer.android.com/studio"
      - task: "Accept Android SDK licenses: sdkmanager --licenses"
        location: "Terminal after SDK install"

must_haves:
  truths:
    - "Android project files exist in src-tauri/gen/android/"
    - "App builds successfully for Android emulator"
    - "App launches and displays web content in Android emulator"
  artifacts:
    - path: "src-tauri/gen/android/"
      provides: "Generated Android Studio project"
    - path: "src-tauri/gen/android/app/src/main/AndroidManifest.xml"
      provides: "Android manifest with permissions"
      contains: "USE_BIOMETRIC"
  key_links:
    - from: "src-tauri/tauri.conf.json"
      to: "src-tauri/gen/android/"
      via: "Android build configuration"
      pattern: "identifier.*ai.astn.app"
---

<objective>
Set up Android build environment and verify app runs in emulator

Purpose: Configure Tauri for Android development, add required manifest permissions for biometrics and deep linking, and verify the app builds and runs in Android Emulator.

Output: Working Android build that displays the ASTN web app in the emulator, with all permissions configured for later native feature implementation.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/25-tauri-mobile-native-features/25-RESEARCH.md
@.planning/phases/25-tauri-mobile-native-features/25-01-SUMMARY.md

@src-tauri/tauri.conf.json
@src-tauri/Cargo.toml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize Android target and configure permissions</name>
  <files>
    src-tauri/gen/android/
    src-tauri/gen/android/app/src/main/AndroidManifest.xml
  </files>
  <action>
First, verify Android SDK environment is configured:
```bash
echo $ANDROID_HOME
echo $JAVA_HOME
```

If not set, the checkpoint will guide the user to set them up.

Run Tauri Android initialization:
```bash
bun tauri android init
```

This creates src-tauri/gen/android/ with the Android Studio project structure.

After init, update the AndroidManifest.xml at src-tauri/gen/android/app/src/main/AndroidManifest.xml to add required permissions. Add these inside the `<manifest>` tag, before `<application>`:

```xml
<!-- Biometric authentication -->
<uses-permission android:name="android.permission.USE_BIOMETRIC" />
<uses-permission android:name="android.permission.USE_FINGERPRINT" />

<!-- Internet for Convex -->
<uses-permission android:name="android.permission.INTERNET" />

<!-- Deep linking is handled by the intent-filter in the activity -->
```

Also ensure the deep link intent filter is present in the `<activity>` section (Tauri should add this based on tauri.conf.json, but verify):

```xml
<intent-filter>
    <action android:name="android.intent.action.VIEW" />
    <category android:name="android.intent.category.DEFAULT" />
    <category android:name="android.intent.category.BROWSABLE" />
    <data android:scheme="astn" />
</intent-filter>
```

Note: Tauri's deep-link plugin configuration in tauri.conf.json should auto-generate this, but verify it exists.
  </action>
  <verify>
1. Check src-tauri/gen/android/ directory exists
2. Grep for USE_BIOMETRIC in AndroidManifest.xml
3. Grep for android:scheme="astn" in AndroidManifest.xml
  </verify>
  <done>Android project initialized with biometric permission and deep link scheme</done>
</task>

<task type="auto">
  <name>Task 2: Build and run Android emulator</name>
  <files></files>
  <action>
Build the Android app for emulator (debug mode):

```bash
# Build frontend first (if not already built)
bun run build:tauri

# Build Android for emulator
bun tauri android build --debug
```

List available Android emulators:
```bash
emulator -list-avds
```

If no emulator exists, the user will need to create one via Android Studio AVD Manager.

Run in emulator:
```bash
bun tauri android dev
```

This should:
1. Start the Android emulator (or connect to running one)
2. Install the app
3. Launch the app

The app should:
1. Display the ASTN web interface
2. Navigate correctly between routes
3. Handle touch interactions properly
  </action>
  <verify>Android emulator shows ASTN app with web content rendering correctly</verify>
  <done>Android app builds and runs in emulator, web content displays</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Android Tauri app that runs in emulator</what-built>
  <how-to-verify>
1. Ensure Android SDK is configured:
   - ANDROID_HOME should point to your Android SDK (e.g., ~/Library/Android/sdk on macOS)
   - JAVA_HOME should point to JDK 17+ (e.g., from Android Studio or standalone JDK)
   - Add to your shell profile:
     ```
     export ANDROID_HOME=~/Library/Android/sdk
     export JAVA_HOME=$(/usr/libexec/java_home)
     ```

2. If you don't have an Android emulator:
   - Open Android Studio > Tools > Device Manager
   - Create a new device (recommend Pixel 6 with API 34)

3. Run `bun tauri android dev` to launch the app

4. Verify in the emulator:
   - App installs successfully
   - App launches without crash
   - Login page displays correctly
   - Navigation works (tap around the app)
   - Text is readable, buttons are tappable
   - Scrolling works smoothly

5. If you see build errors about SDK licenses:
   - Run: `$ANDROID_HOME/cmdline-tools/latest/bin/sdkmanager --licenses`
   - Accept all licenses
  </how-to-verify>
  <resume-signal>Type "approved" if the app runs correctly in Android Emulator, or describe any issues encountered</resume-signal>
</task>

</tasks>

<verification>
1. `ls src-tauri/gen/android/` shows Android project files
2. `grep USE_BIOMETRIC src-tauri/gen/android/app/src/main/AndroidManifest.xml` finds the permission
3. Android Emulator runs the app and displays content
</verification>

<success_criteria>
- src-tauri/gen/android/ exists with Android Studio project
- AndroidManifest.xml contains biometric permission
- Deep link URL scheme (astn://) configured via intent-filter
- App successfully builds for Android emulator
- App launches and displays ASTN web content in emulator
- User has verified app works interactively
</success_criteria>

<output>
After completion, create `.planning/phases/25-tauri-mobile-native-features/25-03-SUMMARY.md`
</output>
