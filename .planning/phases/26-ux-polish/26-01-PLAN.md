---
phase: 26-ux-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/formatLocation.ts
  - src/components/matches/MatchCard.tsx
  - src/components/opportunities/opportunity-card.tsx
  - src/components/layout/auth-header.tsx
autonomous: true

must_haves:
  truths:
    - "User sees location strings formatted consistently (comma-separated, not periods)"
    - "User can click anywhere on match card to navigate to detail page"
    - "User sees which page they are on via navigation highlighting"
    - "User can still unsave a match without navigating away"
  artifacts:
    - path: "src/lib/formatLocation.ts"
      provides: "Location string normalization utility"
      exports: ["formatLocation"]
    - path: "src/components/matches/MatchCard.tsx"
      provides: "Fully clickable match card"
      contains: "<Link"
    - path: "src/components/layout/auth-header.tsx"
      provides: "Navigation with active indicators"
      contains: "activeProps"
  key_links:
    - from: "src/components/matches/MatchCard.tsx"
      to: "src/lib/formatLocation.ts"
      via: "import { formatLocation }"
      pattern: "formatLocation\\("
    - from: "src/components/opportunities/opportunity-card.tsx"
      to: "src/lib/formatLocation.ts"
      via: "import { formatLocation }"
      pattern: "formatLocation\\("
---

<objective>
Fix high priority UX polish issues: location string formatting, clickable match cards, and navigation active states.

Purpose: Address the most visible and impactful issues from the UX review that affect daily usability.
Output: Location strings display consistently, entire match cards are clickable, and users can see their current page in navigation.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/review/ux-review.md
@.planning/phases/26-ux-polish/26-RESEARCH.md

# Relevant source files
@src/components/matches/MatchCard.tsx
@src/components/layout/auth-header.tsx
@src/components/opportunities/opportunity-card.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create location formatting utility</name>
  <files>src/lib/formatLocation.ts, src/components/matches/MatchCard.tsx, src/components/opportunities/opportunity-card.tsx</files>
  <action>
Create a formatLocation utility function that normalizes location strings from various API sources.

1. Create `src/lib/formatLocation.ts`:
```typescript
/**
 * Normalize location strings from various API sources.
 * Handles inconsistent separators (periods vs commas) and formatting.
 */
export function formatLocation(location: string): string {
  if (!location) return "Location not specified";

  return location
    .replace(/\.\s*/g, ", ")      // Period to comma (e.g., "San Francisco.USA" -> "San Francisco, USA")
    .replace(/,\s*,/g, ",")       // Remove double commas
    .replace(/,\s*$/g, "")        // Remove trailing comma
    .replace(/\s+/g, " ")         // Normalize whitespace
    .trim();
}
```

2. Update `src/components/matches/MatchCard.tsx`:
- Import formatLocation from ~/lib/formatLocation
- Apply to the location display in the Link's org/location line
- Change: `{match.opportunity.organization} 路 {match.opportunity.location}`
- To: `{match.opportunity.organization} 路 {formatLocation(match.opportunity.location)}`

3. Update `src/components/opportunities/opportunity-card.tsx`:
- Import formatLocation from ~/lib/formatLocation
- Apply to the location display
- Change: `{opportunity.location}`
- To: `{formatLocation(opportunity.location)}`
  </action>
  <verify>
1. Run the dev server: `bun run dev`
2. Navigate to /opportunities and verify location strings show comma separators
3. Navigate to /matches and verify location strings are consistent
4. Check TypeScript: `bun run lint` passes
  </verify>
  <done>
Location strings display with comma separators (e.g., "San Francisco, USA" not "San Francisco.USA")
  </done>
</task>

<task type="auto">
  <name>Task 2: Make MatchCard fully clickable</name>
  <files>src/components/matches/MatchCard.tsx</files>
  <action>
Restructure MatchCard so the entire card is clickable, not just the title.

Current structure (only title clickable):
```tsx
<Card className="p-4">
  <div>badges</div>
  <Link to="/matches/$id">
    <h3>title</h3>
    <p>org 路 location</p>
  </Link>
  <p>strength</p>
  <div>probability</div>
</Card>
```

New structure (entire card clickable):
```tsx
<Link to="/matches/$id" className="block">
  <Card className="p-4 hover:shadow-md cursor-pointer">
    <div>badges (including unsave button with stopPropagation)</div>
    <h3>title</h3>
    <p>org 路 location</p>
    <p>strength</p>
    <div>probability</div>
  </Card>
</Link>
```

Implementation:
1. Move the `<Link>` wrapper to encompass the entire `<Card>`
2. Add `className="block"` to the Link
3. Move the `onClick` handler that sets view-transition-name to the outer Link
4. Update the unsave button to use both `e.preventDefault()` AND `e.stopPropagation()`:
```tsx
<button
  onClick={(e) => {
    e.preventDefault();      // Prevent Link navigation
    e.stopPropagation();     // Stop event from bubbling to Link
    onUnsave();
  }}
>
```
5. Keep the h3's view-transition-name logic for morph animation
6. The h3 no longer needs to be wrapped in a separate Link
7. Remove the inner Link entirely - all content is now directly in Card

Important: Preserve the view-transition behavior:
- Keep sessionStorage.setItem(ACTIVE_MATCH_KEY, match._id) in the outer Link's onClick
- Keep the h3's style={{ viewTransitionName: "match-title" }} for back navigation
- The data-morph="strength" div should also keep its view-transition-name
  </action>
  <verify>
1. Run the dev server
2. Navigate to /matches
3. Click on the card body (not title) - should navigate to detail
4. Click on the title - should navigate with view transition morph
5. Click the unsave/saved button - should toggle save state without navigating
6. Navigate back - should see morph animation back to card
  </verify>
  <done>
- Entire match card is clickable (not just title)
- Unsave button works without navigating away
- View transition morph animation still works
  </done>
</task>

<task type="auto">
  <name>Task 3: Add navigation active state indicators</name>
  <files>src/components/layout/auth-header.tsx</files>
  <action>
Update the desktop header navigation to show a clear visual indicator for the active page.

Current implementation uses `[&.active]` CSS selector which TanStack Router applies, but there's no visible difference (just font-medium text change which is subtle).

Update the navigation Links to use `activeProps` with a visual underline indicator:

1. Update the Opportunities link:
```tsx
<Link
  to="/opportunities"
  className="text-sm text-muted-foreground hover:text-foreground transition-colors relative py-2"
  activeProps={{
    className: "text-sm text-foreground font-medium transition-colors relative py-2 after:absolute after:bottom-0 after:left-0 after:right-0 after:h-0.5 after:bg-primary after:rounded-full"
  }}
>
  Opportunities
</Link>
```

2. Update the Matches link (inside Authenticated):
```tsx
<Link
  to="/matches"
  className="text-sm text-muted-foreground hover:text-foreground transition-colors relative py-2"
  activeProps={{
    className: "text-sm text-foreground font-medium transition-colors relative py-2 after:absolute after:bottom-0 after:left-0 after:right-0 after:h-0.5 after:bg-primary after:rounded-full"
  }}
>
  Matches
</Link>
```

The `after:` pseudo-element creates an underline indicator that:
- Appears at the bottom of the link text
- Uses the primary color (will become navy after Plan 04)
- Has rounded ends for a softer look
- Is visible in both light and dark modes
  </action>
  <verify>
1. Run the dev server
2. Navigate to /opportunities - should see underline indicator
3. Navigate to /matches - indicator should move to Matches link
4. Navigate to home - neither link should have indicator
5. Toggle dark mode - indicator should remain visible
  </verify>
  <done>
- Navigation links show clear visual indicator (underline) for active page
- Indicator works in both light and dark modes
- Indicator animates smoothly between pages (via transition)
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. Location strings: No periods as separators in opportunity/match cards
2. Click on match card body navigates to detail page
3. Unsave button works without triggering navigation
4. Desktop navigation shows underline on active page
5. All view transitions still work (title morph, strength morph)
6. `bun run lint` passes with no errors
7. `bun run build` succeeds
</verification>

<success_criteria>
1. Location strings display with comma separators consistently
2. Entire match card is clickable, not just the title
3. Desktop navigation shows which page is active via underline indicator
4. No regression in existing functionality (view transitions, save/unsave)
</success_criteria>

<output>
After completion, create `.planning/phases/26-ux-polish/26-01-SUMMARY.md`
</output>
