---
phase: 28-quality-gates-bug-fixes
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .github/workflows/ci.yml
  - .husky/pre-commit
  - .env.example
  - package.json
  - package-lock.json
autonomous: true

must_haves:
  truths:
    - 'Every push and PR to main triggers GitHub Actions CI that runs lint, typecheck, build, and test'
    - 'Every git commit triggers a pre-commit hook that runs typecheck and lint-staged (eslint + prettier on staged files)'
    - 'All required environment variables are documented in .env.example with descriptions of purpose and where to get values'
    - 'Only bun.lock exists as the lockfile (package-lock.json is deleted)'
    - 'package.json has separate lint (eslint only) and typecheck (tsc --noEmit) scripts'
  artifacts:
    - path: '.github/workflows/ci.yml'
      provides: 'CI pipeline definition'
      contains: 'bun run lint'
    - path: '.husky/pre-commit'
      provides: 'Pre-commit hook'
      contains: 'lint-staged'
    - path: '.env.example'
      provides: 'Environment variable documentation'
      contains: 'VITE_CONVEX_URL'
    - path: 'package.json'
      provides: 'Updated scripts and lint-staged config'
      contains: 'lint-staged'
  key_links:
    - from: '.github/workflows/ci.yml'
      to: 'package.json scripts'
      via: 'bun run lint, bun run typecheck, bun run build'
      pattern: 'bun run (lint|typecheck|build)'
    - from: '.husky/pre-commit'
      to: 'package.json lint-staged config'
      via: 'bunx lint-staged'
      pattern: 'lint-staged'
    - from: 'package.json prepare script'
      to: 'husky'
      via: 'prepare lifecycle hook'
      pattern: '"prepare":\\s*"husky"'
---

<objective>
Set up CI pipeline and developer experience tooling so every push/PR is validated by GitHub Actions and every commit is pre-checked by husky + lint-staged.

Purpose: Establish automated quality gates that catch regressions before they reach the codebase. CI is the hard enforcement gate; pre-commit hooks are the early warning system.
Output: .github/workflows/ci.yml, .husky/pre-commit, .env.example, updated package.json, deleted package-lock.json
</objective>

<execution_context>
@/Users/luca/.claude/get-shit-done/workflows/execute-plan.md
@/Users/luca/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/28-quality-gates-bug-fixes/28-RESEARCH.md (CI workflow patterns, husky setup, lint-staged config)
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create GitHub Actions CI workflow and update package.json scripts</name>
  <files>.github/workflows/ci.yml, package.json, package-lock.json</files>
  <action>
  1. Create `.github/workflows/ci.yml` with this exact structure:
     - Triggers: `push` to `main`, `pull_request` to `main`
     - Concurrency: group by workflow + ref, cancel-in-progress: true
     - Single job `ci` on `ubuntu-latest`
     - Steps: actions/checkout@v4, oven-sh/setup-bun@v2, `bun install --frozen-lockfile`, `bun run lint`, `bun run typecheck`, `bun run build`, `bun test`
     - See 28-RESEARCH.md "GitHub Actions CI Workflow" section for exact YAML

2. Update `package.json` scripts:
   - Change `"lint"` from `"tsc && eslint .  --ext ts,tsx --report-unused-disable-directives --max-warnings 0"` to `"eslint . --report-unused-disable-directives --max-warnings 0"` (remove tsc, remove --ext flag which is deprecated in flat config)
   - Add `"typecheck": "tsc --noEmit"` script
   - Add `"prepare": "husky"` script

3. Delete `package-lock.json` from the repository root (QUAL-03). Only `bun.lock` should remain.

Note: The `--ext` flag is deprecated in eslint v9+ with flat config. If eslint.config.mjs already specifies file patterns, remove `--ext ts,tsx`. Verify by checking eslint.config.mjs.
</action>
<verify>

- `ls .github/workflows/ci.yml` confirms file exists
- `cat package.json | grep '"lint"'` shows eslint only (no tsc)
- `cat package.json | grep '"typecheck"'` shows `tsc --noEmit`
- `cat package.json | grep '"prepare"'` shows `husky`
- `ls package-lock.json 2>/dev/null` returns nothing (deleted)
- `bun run lint` passes (eslint only)
- `bun run typecheck` passes (tsc --noEmit)
  </verify>
  <done>CI workflow file exists with lint/typecheck/build/test steps. package.json has separate lint and typecheck scripts. package-lock.json is deleted.</done>
  </task>

<task type="auto">
  <name>Task 2: Install husky + lint-staged and create .env.example</name>
  <files>.husky/pre-commit, .env.example, package.json</files>
  <action>
  1. Install dev dependencies:
     ```bash
     bun add -D husky lint-staged
     ```

2. Initialize husky:

   ```bash
   bunx husky init
   ```

   This creates `.husky/` directory and adds `prepare` script to package.json (already added in Task 1, verify no duplicate).

3. Write `.husky/pre-commit` with this exact content:

   ```bash
   bun run typecheck
   bunx lint-staged
   ```

   This runs full project typecheck (~10-15s, accepted per CONTEXT.md) then lint-staged on staged files.

4. Add `lint-staged` config to `package.json` (top-level key):

   ```json
   "lint-staged": {
     "*.{ts,tsx}": [
       "eslint --fix",
       "prettier --write"
     ],
     "*.{json,md,css}": [
       "prettier --write"
     ]
   }
   ```

5. Create `.env.example` with comprehensive documentation of ALL environment variables. Include:
   - Vite client-side vars (VITE_CONVEX_URL)
   - Convex dashboard vars (ANTHROPIC_API_KEY, RESEND_API_KEY, EIGHTY_K_ALGOLIA_APP_ID, EIGHTY_K_ALGOLIA_API_KEY, AIRTABLE_TOKEN, AIRTABLE_BASE_ID, AIRTABLE_TABLE_NAME)
   - Auth vars (AUTH_GITHUB_ID, AUTH_GITHUB_SECRET, AUTH_GOOGLE_ID, AUTH_GOOGLE_SECRET)
   - Tauri-specific optional vars (VITE_GOOGLE_CLIENT_ID, VITE_GITHUB_CLIENT_ID_MOBILE, AUTH_GITHUB_ID_MOBILE, AUTH_GITHUB_SECRET_MOBILE, AUTH_REDIRECT_URI_WEB)
   - Each var has a comment explaining purpose and where to get the value
   - See 28-RESEARCH.md ".env.example Template" section for the full template
     </action>
     <verify>

- `ls .husky/pre-commit` confirms hook exists
- `cat .husky/pre-commit` shows typecheck + lint-staged
- `cat package.json | grep -A5 '"lint-staged"'` shows config
- `ls .env.example` confirms file exists
- `cat .env.example` shows all env vars with descriptions
- `cat .env.example | grep -c "="` shows 15+ env vars documented
- Test pre-commit hook: create a temp file, `git add` it, verify hook runs (optional, may fail on non-JS files)
  </verify>
  <done>Husky pre-commit hook runs typecheck + lint-staged on every commit. lint-staged config fixes and formats staged TS/TSX/JSON/MD/CSS files. .env.example documents all environment variables with descriptions.</done>
  </task>

</tasks>

<verification>
1. `bun run lint` -- eslint passes (no tsc in this command)
2. `bun run typecheck` -- tsc --noEmit passes
3. `bun run build` -- full build succeeds
4. `ls .github/workflows/ci.yml .husky/pre-commit .env.example` -- all three files exist
5. `ls package-lock.json 2>/dev/null` -- deleted, returns nothing
6. `cat package.json | grep -c '"lint-staged"'` -- config exists
7. `cat .env.example | wc -l` -- has substantial content (15+ lines)
</verification>

<success_criteria>

- GitHub Actions CI workflow exists and would run lint, typecheck, build, test on push/PR to main
- Pre-commit hook is wired and runs typecheck + lint-staged
- .env.example documents all required environment variables
- package-lock.json no longer exists (only bun.lock remains)
- package.json has separate lint and typecheck scripts
  </success_criteria>

<output>
After completion, create `.planning/phases/28-quality-gates-bug-fixes/28-01-SUMMARY.md`
</output>
