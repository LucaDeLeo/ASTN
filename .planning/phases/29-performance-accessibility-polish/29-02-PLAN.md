---
phase: 29-performance-accessibility-polish
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/auth/password-form.tsx
  - src/components/org/OrgCard.tsx
  - src/components/profile/upload/DocumentUpload.tsx
  - src/components/admin/opportunity-form.tsx
  - src/components/settings/NotificationPrefsForm.tsx
  - src/components/settings/EventNotificationPrefsForm.tsx
  - src/components/profile/wizard/steps/BasicInfoStep.tsx
  - src/components/profile/wizard/steps/EducationStep.tsx
  - src/components/profile/wizard/steps/WorkHistoryStep.tsx
  - src/components/profile/wizard/steps/GoalsStep.tsx
  - src/components/programs/CreateProgramDialog.tsx
  - src/components/engagement/OverrideDialog.tsx
  - src/components/profile/privacy/SectionVisibility.tsx
  - src/components/attendance/FeedbackForm.tsx
autonomous: true

must_haves:
  truths:
    - 'Password sign-up form shows a real-time checklist with check/X indicators for each rule (8+ chars, lowercase, uppercase, number) that updates as the user types'
    - 'OrgCard whole card area is keyboard-focusable and activatable with Enter key (single tab stop)'
    - 'DocumentUpload drag-active and drag-reject states show icon/text indicators alongside color changes'
    - 'All data-entry form components have aria-describedby linking error messages to their inputs, and aria-invalid on errored fields'
    - "Error messages rendered with role='alert' for screen reader announcement"
  artifacts:
    - path: 'src/components/auth/password-form.tsx'
      provides: 'Inline password validation checklist with real-time feedback'
      contains: 'PASSWORD_RULES'
    - path: 'src/components/org/OrgCard.tsx'
      provides: 'Keyboard-accessible card with single tab stop'
      contains: 'onKeyDown'
    - path: 'src/components/profile/upload/DocumentUpload.tsx'
      provides: 'Non-color drag state indicators'
      contains: 'aria-label'
  key_links:
    - from: 'src/components/auth/password-form.tsx'
      to: 'convex/auth.ts'
      via: 'PASSWORD_RULES must mirror server-side validatePasswordRequirements'
      pattern: "length >= 8.*[a-z].*[A-Z].*\\d"
    - from: 'src/components/org/OrgCard.tsx'
      to: '/org/$slug route'
      via: 'Enter key navigates to org page using router'
      pattern: "useNavigate|router\\.navigate|Link"
---

<objective>
Make all interactive elements keyboard-accessible with proper ARIA attributes, add inline password validation, and ensure drag state changes use non-color indicators.

Purpose: Meet WCAG 2.1 accessibility requirements so keyboard-only and screen-reader users can fully navigate the ASTN application before the BAISH pilot.

Output: Accessible form components with aria-describedby, keyboard-navigable org cards, inline password checklist, and non-color drag state indicators.
</objective>

<execution_context>
@/Users/luca/.claude/get-shit-done/workflows/execute-plan.md
@/Users/luca/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/29-performance-accessibility-polish/29-CONTEXT.md
@.planning/phases/29-performance-accessibility-polish/29-RESEARCH.md

@src/components/auth/password-form.tsx
@src/components/org/OrgCard.tsx
@src/components/profile/upload/DocumentUpload.tsx
@convex/auth.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Password inline validation, OrgCard keyboard, and drag state indicators</name>
  <files>
    src/components/auth/password-form.tsx
    src/components/org/OrgCard.tsx
    src/components/profile/upload/DocumentUpload.tsx
  </files>
  <action>
**src/components/auth/password-form.tsx** - Add inline password validation checklist (A11Y-03):

1. Add controlled state for the password field: `const [password, setPassword] = useState("")`. The password Input needs an `onChange` handler that updates this state AND still works with the form submission (keep `name="password"` so FormData captures it).

2. Define `PASSWORD_RULES` array mirroring the server-side rules in `convex/auth.ts`:

   ```
   const PASSWORD_RULES = [
     { key: "length", label: "At least 8 characters", test: (p: string) => p.length >= 8 },
     { key: "lower", label: "A lowercase letter", test: (p: string) => /[a-z]/.test(p) },
     { key: "upper", label: "An uppercase letter", test: (p: string) => /[A-Z]/.test(p) },
     { key: "number", label: "A number", test: (p: string) => /\d/.test(p) },
   ]
   ```

3. Create a `PasswordChecklist` component that renders below the password input when `flow === "signUp"` AND `password.length > 0` (don't show checklist for empty field or sign-in flow). Each rule shows:
   - A `Check` icon (lucide-react, `size-4 text-green-600`) with `aria-hidden="true"` when passing
   - An `X` icon (lucide-react, `size-4 text-muted-foreground`) with `aria-hidden="true"` when failing
   - Rule label text with appropriate color (`text-green-700` when passing, `text-muted-foreground` when failing)
   - Wrap in `<ul aria-label="Password requirements">` with `<li>` items

4. Replace the static hint text ("8+ characters, mixed case, and a number") with the `PasswordChecklist` component when password is non-empty. Keep the static hint visible when password field is empty (as a pre-interaction hint).

5. Add `aria-describedby` and `aria-invalid` to both email and password inputs. Use `useId()` from React to generate stable IDs. The error message `<p>` should have `role="alert"` and an `id` that the inputs reference via `aria-describedby`.

6. Import `{ Check, X }` from `lucide-react` and `{ useId }` from `react`.

**src/components/org/OrgCard.tsx** - Make whole card keyboard-accessible (A11Y-01):

The current OrgCard is a Card with a Button>Link at the bottom. The whole card should be a single tab stop that navigates on Enter.

1. Wrap the Card in a clickable container or make the Card itself clickable. Best approach: use `useNavigate` from `@tanstack/react-router` and add `onClick` and `onKeyDown` handlers to the Card element.

2. Add to the Card: `role="link"`, `tabIndex={0}`, `onClick={() => navigate({ to: '/org/$slug', params: { slug } })}`, `onKeyDown={(e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); navigate({ to: '/org/$slug', params: { slug } }) } }}`.

3. Add `aria-label={org.name}` to the Card for screen readers.

4. Add `cursor-pointer hover:shadow-md transition-shadow` to the Card className for visual affordance.

5. Keep the existing "View Organization" Button/Link but add `tabIndex={-1}` to it so it's NOT a separate tab stop (the card itself is the tab stop). The button is still visible but pressing Tab skips it since the card handles navigation.

6. Import `useNavigate` from `@tanstack/react-router`.

**src/components/profile/upload/DocumentUpload.tsx** - Non-color drag state indicators (A11Y-04):

Currently, drag states use color-only indicators (border color changes, background color changes). WCAG 1.4.1 requires non-color indicators alongside color.

1. When `isDragActive && !isDragReject`: The overlay already shows a Sparkles icon and "Drop it here!" text. This satisfies the non-color requirement for the active state. Verify the text is visible and add `role="status"` to the overlay container.

2. When `isDragReject`: The overlay already shows an X icon and "PDF files only" text. This satisfies the non-color requirement. Add `role="alert"` to the reject overlay container.

3. For the idle state with `displayError`: the error message already has an AlertCircle icon and text. Add `role="alert"` to the error message container div.

4. Add `aria-label="File upload drop zone"` to the dropzone root div (the one with `{...getRootProps()}`).

5. During drag-active state, add a text-based status alongside the border change. Currently the overlay handles this. Ensure the border change is not the ONLY indicator by verifying the overlay with icon+text is always shown during drag states.
   </action>
   <verify>
   Run `bun run lint` and `bun run build` -- both should pass. Verify:

- `grep 'PASSWORD_RULES' src/components/auth/password-form.tsx` returns results
- `grep 'onKeyDown' src/components/org/OrgCard.tsx` returns results
- `grep 'role="alert"\|role="status"' src/components/profile/upload/DocumentUpload.tsx` returns results
- `grep 'aria-describedby' src/components/auth/password-form.tsx` returns results
  </verify>
  <done>
  Password form shows a real-time checklist during sign-up with check/X indicators per rule. OrgCard is a single keyboard tab stop activated by Enter key. DocumentUpload drag states use icon+text indicators alongside color changes, with ARIA roles for screen reader announcement.
  </done>
  </task>

<task type="auto">
  <name>Task 2: Form aria-describedby across data-entry components</name>
  <files>
    src/components/admin/opportunity-form.tsx
    src/components/settings/NotificationPrefsForm.tsx
    src/components/settings/EventNotificationPrefsForm.tsx
    src/components/profile/wizard/steps/BasicInfoStep.tsx
    src/components/profile/wizard/steps/EducationStep.tsx
    src/components/profile/wizard/steps/WorkHistoryStep.tsx
    src/components/profile/wizard/steps/GoalsStep.tsx
    src/components/programs/CreateProgramDialog.tsx
    src/components/engagement/OverrideDialog.tsx
    src/components/profile/privacy/SectionVisibility.tsx
    src/components/attendance/FeedbackForm.tsx
  </files>
  <action>
Add `aria-describedby` and `aria-invalid` to all form Input, Textarea, and Select elements across data-entry components. This is a mechanical pattern applied consistently:

**Pattern for each form field:**

For fields that have inline validation errors (error state visible):

1. Generate a stable ID using `useId()` from React (one `useId()` call per component, then derive field-specific IDs like `${id}-fieldname-error`)
2. Add `id={errorId}` to the error message element (the `<p>` or `<span>` showing the error)
3. Add `aria-describedby={hasError ? errorId : undefined}` to the corresponding Input/Textarea/Select
4. Add `aria-invalid={!!hasError}` to the corresponding Input/Textarea/Select
5. Add `role="alert"` to error message elements so screen readers announce them immediately

For fields that have help text but no error state:

1. Add `id={helpId}` to the help text element
2. Add `aria-describedby={helpId}` to the corresponding Input

**Files and their form fields:**

1. **src/components/admin/opportunity-form.tsx** - Has ~19 Input/Textarea/Select elements for creating/editing opportunities. This is a large form. Use a single `useId()` and derive per-field error IDs. Many fields may not currently display validation errors -- for those, add aria-describedby pointing to any existing help text, or omit if no description exists.

2. **src/components/settings/NotificationPrefsForm.tsx** - Has Select elements for notification preferences. Add aria-describedby to selects that have labels.

3. **src/components/settings/EventNotificationPrefsForm.tsx** - Similar to above. Add aria-describedby to form controls.

4. **src/components/profile/wizard/steps/BasicInfoStep.tsx** - Profile wizard step with 4 inputs. Add aria-describedby for any validation messages and help text.

5. **src/components/profile/wizard/steps/EducationStep.tsx** - Has 5 inputs per education entry. Add aria-describedby for validation.

6. **src/components/profile/wizard/steps/WorkHistoryStep.tsx** - Has 5 inputs per work entry. Same pattern.

7. **src/components/profile/wizard/steps/GoalsStep.tsx** - Has 2 main inputs. Add aria-describedby.

8. **src/components/programs/CreateProgramDialog.tsx** - Program creation form. Add aria-describedby to all inputs.

9. **src/components/engagement/OverrideDialog.tsx** - Has 6 form controls. Add aria-describedby.

10. **src/components/profile/privacy/SectionVisibility.tsx** - Has Select controls. Add aria-describedby to any with labels.

11. **src/components/attendance/FeedbackForm.tsx** - Has a Textarea. Add aria-describedby.

**Important:**

- Conditionally set `aria-describedby` only when the referenced element exists in the DOM. Never point to an ID that isn't rendered (per research pitfall #3).
- Use `useId()` from React 19 -- do NOT use `Math.random()` or manual counters.
- Do NOT touch filter components (OrgFilters, MemberFilters, opportunity-filters, mobile-filters) -- these have no validation errors and are deferred per research recommendation.
- If a component already uses `useId()`, reuse the existing one for deriving field IDs.
  </action>
  <verify>
  Run `bun run lint` and `bun run build` -- both should pass. Verify:
- `grep -r 'aria-describedby' src/components/` returns results in at least 10 files
- `grep -r 'aria-invalid' src/components/` returns results in at least 5 files
- `grep -r 'useId' src/components/` returns results (React 19 useId being used)
- `grep -r 'role="alert"' src/components/` returns results in form error elements
  </verify>
  <done>
  All data-entry form components have aria-describedby linking error messages and help text to their inputs. aria-invalid is set on fields with errors. Error messages use role="alert" for screen reader announcement. Filter components are excluded (no validation errors).
  </done>
  </task>

</tasks>

<verification>
1. `bun run lint` passes with no errors
2. `bun run build` succeeds
3. Password checklist appears during sign-up with real-time check/X updates as user types
4. OrgCard responds to Enter key navigation (single tab stop)
5. DocumentUpload drag states have non-color indicators (icon + text)
6. At least 10 component files contain `aria-describedby` attributes
7. No `aria-describedby` points to a non-existent DOM element (conditional rendering check)
</verification>

<success_criteria>

- Password sign-up flow shows interactive checklist mirroring server-side rules
- OrgCard is keyboard-navigable as a single tab stop with Enter activation
- Drag-and-drop states use icon+text alongside color for WCAG 1.4.1 compliance
- All data-entry form fields have programmatic error/help text association via aria-describedby
- All changes typecheck and lint cleanly
  </success_criteria>

<output>
After completion, create `.planning/phases/29-performance-accessibility-polish/29-02-SUMMARY.md`
</output>
