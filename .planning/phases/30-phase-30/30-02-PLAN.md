# Plan 30-02: Frontend — Application Form, Status Page, Admin Review Queue

## Goal

Build the frontend pages for org application submission, applicant status checking, and platform admin review queue. Follows existing codebase patterns: TanStack Router file-based routing, Convex React hooks, shadcn/ui components, useState forms.

## Dependencies

- **30-01** must be complete (schema + backend functions required)

## Tasks

### Task 1: Create application form page

**File:** `src/routes/apply/index.tsx`

Route: `/apply`

Page structure:
- Public page (visible to all, but submission requires auth)
- Use `AuthHeader` component for consistent navigation
- Centered form layout (max-w-2xl), matching existing form patterns
- GradientBg background for visual consistency

Form fields (all `useState`):
- `orgName` (required) — text input, "Organization Name"
- `description` (required) — textarea, "Brief description of your organization"
- `city` (required) — text input, "City"
- `country` (required) — text input, "Country"
- `website` (optional) — text input, "Website URL"
- `reasonForJoining` (required) — textarea, "Why do you want to join ASTN?"
- `applicantName` (required) — text input, "Your Name" (pre-fill from profile if available)
- `applicantEmail` (required) — text input, "Your Email" (pre-fill from auth)

Submit button:
- If not authenticated: show "Sign in to submit" that triggers auth flow
- If authenticated: "Submit Application" button
- Use `useMutation` + `useConvexMutation` pattern (matching admin.ts pattern)
- On success: toast "Application submitted!" and redirect to `/apply/status`
- On error (duplicate): show error toast with the message from backend

Use `Authenticated`/`Unauthenticated` from `convex/react` for conditional rendering.

Pre-fill pattern: query `api.profiles.getMyProfile` (skip if unauthenticated) to pre-fill name. Use Convex auth to get email.

### Task 2: Create application status page

**File:** `src/routes/apply/status.tsx`

Route: `/apply/status`

Page structure:
- Protected page (requires auth) — use `Authenticated`/`Unauthenticated`/`AuthLoading` pattern from admin route.tsx
- `AuthHeader` + GradientBg
- Heading: "Your Applications"

Content:
- Query `api.orgApplications.getMyApplications`
- If no applications: empty state card with icon, "No applications yet", link to `/apply`
- If applications exist: list as cards, each showing:
  - Org name (bold heading)
  - Status badge: pending (yellow/outline), approved (green/default), rejected (red/destructive), withdrawn (gray/secondary)
  - Submitted date (formatted with `date-fns` `formatDistanceToNow`)
  - If rejected: show rejection reason in a muted text block
  - If approved: show "Configure your organization" link (to `/org/$slug/admin`)
  - If pending: show "Withdraw" button (confirm dialog, calls `withdraw` mutation)

### Task 3: Create apply route layout

**File:** `src/routes/apply/route.tsx`

Simple layout wrapper:
- Uses `Outlet` from TanStack Router
- No special layout needed (each page handles its own auth/layout)
- Just `createFileRoute('/apply')` with component rendering `<Outlet />`

### Task 4: Create admin applications review page

**File:** `src/routes/admin/applications/index.tsx`

Route: `/admin/applications`

Page structure:
- Protected by admin layout (already requires auth)
- Additional platform admin check: query `api.orgApplications.checkPlatformAdmin`
- If not platform admin: show "Platform Admin Access Required" message (matching existing "Admin Access Required" pattern from org admin)

Review queue:
- Status filter tabs: All | Pending | Approved | Rejected (using Button group or Tabs component)
- Default to "Pending" tab
- Query `api.orgApplications.listAll` with status filter

**Desktop (md+): Table layout**
Table columns: Org Name | Applicant | City/Country | Submitted | Status | Actions

**Mobile: Card list**
Card showing: org name, applicant, location, date, status badge, action buttons

Action buttons (for pending items):
- "Approve" button (primary/green) — calls `approve` mutation, shows success toast
- "Reject" button (destructive) — opens reject dialog

Pagination: client-side, 25 per page, matching member list pagination pattern.

### Task 5: Create rejection reason dialog component

**File:** `src/components/admin/RejectApplicationDialog.tsx`

Props: `open`, `onOpenChange`, `applicationId`, `orgName`

Uses shadcn `Dialog` + `DialogContent` + `DialogHeader` + `DialogFooter`:
- Title: "Reject Application"
- Description: "Rejecting application from {orgName}"
- Textarea: "Reason for rejection" (required, min length validation)
- Cancel button + "Reject Application" button (destructive variant)
- On submit: call `reject` mutation, close dialog, show toast

### Task 6: Update admin layout with Applications nav link

**File:** `src/routes/admin/route.tsx`

Add "Applications" link to the nav in the admin header:
```tsx
<Link
  to="/admin/applications"
  className="text-sm text-muted-foreground hover:text-foreground"
  activeProps={{
    className: 'text-sm text-foreground font-medium',
  }}
>
  Applications
</Link>
```

### Task 7: Update admin dashboard with Applications card

**File:** `src/routes/admin/index.tsx`

Add a second card linking to `/admin/applications`:
```tsx
<Link to="/admin/applications">
  <Card className="hover:shadow-md transition-shadow cursor-pointer">
    <CardHeader>
      <CardTitle className="text-lg">Org Applications</CardTitle>
    </CardHeader>
    <CardContent>
      <p className="text-sm text-slate-600">
        Review and approve organization applications to join ASTN.
      </p>
    </CardContent>
  </Card>
</Link>
```

### Task 8: Create admin applications route layout

**File:** `src/routes/admin/applications/route.tsx`

Simple passthrough layout:
```tsx
import { Outlet, createFileRoute } from '@tanstack/react-router'

export const Route = createFileRoute('/admin/applications')({
  component: () => <Outlet />,
})
```

## Acceptance Criteria

- [ ] `/apply` page renders a form that validates required fields and submits to the backend
- [ ] Duplicate org name shows a clear error toast from the backend rejection
- [ ] `/apply/status` shows all of the current user's applications with correct status badges
- [ ] Approved applications link to the org admin page
- [ ] Pending applications can be withdrawn
- [ ] Rejected applications show the rejection reason
- [ ] `/admin/applications` shows a review queue with status filter tabs (defaulting to Pending)
- [ ] Platform admin check prevents non-admins from seeing the review queue
- [ ] Approve action creates the org and shows success feedback
- [ ] Reject action requires a reason and shows the reason to the applicant on their status page
- [ ] Admin layout nav includes "Applications" link
- [ ] Admin dashboard includes "Org Applications" card
- [ ] Mobile and desktop layouts are both functional (card list on mobile, table on desktop for review queue)
