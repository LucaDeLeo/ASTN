# Plan 31-02: Frontend — Org Setup Wizard, Onboarding Checklist, Space Configuration

## Goal

Build the frontend pages for org self-configuration (logo, description, invite link) and co-working space definition (capacity, hours, custom guest fields). Includes a progressive onboarding checklist that guides new org admins through setup.

## Dependencies

- **31-01** must be complete (schema + backend functions required)

## Tasks

### Task 1: Create org setup page

**File:** `src/routes/org/$slug/admin/setup.tsx`

Route: `/org/$slug/admin/setup`

Single-page sectioned form matching the existing settings.tsx pattern. Follow the standard admin page structure:
1. Loading state (skeleton)
2. Org not found state
3. Not an admin state (Shield icon)
4. Main content

Data fetching:
```tsx
const org = useQuery(api.orgs.directory.getOrgBySlug, { slug })
const membership = useQuery(
  api.orgs.membership.getMembership,
  org ? { orgId: org._id } : 'skip',
)
const orgProfile = useQuery(
  api.orgs.admin.getOrgProfile,
  org && membership?.role === 'admin' ? { orgId: org._id } : 'skip',
)
const inviteLinks = useQuery(
  api.orgs.admin.getInviteLinks,
  org && membership?.role === 'admin' ? { orgId: org._id } : 'skip',
)
```

**Section 1: Logo Upload**
- Current logo preview (if exists) with circular crop preview
- "Upload Logo" button using file input (accept `image/*`)
- Upload flow: call `generateUploadUrl`, upload to returned URL, then call `saveOrgLogo` with storageId
- "Remove Logo" button (if logo exists) calling `removeOrgLogo`
- Max file size: 5MB, validated client-side before upload
- Show uploading state with spinner

**Section 2: Organization Details** (separated by `border-t pt-4 mt-4`)
- Description textarea (pre-filled from `orgProfile.description`)
- Contact email input (pre-filled from `orgProfile.contactEmail`)
- Website URL input (pre-filled from `orgProfile.website`)
- "Save Details" button calling `updateOrgProfile`
- Each field uses `useState`, populated via `useEffect` when `orgProfile` loads

**Section 3: Social Links** (separated by `border-t pt-4 mt-4`)
- Dynamic list of { platform (select), url (input) } pairs
- Platform options: "Twitter/X", "LinkedIn", "GitHub", "Discord", "Other"
- "Add Link" button to add a new pair
- Remove button (X icon) on each link
- "Save Social Links" button calling `updateOrgProfile` with socialLinks array

**Section 4: Invite Link & Bulk Invite** (separated by `border-t pt-4 mt-4`)

Sub-section A — Invite Link:
- If active invite link exists: show the full URL in a read-only input with a "Copy" button
  - URL format: `${window.location.origin}/org/${slug}/join?token=${token}` (matches existing `/org/$slug/join.tsx` route)
  - Copy uses `navigator.clipboard.writeText`, toast "Link copied!"
- If no active invite link: "Create Invite Link" button calling `createInviteLink`

Sub-section B — Bulk Invite (ORGON-09):
- Textarea labeled "Invite Members by Email" with placeholder "Enter email addresses, one per line"
- Admin enters multiple email addresses (one per line or comma-separated)
- "Generate Invite Message" button:
  - Calls `getOrCreateInviteLink` to ensure an active link exists
  - Parses and validates email addresses (basic email format check)
  - Shows validation errors for malformed emails
  - On success, generates a pre-formatted message in a read-only textarea:
    ```
    You've been invited to join {orgName} on ASTN!

    Click the link below to create your account and join:
    {inviteUrl}
    ```
  - "Copy Message" button to copy the generated text
  - Helper text: "Copy this message and send it to your members via email, Slack, or any other channel."
- This approach satisfies ORGON-09 without requiring an email service

**Breadcrumb:** `{org.name} / Admin / Setup`

### Task 2: Onboarding checklist component

**File:** `src/components/org/OnboardingChecklist.tsx`

Props: `orgId: Id<'organizations'>`, `orgSlug: string`

Uses `useQuery(api.orgs.admin.getOnboardingProgress, { orgId })`.

Renders a Card with:
- CardHeader: "Getting Started" title with progress indicator (e.g., "3 of 5 complete")
- Progress bar (simple div with width percentage, bg-coral-500/bg-primary)
- CardContent: list of checklist items
  - Each item: checkbox icon (CheckCircle2 filled green if complete, Circle outline if incomplete) + label text
  - Incomplete items are clickable links:
    - Items with `route: 'setup'` link to `/org/$slug/admin/setup`
    - Items with `route: 'space'` link to `/org/$slug/admin/space`
  - Completed items show muted text

When `isComplete` is true, show a success variant with a celebration message: "Setup complete! Your organization is ready."

### Task 3: Integrate onboarding checklist into admin dashboard

**File:** `src/routes/org/$slug/admin/index.tsx`

Add the OnboardingChecklist component to the admin dashboard page:
- Import and render `<OnboardingChecklist orgId={org._id} orgSlug={slug} />` at the top of the page content, before the existing stats cards
- Only show the checklist if `getOnboardingProgress` returns `isComplete: false` (hide it once all steps are done)
- Add "Setup" link to the quick actions grid (Building2 icon or Settings icon), linking to `/org/$slug/admin/setup`
- Add "Co-working Space" link to the quick actions grid (MapPin icon), linking to `/org/$slug/admin/space`

### Task 4: Create space configuration page

**File:** `src/routes/org/$slug/admin/space.tsx`

Route: `/org/$slug/admin/space`

Same admin page shell pattern (loading, not found, not admin states).

Data fetching:
```tsx
const space = useQuery(
  api.coworkingSpaces.getSpaceByOrg,
  org && membership?.role === 'admin' ? { orgId: org._id } : 'skip',
)
```

**If no space exists:** Show a "Set Up Co-working Space" card with:
- Brief description: "Configure your co-working space so members can book daily spots."
- Form fields for initial creation:
  - Name (text input, e.g., "Main Space")
  - Capacity (number input, minimum 1)
  - Timezone (searchable combobox — see Task 5)
  - Operating hours (OperatingHoursEditor — see Task 5)
  - Guest access toggle (Switch component, default off)
- "Create Space" button calling `createSpace`

**If space exists:** Show the existing configuration in editable form:
- Same fields as creation, pre-filled with current values
- "Save Changes" button calling `updateSpace`
- "Delete Space" button (destructive, with confirmation dialog)

Below the main space config, a separate section for **Custom Visit Application Fields**:
- VisitFieldsEditor component (see Task 6)
- "Save Fields" button calling `updateCustomVisitFields`
- Only visible when `guestAccessEnabled` is true

**Breadcrumb:** `{org.name} / Admin / Co-working Space`

### Task 5: Operating hours editor and timezone selector

**File:** `src/components/org/OperatingHoursEditor.tsx`

Props:
```tsx
{
  value: Array<{ dayOfWeek: number; openMinutes: number; closeMinutes: number; isClosed: boolean }>
  onChange: (hours: Array<...>) => void
}
```

Layout: Table/grid with 7 rows (Monday through Sunday, displayed Mon-first for UX).

Each row:
- Day name label (Mon, Tue, Wed, Thu, Fri, Sat, Sun)
- "Closed" toggle (Switch component) — when on, disables the time inputs
- Open time: Select with 30-minute increments (6:00 AM through 12:00 PM). Display as HH:MM AM/PM, store as minutes-from-midnight.
- Close time: Same select, must be after open time
- Visual: closed rows show muted/disabled style

Convenience features:
- "Copy to all weekdays" button — applies Monday's hours to Mon-Fri
- "Copy to all days" button — applies Monday's hours to all 7 days

Default values (for new space creation):
- Mon-Fri: 9:00 AM (540) to 6:00 PM (1080), open
- Sat-Sun: closed

**File:** `src/components/org/TimezoneSelector.tsx`

Props: `value: string`, `onChange: (tz: string) => void`

Implementation:
- Uses `Intl.supportedValuesOf('timeZone')` to get all IANA timezone strings
- Renders a shadcn Popover + Command (combobox pattern) with search input
- Shows selected timezone with its current UTC offset (e.g., "America/Argentina/Buenos_Aires (UTC-3)")
- Auto-detects browser timezone via `Intl.DateTimeFormat().resolvedOptions().timeZone` as default
- Search filters by timezone name

### Task 6: Custom visit fields editor

**File:** `src/components/org/VisitFieldsEditor.tsx`

Props:
```tsx
{
  value: Array<{
    fieldId: string
    label: string
    type: 'text' | 'textarea' | 'select' | 'checkbox'
    required: boolean
    options?: string[]
    placeholder?: string
  }>
  onChange: (fields: Array<...>) => void
}
```

Layout: Vertical list of field editor cards, plus an "Add Field" button at the bottom.

Each field card:
- Drag handle (optional — can skip for v1, just use up/down buttons)
- Label input (text, "Field Label")
- Type select (text, textarea, select, checkbox)
- Required toggle (Switch)
- Placeholder input (optional, for text/textarea types)
- If type is `select`: options editor
  - List of option strings with remove buttons
  - "Add Option" button
- Remove field button (Trash icon, destructive)

The `fieldId` is auto-generated from the label (slugified) when creating a new field. If the admin changes the label, the fieldId stays the same (to preserve data continuity with Phase 33).

"Add Field" button:
- Generates a new field with `fieldId: crypto.randomUUID()`, `label: ''`, `type: 'text'`, `required: false`

## Acceptance Criteria

- [ ] `/org/$slug/admin/setup` renders a single-page form with logo upload, org details, social links, and invite link sections
- [ ] Logo upload works end-to-end: file picker → upload to Convex storage → display preview
- [ ] Logo can be removed with the remove button
- [ ] Org details (description, contact email, website) can be saved and load from existing data
- [ ] Social links can be added, removed, and saved as an array
- [ ] Invite link section shows the current active link with a copy button, or a create button if none exists
- [ ] Bulk invite textarea accepts multiple email addresses, validates them, and generates a copyable invite message
- [ ] Onboarding checklist shows on the admin dashboard with progress bar and linked incomplete items
- [ ] Checklist hides when all steps are complete
- [ ] `/org/$slug/admin/space` allows creating a new co-working space with name, capacity, timezone, and operating hours
- [ ] Existing space configuration can be edited and saved
- [ ] Operating hours editor shows 7 days with time selects and closed toggles
- [ ] "Copy to weekdays" and "Copy to all" convenience buttons work correctly
- [ ] Timezone selector shows a searchable list and auto-detects the browser's timezone
- [ ] Custom visit fields editor allows adding, removing, and configuring fields with type-specific options
- [ ] Custom visit fields section only appears when guest access is enabled
- [ ] Admin dashboard has navigation links to Setup and Co-working Space pages
- [ ] All pages follow existing admin page patterns (loading states, auth checks, breadcrumbs, responsive layout)
