---
phase: 32-member-booking
plan: 02
type: execute
wave: 2
depends_on: ['32-01']
files_modified:
  - package.json
  - src/routes/org/$slug/space/index.tsx
  - src/routes/org/$slug/space/bookings.tsx
  - src/components/space/BookingCalendar.tsx
  - src/components/space/AttendeeList.tsx
  - src/components/space/TimeRangePicker.tsx
autonomous: true

must_haves:
  truths:
    - 'Member can pick a date from a calendar showing per-day availability indicators'
    - 'Member can select flexible hours via time range picker'
    - 'Member sees soft capacity warning without being blocked from booking'
    - 'Member can view their upcoming bookings and cancel any of them'
    - 'Member can add/edit workingOn and interestedInMeeting tags'
    - 'Member can see list of other attendees for the same day with profile previews'
    - 'Consent checkbox is required before booking'
  artifacts:
    - path: 'src/routes/org/$slug/space/index.tsx'
      provides: 'Main booking page with calendar, time picker, attendee preview, booking form'
      min_lines: 150
    - path: 'src/routes/org/$slug/space/bookings.tsx'
      provides: 'My bookings page with cancel and edit tags'
      min_lines: 100
    - path: 'src/components/space/BookingCalendar.tsx'
      provides: 'react-day-picker calendar with availability indicators'
      min_lines: 80
    - path: 'src/components/space/AttendeeList.tsx'
      provides: 'List of consented attendees with profile previews'
      min_lines: 50
  key_links:
    - from: 'src/routes/org/$slug/space/index.tsx'
      to: 'convex/spaceBookings.ts'
      via: 'useQuery and useMutation hooks'
      pattern: "useMutation\\(api\\.spaceBookings\\.createMemberBooking\\)"
    - from: 'src/components/space/BookingCalendar.tsx'
      to: 'convex/spaceBookings.ts'
      via: 'capacity query for availability'
      pattern: "useQuery\\(api\\.spaceBookings\\.getCapacityForDateRange"
---

<objective>
Create the frontend for member booking: space page with calendar date picker showing availability, flexible time selection, capacity warnings, consent checkbox, attendee preview, and a "My Bookings" page to view/cancel bookings and edit tags.

Purpose: Completes Phase 32 requirements COWRK-02 through COWRK-08 with full UI.

Output:

- react-day-picker installed
- Space booking page at /org/$slug/space
- My bookings page at /org/$slug/space/bookings
- Reusable calendar and attendee list components
  </objective>

<execution_context>
@/Users/luca/.claude/get-shit-done/workflows/execute-plan.md
@/Users/luca/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/32-phase-32/CONTEXT.md

# Prior plan for backend

@.planning/phases/32-phase-32/32-01-SUMMARY.md

# Existing org routes for patterns

@src/routes/org/$slug/events.tsx
@src/routes/org/$slug/admin/space.tsx

# Component patterns

@src/components/org/OperatingHoursEditor.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install react-day-picker and create BookingCalendar component</name>
  <files>package.json, src/components/space/BookingCalendar.tsx</files>
  <action>
**Install dependency:**
```bash
cd /Users/luca/conductor/workspaces/ASTN/spokane && bun add react-day-picker
```

**Create src/components/space/BookingCalendar.tsx:**

A calendar component using react-day-picker with custom day rendering for availability.

Props:

- `selectedDate: Date | undefined`
- `onSelectDate: (date: Date | undefined) => void`
- `capacityData: { capacity: number, dates: Record<string, { count: number, status: 'available' | 'nearing' | 'at_capacity' }> } | undefined`
- `operatingHours: Array<{ dayOfWeek: number, isClosed: boolean, ... }>` (to disable closed days)

Implementation:

- Use `DayPicker` from react-day-picker with mode="single"
- Import styles: `import 'react-day-picker/style.css'` (or use custom Tailwind)
- Disable past dates: `disabled={{ before: new Date() }}`
- Disable days where space is closed (check operatingHours for isClosed by dayOfWeek)
- Custom day content using `components={{ DayContent }}`:
  - Show colored dot indicator based on capacity status
  - Green dot (bg-green-500): 'available' or no data
  - Yellow dot (bg-yellow-500): 'nearing'
  - Red dot (bg-red-500): 'at_capacity'
- Style with Tailwind classes matching existing UI (shadcn patterns)

Use date-fns for date formatting (already in codebase: format, startOfMonth, endOfMonth, addMonths, etc.).
</action>
<verify>Component file exists and imports compile: `bun run lint` passes.</verify>
<done>react-day-picker installed, BookingCalendar component renders with availability indicators.</done>
</task>

<task type="auto">
  <name>Task 2: Create space booking page at /org/$slug/space</name>
  <files>src/routes/org/$slug/space/index.tsx, src/components/space/TimeRangePicker.tsx, src/components/space/AttendeeList.tsx</files>
  <action>
**Create src/components/space/TimeRangePicker.tsx:**
- Props: startMinutes, endMinutes, onChange, operatingHours (for the selected day)
- Two time selects (start, end) with 30-minute increments
- Options generated from operating hours for the day (if closed, show nothing)
- Format display as "10:00 AM", "10:30 AM", etc.
- Validate end > start on change

**Create src/components/space/AttendeeList.tsx:**

- Props: `attendees: Array<{ bookingId, userId, workingOn, interestedInMeeting, profile: { name, headline, skills } | null }>`
- Render card/list for each attendee showing:
  - Name and headline
  - Skills as small badges (max 5)
  - workingOn and interestedInMeeting tags if present
- Empty state: "No one else booked yet"

**Create src/routes/org/$slug/space/index.tsx:**

Follow the three-query cascade pattern from existing org routes:

1. Query org by slug
2. Query membership for current user
3. Query space by orgId (using getSpaceByOrgPublic)

Page layout:

1. **Header**: Space name, brief info, link to "My Bookings"
2. **Calendar section**: BookingCalendar component with capacity data
   - Query: `getCapacityForDateRange(spaceId, startDate, endDate)` where range is current month + next month
   - Update range when calendar month changes
3. **When date selected**, show:
   - Date display (formatted nicely)
   - Capacity indicator: "{X} / {capacity} booked" with color coding
   - Warning banner if nearing/at capacity (yellow/red background, but NOT blocking)
   - TimeRangePicker for start/end times (default to space's open/close for that day)
   - workingOn textarea (optional, 140 char limit, helper text)
   - interestedInMeeting textarea (optional, 140 char limit, helper text)
   - Consent checkbox: "I agree that others booked this day can see my name, headline, and skills"
   - Book button (disabled if no consent)
4. **Attendee preview section** (when date selected):
   - Query: `getBookingAttendees(spaceId, date)`
   - AttendeeList component
   - Title: "Who's coming on {date}"

On book:

- Call createMemberBooking mutation
- Show success toast with any capacity warning
- Redirect to /org/$slug/space/bookings or reset form

Handle loading states with existing skeleton patterns.
</action>
<verify>Route loads without errors: Navigate to /org/test-org/space (assuming test org exists with a space). Page renders calendar.</verify>
<done>Space booking page shows calendar, time picker, capacity indicators, attendee preview, consent checkbox, and book button.</done>
</task>

<task type="auto">
  <name>Task 3: Create My Bookings page at /org/$slug/space/bookings</name>
  <files>src/routes/org/$slug/space/bookings.tsx</files>
  <action>
**Create src/routes/org/$slug/space/bookings.tsx:**

Follow same three-query cascade pattern.

Page layout:

1. **Header**: "My Bookings" with breadcrumb back to space page
2. **Upcoming bookings section**:
   - Query: `getMyBookings(spaceId)`
   - Filter client-side to show only future dates (date >= today)
   - For each booking, show card with:
     - Date (formatted: "Monday, Feb 15, 2026")
     - Time range (formatted: "10:00 AM - 3:00 PM")
     - workingOn and interestedInMeeting tags (if set)
     - Edit tags button -> opens inline form or modal to update
     - Cancel button (with confirmation via alert-dialog, already installed)
3. **Past bookings section** (collapsible or separate):
   - Same query, filter to date < today
   - Show date, time, tags (read-only, no actions)

Edit tags flow:

- Click "Edit" -> inline form appears with workingOn and interestedInMeeting inputs
- Save button calls updateBookingTags mutation
- Cancel button closes form

Cancel flow:

- Click "Cancel" -> AlertDialog confirmation
- Confirm -> call cancelBooking mutation
- Success toast, booking removed from list

Empty state:

- "You have no upcoming bookings. Book a spot!"
- Link to /org/$slug/space

Responsive design:

- Desktop: Card list or table
- Mobile: Stacked cards
  </action>
  <verify>Route loads: Navigate to /org/test-org/space/bookings. Page renders with user's bookings or empty state.</verify>
  <done>My Bookings page shows upcoming and past bookings with cancel and edit tags functionality.</done>
  </task>

</tasks>

<verification>
1. `bun run lint` passes with no TypeScript errors
2. `bun run dev` starts and routes are accessible
3. Navigate to /org/$slug/space - calendar renders with availability indicators
4. Select a date - time picker and attendee preview appear
5. Book a spot - success toast, appears in My Bookings
6. Cancel a booking - confirmation dialog, booking disappears
7. Edit tags - saves successfully
</verification>

<success_criteria>

- react-day-picker installed and working
- /org/$slug/space page shows calendar with availability indicators (green/yellow/red dots)
- Selecting a date shows capacity, time picker, attendee preview
- Consent checkbox required before booking
- Soft capacity warning shown but booking not blocked
- /org/$slug/space/bookings shows user's bookings
- Cancel and edit tags work
- Attendee list shows consented profiles with name, headline, skills, tags
  </success_criteria>

<output>
After completion, create `.planning/phases/32-phase-32/32-02-SUMMARY.md`
</output>
