---
phase: 33-guest
plan: 03
type: execute
wave: 2
depends_on: [33-01]
files_modified:
  - src/routes/org/$slug/admin/guests.tsx
  - src/components/org/GuestApplicationQueue.tsx
  - src/components/org/GuestVisitHistory.tsx
autonomous: true

must_haves:
  truths:
    - 'Org admin can view pending guest applications'
    - 'Org admin can approve individual applications'
    - 'Org admin can reject applications with reason'
    - 'Org admin can batch-approve multiple applications'
    - 'Org admin can view guest visit history'
    - 'Guest applications show custom field responses'
    - 'Approval/rejection triggers notification to guest'
  artifacts:
    - path: 'src/routes/org/$slug/admin/guests.tsx'
      provides: 'Admin guest management page'
      min_lines: 100
    - path: 'src/components/org/GuestApplicationQueue.tsx'
      provides: 'Pending applications list with approve/reject'
      exports: ['GuestApplicationQueue']
    - path: 'src/components/org/GuestVisitHistory.tsx'
      provides: 'Past visits grouped by guest'
      exports: ['GuestVisitHistory']
  key_links:
    - from: 'src/components/org/GuestApplicationQueue.tsx'
      to: 'api.guestBookings.approveGuestVisit'
      via: 'useMutation'
      pattern: 'useMutation.*approveGuestVisit'
    - from: 'src/components/org/GuestApplicationQueue.tsx'
      to: 'api.guestBookings.batchApproveGuestVisits'
      via: 'useMutation'
      pattern: 'useMutation.*batchApproveGuestVisits'
---

<objective>
Create the admin interface for managing guest visit applications including approval queue, rejection workflow, batch operations, and visit history.

Purpose: Enable org admins to efficiently review and process guest visit applications, track guest history, and batch-approve multiple requests.
Output: Admin guests page with application queue, approval/rejection UI, and visit history view.
</objective>

<execution_context>
@/Users/luca/.claude/get-shit-done/workflows/execute-plan.md
@/Users/luca/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/33-guest/CONTEXT.md
@.planning/phases/33-guest/33-RESEARCH.md
@.planning/phases/33-guest/33-01-SUMMARY.md
@.planning/phases/30-org-onboarding/30-02-SUMMARY.md
@src/routes/org/$slug/admin/members.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create admin guests page with tabs for queue and history</name>
  <files>src/routes/org/$slug/admin/guests.tsx</files>
  <action>
Create `src/routes/org/$slug/admin/guests.tsx`:

Follow the pattern from admin/members.tsx for the admin page structure:

```typescript
import { createFileRoute, useNavigate, useParams } from '@tanstack/react-router'
import { useQuery } from 'convex/react'
import { AlertTriangle, CalendarDays, History, Users } from 'lucide-react'
import { api } from '../../../../../convex/_generated/api'
import { OrgAdminLayout } from '~/components/org/OrgAdminLayout'
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '~/components/ui/card'
import { Tabs, TabsContent, TabsList, TabsTrigger } from '~/components/ui/tabs'
import { Spinner } from '~/components/ui/spinner'
import { GuestApplicationQueue } from '~/components/org/GuestApplicationQueue'
import { GuestVisitHistory } from '~/components/org/GuestVisitHistory'

export const Route = createFileRoute('/org/$slug/admin/guests')({
  component: GuestsAdminPage,
})

function GuestsAdminPage() {
  const { slug } = useParams({ from: '/org/$slug/admin/guests' })
  const navigate = useNavigate()

  // Get org and check admin access
  const org = useQuery(api.orgs.directory.getOrgBySlug, { slug })
  const membership = useQuery(api.orgs.membership.getMembership,
    org ? { orgId: org._id } : 'skip'
  )
  const space = useQuery(api.coworkingSpaces.getSpaceByOrg,
    org ? { orgId: org._id } : 'skip'
  )

  // Loading state
  if (org === undefined || membership === undefined || space === undefined) {
    return (
      <OrgAdminLayout orgSlug={slug}>
        <div className="flex items-center justify-center py-12">
          <Spinner />
        </div>
      </OrgAdminLayout>
    )
  }

  // Not authorized
  if (!membership || membership.role !== 'admin') {
    return (
      <OrgAdminLayout orgSlug={slug}>
        <Card>
          <CardContent className="py-12 text-center">
            <AlertTriangle className="size-12 text-amber-500 mx-auto mb-4" />
            <p className="text-lg font-medium">Access Denied</p>
            <p className="text-slate-600">You need admin access to manage guests.</p>
          </CardContent>
        </Card>
      </OrgAdminLayout>
    )
  }

  // No coworking space configured
  if (!space) {
    return (
      <OrgAdminLayout orgSlug={slug}>
        <Card>
          <CardContent className="py-12 text-center">
            <CalendarDays className="size-12 text-slate-400 mx-auto mb-4" />
            <p className="text-lg font-medium">No Coworking Space</p>
            <p className="text-slate-600 mb-4">
              Configure a coworking space first to enable guest visits.
            </p>
            <Button onClick={() => navigate({ to: '/org/$slug/admin/space', params: { slug } })}>
              Configure Space
            </Button>
          </CardContent>
        </Card>
      </OrgAdminLayout>
    )
  }

  // Guest access disabled
  if (!space.guestAccessEnabled) {
    return (
      <OrgAdminLayout orgSlug={slug}>
        <Card>
          <CardContent className="py-12 text-center">
            <Users className="size-12 text-slate-400 mx-auto mb-4" />
            <p className="text-lg font-medium">Guest Access Disabled</p>
            <p className="text-slate-600 mb-4">
              Enable guest access in space settings to start receiving visit applications.
            </p>
            <Button onClick={() => navigate({ to: '/org/$slug/admin/space', params: { slug } })}>
              Space Settings
            </Button>
          </CardContent>
        </Card>
      </OrgAdminLayout>
    )
  }

  return (
    <OrgAdminLayout orgSlug={slug}>
      <div className="space-y-6">
        <div>
          <h1 className="text-2xl font-display text-foreground">Guest Management</h1>
          <p className="text-slate-600">
            Review visit applications and manage guest access to {space.name}
          </p>
        </div>

        <Tabs defaultValue="queue">
          <TabsList>
            <TabsTrigger value="queue" className="gap-2">
              <Users className="size-4" />
              Pending Applications
            </TabsTrigger>
            <TabsTrigger value="history" className="gap-2">
              <History className="size-4" />
              Visit History
            </TabsTrigger>
          </TabsList>

          <TabsContent value="queue" className="mt-6">
            <GuestApplicationQueue spaceId={space._id} orgSlug={slug} />
          </TabsContent>

          <TabsContent value="history" className="mt-6">
            <GuestVisitHistory spaceId={space._id} />
          </TabsContent>
        </Tabs>
      </div>
    </OrgAdminLayout>
  )
}
```

Import Button from ui/button at the top. The page checks:

- User is org admin
- Space exists
- Guest access is enabled
  Then shows tabbed interface for queue and history.
  </action>
  <verify>File exists at correct path. `bun run lint` passes</verify>
  <done>Admin guests page exists with tabs for queue and history, proper access checks</done>
  </task>

<task type="auto">
  <name>Task 2: Create GuestApplicationQueue component with approval, rejection, and batch operations</name>
  <files>src/components/org/GuestApplicationQueue.tsx</files>
  <action>
Create `src/components/org/GuestApplicationQueue.tsx`:

```typescript
import { useMutation, useQuery } from 'convex/react'
import { format } from 'date-fns'
import { Check, CheckCheck, Clock, Loader2, X, ChevronDown, ChevronUp } from 'lucide-react'
import { useState } from 'react'
import { toast } from 'sonner'
import { api } from '../../../convex/_generated/api'
import type { Id } from '../../../convex/_generated/dataModel'
import { Button } from '~/components/ui/button'
import { Card, CardContent, CardHeader, CardTitle } from '~/components/ui/card'
import { Checkbox } from '~/components/ui/checkbox'
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogTitle,
} from '~/components/ui/dialog'
import { Textarea } from '~/components/ui/textarea'
import { Badge } from '~/components/ui/badge'
import {
  Collapsible,
  CollapsibleContent,
  CollapsibleTrigger,
} from '~/components/ui/collapsible'

interface Props {
  spaceId: Id<'coworkingSpaces'>
  orgSlug: string
}

export function GuestApplicationQueue({ spaceId, orgSlug }: Props) {
  const pendingApplications = useQuery(api.guestBookings.getPendingGuestApplications, { spaceId })
  const approveVisit = useMutation(api.guestBookings.approveGuestVisit)
  const rejectVisit = useMutation(api.guestBookings.rejectGuestVisit)
  const batchApprove = useMutation(api.guestBookings.batchApproveGuestVisits)

  const [selectedIds, setSelectedIds] = useState<Set<Id<'spaceBookings'>>>(new Set())
  const [rejectDialogOpen, setRejectDialogOpen] = useState(false)
  const [rejectingId, setRejectingId] = useState<Id<'spaceBookings'> | null>(null)
  const [rejectionReason, setRejectionReason] = useState('')
  const [isProcessing, setIsProcessing] = useState(false)
  const [expandedIds, setExpandedIds] = useState<Set<string>>(new Set())

  if (pendingApplications === undefined) {
    return (
      <Card>
        <CardContent className="py-8 flex justify-center">
          <Loader2 className="size-6 animate-spin text-slate-400" />
        </CardContent>
      </Card>
    )
  }

  if (pendingApplications.length === 0) {
    return (
      <Card>
        <CardContent className="py-12 text-center">
          <Clock className="size-12 text-slate-300 mx-auto mb-4" />
          <p className="text-lg font-medium text-slate-600">No Pending Applications</p>
          <p className="text-sm text-slate-500">
            New guest visit requests will appear here
          </p>
        </CardContent>
      </Card>
    )
  }

  const toggleSelect = (id: Id<'spaceBookings'>) => {
    const newSelected = new Set(selectedIds)
    if (newSelected.has(id)) {
      newSelected.delete(id)
    } else {
      newSelected.add(id)
    }
    setSelectedIds(newSelected)
  }

  const toggleSelectAll = () => {
    if (selectedIds.size === pendingApplications.length) {
      setSelectedIds(new Set())
    } else {
      setSelectedIds(new Set(pendingApplications.map((a) => a.bookingId)))
    }
  }

  const toggleExpanded = (id: string) => {
    const newExpanded = new Set(expandedIds)
    if (newExpanded.has(id)) {
      newExpanded.delete(id)
    } else {
      newExpanded.add(id)
    }
    setExpandedIds(newExpanded)
  }

  const handleApprove = async (bookingId: Id<'spaceBookings'>) => {
    setIsProcessing(true)
    try {
      await approveVisit({ bookingId })
      toast.success('Visit approved')
    } catch (error) {
      toast.error(error instanceof Error ? error.message : 'Failed to approve')
    } finally {
      setIsProcessing(false)
    }
  }

  const handleReject = async () => {
    if (!rejectingId || rejectionReason.length < 10) {
      toast.error('Please provide a reason (at least 10 characters)')
      return
    }

    setIsProcessing(true)
    try {
      await rejectVisit({ bookingId: rejectingId, rejectionReason })
      toast.success('Visit rejected')
      setRejectDialogOpen(false)
      setRejectingId(null)
      setRejectionReason('')
    } catch (error) {
      toast.error(error instanceof Error ? error.message : 'Failed to reject')
    } finally {
      setIsProcessing(false)
    }
  }

  const handleBatchApprove = async () => {
    if (selectedIds.size === 0) return

    setIsProcessing(true)
    try {
      const results = await batchApprove({
        spaceId,
        bookingIds: Array.from(selectedIds),
      })
      const successCount = results.filter((r) => r.success).length
      toast.success(`Approved ${successCount} of ${results.length} applications`)
      setSelectedIds(new Set())
    } catch (error) {
      toast.error(error instanceof Error ? error.message : 'Batch approval failed')
    } finally {
      setIsProcessing(false)
    }
  }

  const openRejectDialog = (bookingId: Id<'spaceBookings'>) => {
    setRejectingId(bookingId)
    setRejectionReason('')
    setRejectDialogOpen(true)
  }

  return (
    <div className="space-y-4">
      {/* Batch Actions Bar */}
      <div className="flex items-center justify-between p-3 bg-slate-50 rounded-lg">
        <div className="flex items-center gap-3">
          <Checkbox
            checked={selectedIds.size === pendingApplications.length}
            onCheckedChange={toggleSelectAll}
          />
          <span className="text-sm text-slate-600">
            {selectedIds.size > 0
              ? `${selectedIds.size} selected`
              : `${pendingApplications.length} pending`}
          </span>
        </div>
        {selectedIds.size > 0 && (
          <Button
            size="sm"
            onClick={handleBatchApprove}
            disabled={isProcessing}
          >
            {isProcessing ? (
              <Loader2 className="size-4 mr-2 animate-spin" />
            ) : (
              <CheckCheck className="size-4 mr-2" />
            )}
            Approve Selected
          </Button>
        )}
      </div>

      {/* Applications List */}
      <div className="space-y-3">
        {pendingApplications.map((application) => (
          <Card key={application.bookingId}>
            <CardContent className="p-4">
              <div className="flex items-start gap-3">
                <Checkbox
                  checked={selectedIds.has(application.bookingId)}
                  onCheckedChange={() => toggleSelect(application.bookingId)}
                  className="mt-1"
                />

                <div className="flex-1 min-w-0">
                  <div className="flex items-start justify-between gap-4">
                    <div>
                      <h3 className="font-medium">{application.guest.name}</h3>
                      <p className="text-sm text-slate-600">{application.guest.email}</p>
                      {application.guest.organization && (
                        <p className="text-sm text-slate-500">{application.guest.organization}</p>
                      )}
                    </div>

                    <div className="text-right shrink-0">
                      <Badge variant="outline" className="mb-1">
                        {format(new Date(application.date), 'MMM d, yyyy')}
                      </Badge>
                      <p className="text-xs text-slate-500">
                        {formatTime(application.startMinutes)} - {formatTime(application.endMinutes)}
                      </p>
                    </div>
                  </div>

                  {/* Custom Field Responses */}
                  {application.customFieldResponses.length > 0 && (
                    <Collapsible
                      open={expandedIds.has(application.bookingId)}
                      onOpenChange={() => toggleExpanded(application.bookingId)}
                    >
                      <CollapsibleTrigger className="flex items-center gap-1 text-sm text-primary hover:underline mt-2">
                        {expandedIds.has(application.bookingId) ? (
                          <ChevronUp className="size-4" />
                        ) : (
                          <ChevronDown className="size-4" />
                        )}
                        View application details
                      </CollapsibleTrigger>
                      <CollapsibleContent className="mt-3 space-y-2 p-3 bg-slate-50 rounded-lg">
                        {application.customFieldResponses.map((response) => (
                          <div key={response.fieldId}>
                            <p className="text-xs font-medium text-slate-500">{response.label}</p>
                            <p className="text-sm">{response.value || '(empty)'}</p>
                          </div>
                        ))}
                      </CollapsibleContent>
                    </Collapsible>
                  )}

                  {/* Action Buttons */}
                  <div className="flex gap-2 mt-4">
                    <Button
                      size="sm"
                      onClick={() => handleApprove(application.bookingId)}
                      disabled={isProcessing}
                    >
                      <Check className="size-4 mr-1" />
                      Approve
                    </Button>
                    <Button
                      size="sm"
                      variant="outline"
                      onClick={() => openRejectDialog(application.bookingId)}
                      disabled={isProcessing}
                    >
                      <X className="size-4 mr-1" />
                      Reject
                    </Button>
                  </div>
                </div>
              </div>
            </CardContent>
          </Card>
        ))}
      </div>

      {/* Rejection Dialog */}
      <Dialog open={rejectDialogOpen} onOpenChange={setRejectDialogOpen}>
        <DialogContent>
          <DialogHeader>
            <DialogTitle>Reject Visit Request</DialogTitle>
            <DialogDescription>
              Please provide a reason for rejecting this visit request. The guest will be notified.
            </DialogDescription>
          </DialogHeader>
          <Textarea
            value={rejectionReason}
            onChange={(e) => setRejectionReason(e.target.value)}
            placeholder="Reason for rejection (at least 10 characters)..."
            rows={3}
          />
          <DialogFooter>
            <Button variant="outline" onClick={() => setRejectDialogOpen(false)}>
              Cancel
            </Button>
            <Button
              variant="destructive"
              onClick={handleReject}
              disabled={isProcessing || rejectionReason.length < 10}
            >
              {isProcessing ? (
                <Loader2 className="size-4 mr-2 animate-spin" />
              ) : null}
              Reject Request
            </Button>
          </DialogFooter>
        </DialogContent>
      </Dialog>
    </div>
  )
}

function formatTime(minutes: number): string {
  const hours = Math.floor(minutes / 60)
  const mins = minutes % 60
  const ampm = hours >= 12 ? 'PM' : 'AM'
  const displayHours = hours === 0 ? 12 : hours > 12 ? hours - 12 : hours
  return `${displayHours}:${mins.toString().padStart(2, '0')} ${ampm}`
}
```

Key features:

- Batch selection with select all
- Expandable custom field responses
- Individual approve/reject buttons
- Rejection requires 10+ char reason (matching existing pattern)
- Batch approve button in toolbar
  </action>
  <verify>File exists and exports GuestApplicationQueue. `bun run lint` passes</verify>
  <done>GuestApplicationQueue component exists with approve, reject, batch operations, and expandable custom field display</done>
  </task>

<task type="auto">
  <name>Task 3: Create GuestVisitHistory component showing past visits grouped by guest</name>
  <files>src/components/org/GuestVisitHistory.tsx</files>
  <action>
Create `src/components/org/GuestVisitHistory.tsx`:

```typescript
import { useQuery } from 'convex/react'
import { format } from 'date-fns'
import { Calendar, CheckCircle2, History, Loader2, UserCircle, XCircle } from 'lucide-react'
import { api } from '../../../convex/_generated/api'
import type { Id } from '../../../convex/_generated/dataModel'
import { Badge } from '~/components/ui/badge'
import { Card, CardContent, CardHeader, CardTitle } from '~/components/ui/card'
import {
  Accordion,
  AccordionContent,
  AccordionItem,
  AccordionTrigger,
} from '~/components/ui/accordion'

interface Props {
  spaceId: Id<'coworkingSpaces'>
}

export function GuestVisitHistory({ spaceId }: Props) {
  const visitHistory = useQuery(api.guestBookings.getGuestVisitHistory, { spaceId })

  if (visitHistory === undefined) {
    return (
      <Card>
        <CardContent className="py-8 flex justify-center">
          <Loader2 className="size-6 animate-spin text-slate-400" />
        </CardContent>
      </Card>
    )
  }

  if (visitHistory.length === 0) {
    return (
      <Card>
        <CardContent className="py-12 text-center">
          <History className="size-12 text-slate-300 mx-auto mb-4" />
          <p className="text-lg font-medium text-slate-600">No Visit History</p>
          <p className="text-sm text-slate-500">
            Approved and rejected guest visits will appear here
          </p>
        </CardContent>
      </Card>
    )
  }

  return (
    <div className="space-y-4">
      {/* Stats Summary */}
      <div className="grid gap-4 sm:grid-cols-3">
        <Card>
          <CardContent className="pt-4">
            <div className="flex items-center gap-3">
              <div className="size-10 rounded-full bg-primary/10 flex items-center justify-center">
                <UserCircle className="size-5 text-primary" />
              </div>
              <div>
                <p className="text-2xl font-bold">{visitHistory.length}</p>
                <p className="text-sm text-slate-500">Total Guests</p>
              </div>
            </div>
          </CardContent>
        </Card>
        <Card>
          <CardContent className="pt-4">
            <div className="flex items-center gap-3">
              <div className="size-10 rounded-full bg-green-50 flex items-center justify-center">
                <CheckCircle2 className="size-5 text-green-600" />
              </div>
              <div>
                <p className="text-2xl font-bold">
                  {visitHistory.reduce((sum, g) => sum + g.approvedCount, 0)}
                </p>
                <p className="text-sm text-slate-500">Approved Visits</p>
              </div>
            </div>
          </CardContent>
        </Card>
        <Card>
          <CardContent className="pt-4">
            <div className="flex items-center gap-3">
              <div className="size-10 rounded-full bg-red-50 flex items-center justify-center">
                <XCircle className="size-5 text-red-500" />
              </div>
              <div>
                <p className="text-2xl font-bold">
                  {visitHistory.reduce((sum, g) => sum + g.rejectedCount, 0)}
                </p>
                <p className="text-sm text-slate-500">Rejected Visits</p>
              </div>
            </div>
          </CardContent>
        </Card>
      </div>

      {/* Guest Accordion */}
      <Card>
        <CardHeader>
          <CardTitle className="text-lg flex items-center gap-2">
            <History className="size-5" />
            Visit History by Guest
          </CardTitle>
        </CardHeader>
        <CardContent>
          <Accordion type="single" collapsible className="w-full">
            {visitHistory.map((guest) => (
              <AccordionItem key={guest.guestUserId} value={guest.guestUserId}>
                <AccordionTrigger className="hover:no-underline">
                  <div className="flex items-center justify-between w-full pr-4">
                    <div className="flex items-center gap-3">
                      <div className="size-10 rounded-full bg-slate-100 flex items-center justify-center">
                        <UserCircle className="size-6 text-slate-500" />
                      </div>
                      <div className="text-left">
                        <p className="font-medium">{guest.name}</p>
                        <p className="text-sm text-slate-500">{guest.email}</p>
                      </div>
                    </div>
                    <div className="flex items-center gap-2">
                      <Badge variant="secondary">{guest.totalVisits} visits</Badge>
                      {guest.becameMember && (
                        <Badge variant="default">Member</Badge>
                      )}
                    </div>
                  </div>
                </AccordionTrigger>
                <AccordionContent>
                  <div className="pl-13 space-y-2">
                    {guest.visits.map((visit) => (
                      <div
                        key={visit.bookingId}
                        className="flex items-center justify-between p-3 bg-slate-50 rounded-lg"
                      >
                        <div className="flex items-center gap-3">
                          <Calendar className="size-4 text-slate-400" />
                          <span className="text-sm">
                            {format(new Date(visit.date), 'MMMM d, yyyy')}
                          </span>
                          <span className="text-xs text-slate-500">
                            {formatTime(visit.startMinutes)} - {formatTime(visit.endMinutes)}
                          </span>
                        </div>
                        <Badge
                          variant={visit.status === 'confirmed' ? 'default' : 'destructive'}
                        >
                          {visit.status === 'confirmed' ? 'Approved' : 'Rejected'}
                        </Badge>
                      </div>
                    ))}
                    {guest.firstVisitDate && (
                      <p className="text-xs text-slate-500 mt-2">
                        First visit: {format(new Date(guest.firstVisitDate), 'MMM d, yyyy')}
                        {guest.lastVisitDate && guest.lastVisitDate !== guest.firstVisitDate && (
                          <> | Last visit: {format(new Date(guest.lastVisitDate), 'MMM d, yyyy')}</>
                        )}
                      </p>
                    )}
                  </div>
                </AccordionContent>
              </AccordionItem>
            ))}
          </Accordion>
        </CardContent>
      </Card>
    </div>
  )
}

function formatTime(minutes: number): string {
  const hours = Math.floor(minutes / 60)
  const mins = minutes % 60
  const ampm = hours >= 12 ? 'PM' : 'AM'
  const displayHours = hours === 0 ? 12 : hours > 12 ? hours - 12 : hours
  return `${displayHours}:${mins.toString().padStart(2, '0')} ${ampm}`
}
```

Key features:

- Summary stats (total guests, approved, rejected)
- Accordion grouped by guest
- Shows member conversion badge
- Individual visit entries with status
- First/last visit dates
  </action>
  <verify>File exists and exports GuestVisitHistory. `bun run lint` passes</verify>
  <done>GuestVisitHistory component exists with stats, accordion by guest, visit entries with status</done>
  </task>

</tasks>

<verification>
After all tasks:
1. Navigate to `/org/[slug]/admin/guests` as org admin
2. See tabs for "Pending Applications" and "Visit History"
3. Pending queue shows applications with custom field details
4. Can approve/reject individual applications
5. Can batch-approve multiple applications
6. History tab shows guests grouped with visit details
7. Notifications sent on approval/rejection
</verification>

<success_criteria>

- Admin guests page accessible only to org admins
- Pending applications shown with guest info and custom field responses
- Individual approve/reject buttons work
- Rejection requires reason (10+ chars)
- Batch approve works for multiple selected applications
- Visit history shows all guests with their visits
- Summary stats show totals
- Member conversion badge visible for converted guests
  </success_criteria>

<output>
After completion, create `.planning/phases/33-guest/33-03-SUMMARY.md`
</output>
