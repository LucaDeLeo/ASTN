---
phase: 34-admin
plan: 02
type: execute
wave: 2
depends_on: ['34-01']
files_modified:
  - src/routes/org/$slug/admin/bookings.tsx
  - src/components/org/TodayBookings.tsx
  - src/components/org/BookingCalendar.tsx
  - src/components/org/BookingList.tsx
  - src/components/org/BookingHistory.tsx
autonomous: true

must_haves:
  truths:
    - "Admin can see today's bookings overview with member and guest names"
    - 'Admin can view upcoming bookings in calendar view'
    - 'Admin can view upcoming bookings in list view'
    - 'Admin can view booking history with date range filtering'
    - 'Calendar shows availability indicators per day'
  artifacts:
    - path: 'src/routes/org/$slug/admin/bookings.tsx'
      provides: 'Admin bookings management page with tabs'
      min_lines: 100
    - path: 'src/components/org/TodayBookings.tsx'
      provides: "Today's bookings card component"
      min_lines: 50
    - path: 'src/components/org/BookingCalendar.tsx'
      provides: 'Calendar view with react-day-picker'
      min_lines: 80
  key_links:
    - from: 'src/routes/org/$slug/admin/bookings.tsx'
      to: 'api.spaceBookings.admin'
      via: 'useQuery hooks'
      pattern: "api\\.spaceBookings\\.admin"
    - from: 'src/components/org/BookingCalendar.tsx'
      to: 'react-day-picker'
      via: 'DayPicker component'
      pattern: 'DayPicker'
---

<objective>
Create the admin bookings management page with today's overview, calendar, list, and history views.

Purpose: Provide org admins with comprehensive booking management interface (ADMIN-01, ADMIN-02, ADMIN-04).
Output: New bookings admin page at `/org/$slug/admin/bookings` with tabbed interface and reusable components.
</objective>

<execution_context>
@/Users/luca/.claude/get-shit-done/workflows/execute-plan.md
@/Users/luca/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/34-admin/CONTEXT.md

# Existing patterns to follow

@src/routes/org/$slug/admin/guests.tsx (tabbed admin page pattern)
@src/routes/org/$slug/admin/index.tsx (admin dashboard layout)
@src/routes/org/$slug/book.tsx (react-day-picker usage pattern)
@src/components/org/OrgStats.tsx (stat card patterns)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TodayBookings component</name>
  <files>src/components/org/TodayBookings.tsx</files>
  <action>
Create `src/components/org/TodayBookings.tsx` - a card component showing today's confirmed bookings.

**Component interface:**

```typescript
interface TodayBookingsProps {
  spaceId: Id<'coworkingSpaces'>
  capacity: number
}
```

**Implementation:**

1. Use `useQuery(api.spaceBookings.admin.getTodaysBookings, { spaceId })`
2. Show a Card with:
   - Header: "Today's Bookings" with CalendarDays icon
   - Count: "X / Y capacity" with visual indicator (green/yellow/red)
   - List of attendees with:
     - Avatar placeholder (first letter of name)
     - Name and headline
     - Time range (format minutes to "10:00 AM - 3:00 PM")
     - Badge for guest vs member
     - Working on / interested in meeting tags if present
3. Empty state if no bookings today
4. Loading state with spinner

**Follow patterns from:**

- OrgStats.tsx for card styling
- GuestApplicationQueue.tsx for list item styling
- Existing time formatting in book.tsx

**Utility function:**

```typescript
function formatTimeRange(startMinutes: number, endMinutes: number): string {
  const formatTime = (minutes: number) => {
    const hours = Math.floor(minutes / 60)
    const mins = minutes % 60
    const period = hours >= 12 ? 'PM' : 'AM'
    const displayHours = hours % 12 || 12
    return mins === 0
      ? `${displayHours} ${period}`
      : `${displayHours}:${mins.toString().padStart(2, '0')} ${period}`
  }
  return `${formatTime(startMinutes)} - ${formatTime(endMinutes)}`
}
```

  </action>
  <verify>TypeScript build passes: `cd /Users/luca/conductor/workspaces/ASTN/spokane && npx tsc --noEmit`</verify>
  <done>TodayBookings component exists and shows today's bookings with capacity indicator and attendee list</done>
</task>

<task type="auto">
  <name>Task 2: Create BookingCalendar and BookingList components</name>
  <files>src/components/org/BookingCalendar.tsx, src/components/org/BookingList.tsx</files>
  <action>
Create calendar and list view components for upcoming bookings.

**BookingCalendar.tsx:**

```typescript
interface BookingCalendarProps {
  spaceId: Id<'coworkingSpaces'>
  onDateSelect: (date: Date) => void
  selectedDate?: Date
}
```

Implementation:

1. Use `react-day-picker` with DayPicker component (already installed in project)
2. Fetch capacity data with `useQuery(api.spaceBookings.getCapacityForDateRange, { spaceId, startDate, endDate })`
3. Use custom `DayButton` pattern from `src/routes/org/$slug/book.tsx` to show availability dots
4. Green dot = available, yellow = nearing capacity, red = at capacity
5. Clicking a date calls `onDateSelect`
6. Show selected date's bookings below calendar

**BookingList.tsx:**

```typescript
interface BookingListProps {
  spaceId: Id<'coworkingSpaces'>
  startDate: string
  endDate: string
}
```

Implementation:

1. Use `useQuery(api.spaceBookings.admin.getAdminBookingsForDateRange, { spaceId, startDate, endDate, status: 'confirmed' })`
2. Group bookings by date using reduce/Object.entries
3. For each date group:
   - Date header (e.g., "Tuesday, February 15")
   - List of booking cards (name, time, guest badge, tags)
4. Empty state if no upcoming bookings
5. Support pagination with "Load more" button

**Shared patterns:**

- Use Badge component for guest/member distinction
- Use the formatTimeRange utility function (can extract to lib/time.ts)
- Follow existing card patterns from GuestApplicationQueue
  </action>
  <verify>TypeScript build passes: `cd /Users/luca/conductor/workspaces/ASTN/spokane && npx tsc --noEmit`</verify>
  <done>BookingCalendar shows monthly calendar with availability indicators, BookingList shows grouped chronological bookings</done>
  </task>

<task type="auto">
  <name>Task 3: Create admin bookings page with tabs</name>
  <files>src/routes/org/$slug/admin/bookings.tsx, src/components/org/BookingHistory.tsx</files>
  <action>
Create the main bookings admin page with tabbed interface.

**BookingHistory.tsx:**

```typescript
interface BookingHistoryProps {
  spaceId: Id<'coworkingSpaces'>
}
```

Implementation:

1. Date range picker with start/end date inputs (default: last 30 days)
2. Status filter dropdown: All, Confirmed, Cancelled, Rejected
3. Use `useQuery(api.spaceBookings.admin.getAdminBookingsForDateRange, { spaceId, startDate, endDate, status })`
4. Show bookings in chronological list (newest first for history)
5. Include status badges (confirmed=green, cancelled=slate, rejected=red)
6. Show rejection reason for rejected bookings
7. Pagination support

**bookings.tsx route:**

1. Create file at `src/routes/org/$slug/admin/bookings.tsx`
2. Follow exact pattern from `guests.tsx`:
   - Route definition with `createFileRoute`
   - Auth checks (org, membership, space)
   - Loading/error/access-denied states
   - Breadcrumb navigation

3. Main content:
   - Header: "Bookings Management" with description
   - TodayBookings card at top
   - Tabs component with 4 tabs:
     - "Today" - TodayBookings detailed view
     - "Calendar" - BookingCalendar component
     - "Upcoming" - BookingList component (next 30 days)
     - "History" - BookingHistory component

4. Tab implementation:

```typescript
<Tabs defaultValue="today">
  <TabsList>
    <TabsTrigger value="today" className="gap-2">
      <Clock className="size-4" />
      Today
    </TabsTrigger>
    <TabsTrigger value="calendar" className="gap-2">
      <CalendarDays className="size-4" />
      Calendar
    </TabsTrigger>
    <TabsTrigger value="upcoming" className="gap-2">
      <ArrowRight className="size-4" />
      Upcoming
    </TabsTrigger>
    <TabsTrigger value="history" className="gap-2">
      <History className="size-4" />
      History
    </TabsTrigger>
  </TabsList>
  <TabsContent value="today">...</TabsContent>
  ...
</Tabs>
```

**Note:** Do NOT add manual booking or export buttons in this plan - those come in Plan 03.
</action>
<verify>

1. TypeScript passes: `npx tsc --noEmit`
2. Navigate to `/org/[slug]/admin/bookings` shows the page with all 4 tabs
3. Today tab shows today's bookings
4. Calendar tab shows monthly calendar with availability
5. Upcoming tab shows future bookings grouped by date
6. History tab shows past bookings with date range filter
   </verify>
   <done>Admin bookings page exists at /org/$slug/admin/bookings with Today, Calendar, Upcoming, and History tabs</done>
   </task>

</tasks>

<verification>
1. TypeScript compilation passes
2. Page renders without errors for an org with a configured space
3. TodayBookings shows current day's bookings
4. Calendar shows availability indicators and responds to date selection
5. Upcoming list shows future bookings grouped by date
6. History tab shows date range filtering and status badges
7. All components use proper loading and empty states
</verification>

<success_criteria>

- Admin can navigate to /org/$slug/admin/bookings
- Today's bookings overview shows member + guest names with capacity indicator (ADMIN-01)
- Calendar view shows availability per day and allows date selection (ADMIN-02)
- List view shows upcoming bookings grouped by date (ADMIN-02)
- History tab has date range filtering and status filter (ADMIN-04)
- All views show booking details (time, tags, guest badge)
  </success_criteria>

<output>
After completion, create `.planning/phases/34-admin/34-02-SUMMARY.md`
</output>
