---
phase: 35-generation
plan: 03
type: execute
wave: 2
depends_on: ['35-01']
files_modified:
  - src/components/actions/ActionCard.tsx
  - src/components/actions/CareerActionsSection.tsx
  - src/components/actions/CompletedActionsSection.tsx
  - src/routes/matches/index.tsx
  - src/routes/index.tsx
autonomous: true

must_haves:
  truths:
    - 'Actions display as violet-accented cards visually distinct from emerald/blue/amber match tiers'
    - 'Each action card shows type badge with icon, title, description, rationale, and status-dependent CTA buttons'
    - 'User can save, dismiss, start, and complete actions via card buttons with immediate optimistic feedback'
    - 'Your Next Moves section appears on matches page between tier sections and growth areas'
    - '1-2 top actions appear on dashboard between top matches and suggested organizations'
    - 'Completed actions show in a collapsible section with progress indicator'
    - 'Empty state shows guidance text when no actions exist'
  artifacts:
    - path: 'src/components/actions/ActionCard.tsx'
      provides: 'Violet action card with type badges and status buttons'
      exports: ['ActionCard']
    - path: 'src/components/actions/CareerActionsSection.tsx'
      provides: 'Section wrapper with grid layout and empty state'
      exports: ['CareerActionsSection']
    - path: 'src/components/actions/CompletedActionsSection.tsx'
      provides: 'Collapsible completed actions with progress indicator'
      exports: ['CompletedActionsSection']
    - path: 'src/routes/matches/index.tsx'
      provides: 'Career actions integrated into matches page'
      contains: 'CareerActionsSection'
    - path: 'src/routes/index.tsx'
      provides: 'Action preview on dashboard'
      contains: 'Your Next Moves'
  key_links:
    - from: 'src/components/actions/CareerActionsSection.tsx'
      to: 'convex/careerActions/queries.ts'
      via: 'useQuery(api.careerActions.queries.getMyActions)'
      pattern: "careerActions\\.queries\\.getMyActions"
    - from: 'src/components/actions/ActionCard.tsx'
      to: 'convex/careerActions/mutations.ts'
      via: 'useMutation for save/dismiss/start/complete/unsave'
      pattern: 'useMutation.*careerActions'
    - from: 'src/routes/matches/index.tsx'
      to: 'src/components/actions/CareerActionsSection.tsx'
      via: 'import and render between tiers and growth areas'
      pattern: 'CareerActionsSection'
    - from: 'src/routes/index.tsx'
      to: 'src/components/actions/ActionCard.tsx'
      via: 'import and render in dashboard'
      pattern: 'ActionCard'
---

<objective>
Build the frontend action card system and integrate it into the matches page and dashboard.

Purpose: Users need to see, interact with, and manage their career actions. This plan creates the complete UI experience -- from violet-accented cards with status buttons to page-level integration.
Output: Working ActionCard, CareerActionsSection, and CompletedActionsSection components, integrated into both the matches page and dashboard.
</objective>

<execution_context>
@/Users/luca/.claude/get-shit-done/workflows/execute-plan.md
@/Users/luca/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/35-generation/35-RESEARCH.md
@.planning/phases/35-generation/35-01-SUMMARY.md
@src/components/matches/MatchCard.tsx
@src/components/matches/MatchTierSection.tsx
@src/components/matches/SavedMatchesSection.tsx
@src/components/matches/GrowthAreas.tsx
@src/components/animation/AnimatedCard.tsx
@src/routes/matches/index.tsx
@src/routes/index.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ActionCard component with type badges and status-dependent buttons</name>
  <files>src/components/actions/ActionCard.tsx</files>
  <action>
  Create `src/components/actions/ActionCard.tsx` following `src/components/matches/MatchCard.tsx` patterns but simpler (no swipe, no view transitions, no opportunity data).

**Type configuration object** (like `tierConfig` in MatchCard):

```
const typeConfig = {
  replicate: { label: 'Replicate Research', icon: FlaskConical },
  collaborate: { label: 'Find Collaborators', icon: Users },
  start_org: { label: 'Start Initiative', icon: Rocket },
  identify_gaps: { label: 'Identify Gaps', icon: Search },
  volunteer: { label: 'Volunteer', icon: HandHeart },
  build_tools: { label: 'Build Tools', icon: Wrench },
  teach_write: { label: 'Teach or Write', icon: PenLine },
  develop_skills: { label: 'Develop Skills', icon: GraduationCap },
}
```

Per locked decision #9 — use these exact icon mappings from lucide-react.

**Props interface:**

```
interface ActionCardProps {
  action: {
    _id: Id<'careerActions'>
    type: keyof typeof typeConfig
    title: string
    description: string
    rationale: string
    status: 'active' | 'saved' | 'in_progress' | 'done'
  }
  onSave?: () => void
  onDismiss?: () => void
  onStart?: () => void
  onComplete?: () => void
  onUnsave?: () => void
}
```

**Card structure:**

- Use shadcn `Card` component with violet accent border: `border-violet-200`
- Top: Type badge using `Badge` component with `bg-violet-100 text-violet-800` and the icon from typeConfig (per locked decisions #6, #12)
- Middle: Title in `font-medium text-foreground`, description in `text-sm text-muted-foreground line-clamp-3`
- Below description: "Based on:" label in `text-xs text-muted-foreground` followed by rationale text in `text-xs text-violet-700` (per DISP-02)
- Bottom: Status-dependent buttons (per research doc button visibility table):

**Button visibility by status** (per locked decision #10):

- `active`: Primary "Start" button (calls onStart). Desktop hover reveals Save (Bookmark icon) and Dismiss (X icon) as icon buttons.
- `saved`: Primary "Start" button (calls onStart). "Unsave" text button (calls onUnsave). Desktop hover reveals Dismiss.
- `in_progress`: Primary "Mark Done" button (calls onComplete). "Cancel" text button (sets back to active — but we don't have an explicit "cancel" mutation... use the pattern: call onStart with a cancelProgress callback, or add a separate handler). Actually per the research doc status transitions table, `in_progress -> active` is "(cancel progress)" which clears startedAt. For Phase 35, handle this by having the parent pass an onCancel prop that calls a mutation. OR: For simplicity, let the ActionCard accept an `onCancel` prop. The parent component should call a mutation that patches status back to active and clears startedAt. NOTE: The mutations in Plan 01 don't include a cancel mutation — the planner will need the executor to add one, OR use unsaveAction creatively. Best approach: just add `onCancel` as a prop and let CareerActionsSection handle it via a direct `ctx.db.patch` or a small additional mutation. For now, include the button but wire it to a TODO comment — the CareerActionsSection will implement it.
- `done`: Show check icon with "Completed" text, no interactive buttons. Optionally show `completedAt` date.
- `dismissed`: Not rendered (filtered out before reaching this component).

**Desktop hover actions** (per locked decision #6):
Follow MatchCard pattern: wrap card in `group` class, hover actions appear as a row of icon buttons in a floating bar (or overlay). Use `opacity-0 group-hover:opacity-100 transition-opacity` pattern.

- For `active` status: show Save (Bookmark) and Dismiss (X) on hover
- For `saved` status: show Dismiss (X) on hover

**Colors:** Use Tailwind's built-in `violet-*` utilities (per locked decision #12). Do NOT create custom CSS properties.

Import from lucide-react: `FlaskConical`, `Users`, `Rocket`, `Search`, `HandHeart`, `Wrench`, `PenLine`, `GraduationCap`, `Bookmark`, `X`, `Play`, `CheckCircle2`
Import from `~/components/ui/card`: `Card`
Import from `~/components/ui/badge`: `Badge`
Import from `~/components/ui/button`: `Button`
Import `cn` from `~/lib/utils`
Import `Id` type from `convex/_generated/dataModel`
</action>
<verify>`bun run lint` passes. Component exports correctly. Visual verification deferred to integration.</verify>
<done>ActionCard renders violet-accented cards with type badges (icon + label), personalized rationale, and status-dependent buttons. Desktop hover reveals save/dismiss actions. All 8 action types have distinct icons per locked decision #9.</done>
</task>

<task type="auto">
  <name>Task 2: Create section components and integrate into matches page + dashboard</name>
  <files>src/components/actions/CareerActionsSection.tsx, src/components/actions/CompletedActionsSection.tsx, src/routes/matches/index.tsx, src/routes/index.tsx</files>
  <action>
  **1. Create `src/components/actions/CompletedActionsSection.tsx`:**

Follow `src/components/matches/SavedMatchesSection.tsx` pattern exactly (per research Pattern 6):

- Props: `actions` array (same shape as ActionCard's action prop), `totalCount` (total actions including active/in-progress for progress indicator)
- Persist expanded state via `sessionStorage` with key `'completed-actions-expanded'`
- Collapsible header: violet-themed (`bg-violet-50 border border-violet-200 hover:bg-violet-100`)
  - Left: CheckCircle2 icon (violet-600) + "{completed.length} Completed" text (violet-800)
  - Right: ChevronDown with rotation transition
- Progress indicator in header: `"{completed.length} of {totalCount} completed"` (per Claude's Discretion — include it, it's motivational)
- Expandable content using `grid-rows-[1fr]`/`grid-rows-[0fr]` CSS animation pattern
- Actions sorted by `completedAt` desc (most recent first, per Claude's Discretion)
- Grid: `grid-cols-1 sm:grid-cols-2 lg:grid-cols-3` (per Claude's Discretion, matching MatchTierSection)
- Each action wrapped in `AnimatedCard` for entrance animation

**2. Create `src/components/actions/CareerActionsSection.tsx`:**

Self-contained section that fetches its own data and manages interactions.

- Uses `useQuery(api.careerActions.queries.getMyActions)` to fetch actions
- Uses `useMutation` for each status transition: `api.careerActions.mutations.saveAction`, `dismissAction`, `startAction`, `completeAction`, `unsaveAction`
- For the cancel-progress case (`in_progress -> active`): Create a small handler that calls `unsaveAction` if available, OR better: since Plan 01 doesn't have a dedicated cancelAction mutation, check if the executor added one. If not, add a `cancelAction` mutation inline. The simplest approach for the executor: call `api.careerActions.mutations.unsaveAction` is WRONG (unsave only works from saved). Instead: we need to either (a) add a `cancelAction` mutation in mutations.ts, or (b) use a generic patch. Go with option (a): the executor should add `cancelAction` to mutations.ts (valid from `in_progress`, sets `status: 'active'`, clears `startedAt`). Note this in the action section below.

**IMPORTANT:** The executor MUST also add a `cancelAction` mutation to `convex/careerActions/mutations.ts`:

- `cancelAction`: args `{ actionId: v.id('careerActions') }`. Valid from: `in_progress`. Sets `status: 'active'`, clears `startedAt` (set to `undefined`).
- Follow the same auth + ownership pattern as other mutations.

Section structure:

- Section header: "Your Next Moves" in `text-lg font-display font-semibold text-foreground`
- If no actions at all (all arrays empty) and user has a profile: show empty state text "Refresh your matches to generate personalized career actions." (per locked decision #14)
- If actions exist:
  - Active + in-progress actions in grid: `grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4`
  - Each action wrapped in `AnimatedCard` with stagger index
  - Render ActionCard with appropriate callbacks wired to mutations
  - Below the grid: render `CompletedActionsSection` if any completed actions exist
  - Saved actions also show in the main grid (they're still actionable with "Start" button)
- Do NOT show dismissed actions anywhere

**3. Modify `src/routes/matches/index.tsx`:**

- Add import: `import { CareerActionsSection } from '~/components/actions/CareerActionsSection'`
- Insert `<CareerActionsSection />` between the match tier sections and growth areas section. Specifically, after the `{hasMatches && (...)}` block containing MatchTierSection renders, and before the `{growthAreas.length > 0 && (...)}` block.
- Wrap in a div with `mt-8` for spacing (matching growth areas pattern)
- Per locked decision #7: placement is after match tiers, before growth areas

**4. Modify `src/routes/index.tsx` (Dashboard):**

- Add import: `import { ActionCard } from '~/components/actions/ActionCard'`
- Add import: `import { useMutation } from 'convex/react'` (if not already imported — check, `useQuery` is already imported)
- Add query: `const actionsData = useQuery(api.careerActions.queries.getMyActions)`
- Extract top 2 active actions: `const topActions = actionsData?.active?.slice(0, 2) ?? []`
- Add mutations for action interactions in dashboard: `saveAction`, `dismissAction`, `startAction`
- Insert "Your Next Moves" section between the existing "Your Top Matches" section and "Suggested Organizations" section (per locked decision #8):
  ```
  {topActions.length > 0 && (
    <section className="mb-8">
      <div className="flex items-center justify-between mb-4">
        <h2 className="text-xl font-display font-semibold text-foreground">
          Your Next Moves
        </h2>
        <Button asChild variant="ghost" size="sm">
          <Link to="/matches">View all</Link>
        </Button>
      </div>
      <div className="grid grid-cols-1 gap-3 sm:grid-cols-2">
        {topActions.map((action, index) => (
          <AnimatedCard key={action._id} index={index}>
            <ActionCard
              action={action}
              onSave={() => saveAction({ actionId: action._id })}
              onDismiss={() => dismissAction({ actionId: action._id })}
              onStart={() => startAction({ actionId: action._id })}
            />
          </AnimatedCard>
        ))}
      </div>
    </section>
  )}
  ```
- Import `api` if needed (check — should already be imported)
  </action>
  <verify>

1. `bun run lint` passes
2. `bun run build` succeeds with no TypeScript errors
3. Visual spot-check: Start dev server, navigate to `/matches` — "Your Next Moves" section should appear (may be empty if no actions generated yet; empty state text should show)
4. Navigate to `/` dashboard — "Your Next Moves" section should appear between matches and orgs (if actions exist)
   </verify>
   <done>ActionCard, CareerActionsSection, and CompletedActionsSection render correctly. Matches page shows "Your Next Moves" between tier sections and growth areas. Dashboard shows 1-2 top actions. Completed actions appear in collapsible section with progress indicator. Empty state guides users to refresh matches.</done>
   </task>

</tasks>

<verification>
1. `bun run lint` passes
2. `bun run build` succeeds
3. Matches page (`/matches`) renders CareerActionsSection between tiers and growth areas
4. Dashboard (`/`) renders "Your Next Moves" section with top 2 active actions
5. ActionCard shows violet accent, type badge with icon, rationale text, and status buttons
6. CompletedActionsSection collapses/expands with progress indicator
7. Empty state text shows when no actions exist
</verification>

<success_criteria>

- Violet-accented ActionCards visually distinct from emerald/blue/amber match tier cards
- Type badges show correct icon per action type (8 types, 8 icons)
- Status-dependent buttons: Start/Save/Dismiss for active, Start/Unsave for saved, Mark Done/Cancel for in-progress, Completed state for done
- Matches page: CareerActionsSection between tiers and growth areas
- Dashboard: 1-2 top actions between matches and org suggestions
- Completed actions: collapsible section with "X of Y completed" progress
- Empty state: "Refresh your matches to generate personalized career actions"
  </success_criteria>

<output>
After completion, create `.planning/phases/35-generation/35-03-SUMMARY.md`
</output>
